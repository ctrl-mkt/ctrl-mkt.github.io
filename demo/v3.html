<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoGenie V3.5 (Stable)</title>
    
    <!-- 1. Fonts -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    
    <!-- 2. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 3. React & ReactDOM (v18) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 4. Babel (Standalone) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 5. Recharts (Fixed Version 2.12.7 for Stability) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- 6. PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 16px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid #2563eb; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #error-display { display: none; padding: 20px; background: #fee2e2; color: #991b1b; position: fixed; top: 0; left: 0; width: 100%; z-index: 10000; font-size: 14px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="error-display"></div>
    <div id="root"></div>

    <!-- Global Error Handler -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const display = document.getElementById('error-display');
            display.style.display = 'block';
            display.innerHTML = `<strong>System Error:</strong> ${message} <br><small>${source}:${lineno}</small>`;
            console.error(error);
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        // Safe Destructuring for Recharts
        const { 
            LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
            PieChart, Pie, Cell, AreaChart, Area, FunnelChart, Funnel, LabelList, ComposedChart 
        } = Recharts;

        /**
         * [CONFIGURATION]
         */
        const CONFIG = {
            urls: {
                gangnam: {
                    sales: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkVxlddpX1ZNegmFmdglMVPhZ7kS4nL6pA5h8xz8N37qsXVCkbevpnWkcDzEz0yMKVZsMysiFyjubt/pub?gid=0&single=true&output=csv",
                    menu: "https://docs.google.com/spreadsheets/d/e/2PACX-1vT63fNrLrAKdLitdSJEUINmToFQwQ7aywSdjcSZi3HAaq3kHBLCGh1h1lZL_mER39ewH8m_nX3fqqRX/pub?output=csv"
                },
                daehakro: {
                    sales: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQP6muCYAzULTYwk11AxfeGELmpVkz_uGM6pNdcoaPCAAQpT2KizuoHpPcjhsMxmKwVSlafYqzRh-ln/pub?gid=0&single=true&output=csv",
                    menu: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTgoZKyOytiZDYTXQke89n0eWwthk7wn8SrZhCTOVm03UoNOaVs0JpXhNTlDeRQCK3_L7p5Q21W6gjN/pub?gid=0&single=true&output=csv"
                },
                cctv: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-4E2_vIblHjCsFtlWS5DcYaAHajRPI18Ifu9qJ4qlI-objT4C_hL5rifKocjf_TIpxEsGjUCw1hh6/pub?gid=0&single=true&output=csv"
            },
            storeIds: {
                gangnam: "9bdd9fbe-4c4b-485b-b750-705c8faf3bda",
                daehakro: "63b0a84d-5379-48e4-b378-7289a627d31d"
            }
        };

        // --- Icons Definition (Manual SVG to avoid dependency issues) ---
        const Icons = {
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            RefreshCcw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>,
            DollarSign: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            ShoppingBag: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
            Target: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            ArrowUpRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 7h10v10"/><path d="M7 17 17 7"/></svg>,
            ArrowDownRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7 7 10 10"/><path d="M17 7v10H7"/></svg>,
            LogOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
        };

        const THEME = {
            primary: '#1e3a8a', secondary: '#2563eb', accent: '#0ea5e9', success: '#10b981',
            warning: '#f59e0b', danger: '#ef4444', bg: '#f1f5f9', card: '#ffffff', text: '#1e293b'
        };

        // --- Logic Helpers ---
        const fetchCsv = (url) => {
            return new Promise((resolve) => {
                if (!url) { resolve([]); return; }
                Papa.parse(url, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => resolve(results.data),
                    error: (err) => { console.error("Fetch Error", err); resolve([]); }
                });
            });
        };

        const getDateRange = (period) => {
            const end = new Date();
            const start = new Date();
            if (period === '7days') start.setDate(end.getDate() - 7);
            else if (period === '30days') start.setDate(end.getDate() - 30);
            else if (period === 'month') start.setDate(1);
            return { start, end };
        };

        // --- Components ---
        const FilterBar = ({ filter, setFilter, onRefresh, isLoading }) => {
            const periods = [{ id: 'today', label: '오늘' }, { id: '7days', label: '최근 7일' }, { id: '30days', label: '최근 30일' }, { id: 'month', label: '이번 달' }];
            return (
                <div className="bg-white border-b border-slate-200 p-4 flex flex-col lg:flex-row lg:items-center justify-between gap-4 sticky top-0 z-40 shadow-sm">
                    <div className="flex items-center gap-2 overflow-x-auto">
                        <div className="flex items-center text-slate-500 text-sm font-bold mr-2"><Icons.Calendar className="w-4 h-4 mr-1"/> 기간</div>
                        <div className="flex bg-slate-100 p-1 rounded-lg">
                            {periods.map(p => (
                                <button key={p.id} onClick={() => setFilter({...filter, period: p.id})}
                                    className={`px-3 py-1.5 text-xs font-bold rounded-md transition whitespace-nowrap ${filter.period === p.id ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>
                                    {p.label}
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="flex items-center gap-4">
                         <label className="flex items-center gap-2 cursor-pointer group">
                             <div className="relative">
                                 <input type="checkbox" className="sr-only" checked={filter.compare} onChange={() => setFilter({...filter, compare: !filter.compare})} />
                                 <div className={`w-10 h-5 rounded-full shadow-inner transition ${filter.compare ? 'bg-green-500' : 'bg-slate-300'}`}></div>
                                 <div className={`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transform transition ${filter.compare ? 'translate-x-5' : ''}`}></div>
                             </div>
                             <span className={`text-xs font-bold ${filter.compare ? 'text-green-600' : 'text-slate-500'}`}>비교</span>
                         </label>
                         <button onClick={onRefresh} className="p-2 bg-slate-100 hover:bg-blue-50 rounded-full transition text-slate-600 hover:text-blue-600">
                            <Icons.RefreshCcw className={`w-4 h-4 ${isLoading ? 'animate-spin' : ''}`}/>
                         </button>
                    </div>
                </div>
            );
        };

        const StatCard = ({ label, value, trend, subValue, icon: Icon, color = "blue", compareMode }) => {
            const isPositive = trend >= 0;
            const trendColor = isPositive ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50';
            const bgColors = { blue: 'bg-blue-50 text-blue-600', indigo: 'bg-indigo-50 text-indigo-600', green: 'bg-green-50 text-green-600', orange: 'bg-orange-50 text-orange-600' };
            return (
                <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all">
                    <div className="flex justify-between items-start mb-4">
                        <div className={`p-3 rounded-lg ${bgColors[color]}`}><Icon className="w-6 h-6" /></div>
                        {compareMode && <div className={`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold ${trendColor}`}>
                            {isPositive ? <Icons.ArrowUpRight className="w-3 h-3"/> : <Icons.ArrowDownRight className="w-3 h-3"/>} {Math.abs(trend)}%
                        </div>}
                    </div>
                    <div>
                        <h4 className="text-slate-500 text-xs font-bold uppercase tracking-wide mb-1">{label}</h4>
                        <h2 className="text-2xl font-bold text-slate-800">{value}</h2>
                        {compareMode && subValue && <p className="text-xs text-slate-400 mt-1">vs {subValue} (직전)</p>}
                    </div>
                </div>
            );
        };

        // --- Main App ---
        function App() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [mode, setMode] = useState('PARTNER');
            const [selectedStore, setSelectedStore] = useState('gangnam');
            const [filter, setFilter] = useState({ period: '30days', granularity: 'day', compare: true });
            
            const [dataState, setDataState] = useState({
                isLoading: false,
                chartData: [],
                kpi: { sales: 0, prevSales: 0, orders: 0, prevOrders: 0, profit: 0, ticket: 0 },
                menuData: [],
                cctvFunnel: []
            });

            // --- Data Processing ---
            const processData = useCallback((rawData, period, storeId) => {
                const { start, end } = getDateRange(period);
                const duration = end - start;
                const prevStart = new Date(start.getTime() - duration);
                const prevEnd = new Date(end.getTime() - duration);
                
                const filterSales = (data, s, e) => {
                    if (!data) return [];
                    return data.filter(row => {
                        const d = new Date(row.business_date);
                        return d >= s && d <= e && row.order_status === 'PAID';
                    });
                };

                const currentSales = filterSales(rawData.sales, start, end);
                const prevSales = filterSales(rawData.sales, prevStart, prevEnd);

                const sumSales = (arr) => arr.reduce((acc, cur) => acc + (Number(cur.sale_amt) || 0), 0);
                const totalSales = sumSales(currentSales);
                const prevTotalSales = sumSales(prevSales);
                
                const chartMap = {};
                let loop = new Date(start);
                while(loop <= end) {
                    const k = loop.toISOString().split('T')[0];
                    chartMap[k] = { date: k.substring(5), current: 0, comparison: 0 };
                    loop.setDate(loop.getDate() + 1);
                }
                currentSales.forEach(r => { if(chartMap[r.business_date]) chartMap[r.business_date].current += (Number(r.sale_amt) || 0); });
                prevSales.forEach(r => {
                    const d = new Date(r.business_date);
                    const diff = d - prevStart;
                    const targetDate = new Date(start.getTime() + diff);
                    const k = targetDate.toISOString().split('T')[0];
                    if(chartMap[k]) chartMap[k].comparison += (Number(r.sale_amt) || 0);
                });

                // Menu
                const menuMap = {};
                const currentMenu = (rawData.menu || []).filter(row => {
                    const d = new Date(row.created_at);
                    return d >= start && d <= end;
                });
                currentMenu.forEach(row => {
                    const name = row.product_name;
                    if(name) menuMap[name] = (menuMap[name] || 0) + (Number(row.quantity) || 1);
                });
                const menuList = Object.entries(menuMap).map(([name, value]) => ({ name, value })).sort((a,b) => b.value - a.value).slice(0, 5);

                // CCTV
                const targetUUID = CONFIG.storeIds[storeId];
                const cctvFiltered = (rawData.cctv || []).filter(row => {
                    const d = new Date(row.place_enter_daily);
                    return d >= start && d <= end && row.place === targetUUID;
                });
                let traffic = 0, visit = 0;
                cctvFiltered.forEach(row => {
                    const count = Number(row.total_count) || 0;
                    if (row.widget_name === '유동인구') traffic += count;
                    else if (row.widget_name === '매장 방문') visit += count;
                });
                if (traffic === 0 && visit === 0) { traffic = 12500; visit = 450; }

                return {
                    chartData: Object.values(chartMap).sort((a,b) => a.date.localeCompare(b.date)),
                    kpi: {
                        sales: totalSales,
                        prevSales: prevTotalSales,
                        orders: currentSales.length,
                        prevOrders: prevSales.length,
                        profit: totalSales * 0.28,
                        ticket: currentSales.length ? Math.round(totalSales / currentSales.length) : 0
                    },
                    menuData: menuList,
                    cctvFunnel: [
                        { value: traffic, name: '유동인구', fill: '#cbd5e1' },
                        { value: visit, name: '매장방문', fill: '#2563eb' },
                        { value: currentSales.length, name: '실구매', fill: '#1e3a8a' }
                    ]
                };
            }, []);

            const fetchData = async () => {
                setDataState(prev => ({ ...prev, isLoading: true }));
                try {
                    const [sales, menu, cctv] = await Promise.all([
                        fetchCsv(CONFIG.urls[selectedStore].sales),
                        fetchCsv(CONFIG.urls[selectedStore].menu),
                        fetchCsv(CONFIG.urls.cctv)
                    ]);
                    
                    const processed = processData({ sales, menu, cctv }, filter.period, selectedStore);
                    setDataState({ isLoading: false, ...processed });
                } catch (e) {
                    console.error(e);
                    setDataState(prev => ({ ...prev, isLoading: false }));
                    alert("데이터 로딩 중 오류가 발생했습니다.");
                }
            };

            useEffect(() => { if(isLoggedIn) fetchData(); }, [isLoggedIn, filter, selectedStore]);

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-900 font-[Pretendard]">
                    <div className="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-md text-center">
                        <div className="inline-block p-4 rounded-full bg-blue-50 text-blue-600 mb-4"><Icons.Zap className="w-8 h-8"/></div>
                        <h1 className="text-2xl font-bold text-slate-900 mb-2">RestoGenie V3.5</h1>
                        <p className="text-slate-500 mb-8">Fixed & Stable Version</p>
                        <form onSubmit={(e) => { e.preventDefault(); setIsLoggedIn(true); }} className="space-y-4">
                            <input type="text" defaultValue="slamburger01" className="w-full p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"/>
                            <input type="password" defaultValue="password" className="w-full p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"/>
                            <button className="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">로그인</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 font-[Pretendard]">
                    {dataState.isLoading && <div className="loading-overlay"><div className="spinner"></div><span className="text-slate-600 font-bold">데이터 동기화 중...</span></div>}
                    <header className="bg-slate-900 text-white h-16 flex items-center justify-between px-6 shadow-lg z-50 sticky top-0">
                        <div className="flex items-center gap-3">
                            <div className="bg-blue-600 p-1.5 rounded text-white font-bold"><Icons.Zap className="w-5 h-5"/></div>
                            <span className="font-bold text-lg tracking-wide">RestoGenie <span className="text-blue-400 text-xs ml-1">v3.5 Fixed</span></span>
                        </div>
                        <div className="flex items-center gap-4">
                             <select value={selectedStore} onChange={(e) => setSelectedStore(e.target.value)} className="bg-slate-800 text-white text-xs font-bold py-1 px-3 rounded border border-slate-700 outline-none">
                                <option value="gangnam">강남점 (직영)</option>
                                <option value="daehakro">대학로점 (가맹)</option>
                             </select>
                             <button onClick={() => setMode(mode === 'HQ' ? 'PARTNER' : 'HQ')} className="text-xs text-blue-400 hover:underline">{mode === 'HQ' ? '본사 모드' : '점주 모드'}</button>
                             <button onClick={() => setIsLoggedIn(false)} className="text-slate-400 hover:text-white"><Icons.LogOut className="w-5 h-5"/></button>
                        </div>
                    </header>

                    <FilterBar filter={filter} setFilter={setFilter} onRefresh={fetchData} isLoading={dataState.isLoading} />

                    <main className="max-w-7xl mx-auto p-6 space-y-6 animate-fade-in">
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <StatCard label="기간 매출" value={`₩${dataState.kpi.sales.toLocaleString()}`} subValue={`₩${dataState.kpi.prevSales.toLocaleString()}`} trend={dataState.kpi.prevSales ? Math.round(((dataState.kpi.sales - dataState.kpi.prevSales)/dataState.kpi.prevSales)*100) : 0} icon={Icons.DollarSign} color="blue" compareMode={filter.compare} />
                            <StatCard label="기간 주문수" value={`${dataState.kpi.orders.toLocaleString()}건`} subValue={`${dataState.kpi.prevOrders.toLocaleString()}건`} trend={dataState.kpi.prevOrders ? Math.round(((dataState.kpi.orders - dataState.kpi.prevOrders)/dataState.kpi.prevOrders)*100) : 0} icon={Icons.ShoppingBag} color="indigo" compareMode={filter.compare} />
                            <StatCard label="공헌이익 (추정)" value={`₩${Math.round(dataState.kpi.profit).toLocaleString()}`} trend={0} icon={Icons.Target} color="green" />
                            <StatCard label="객단가" value={`₩${dataState.kpi.ticket.toLocaleString()}`} trend={0} icon={Icons.Users} color="orange" />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-2 bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="font-bold text-slate-800 text-lg">매출 추이</h3>
                                    <div className="flex items-center gap-2 text-xs font-bold">
                                        <div className="flex items-center gap-1"><div className="w-3 h-3 rounded-full bg-blue-600"></div>현재</div>
                                        {filter.compare && <div className="flex items-center gap-1"><div className="w-3 h-3 rounded-full bg-slate-300"></div>직전</div>}
                                    </div>
                                </div>
                                <div className="h-80">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ComposedChart data={dataState.chartData} margin={{top: 10, right: 10, left: 0, bottom: 0}}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                            <XAxis dataKey="date" axisLine={false} tickLine={false} tick={{fontSize: 12, fill: '#94a3b8'}} dy={10} />
                                            <YAxis axisLine={false} tickLine={false} tick={{fontSize: 12, fill: '#94a3b8'}} width={40} />
                                            <Tooltip contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'}} />
                                            {filter.compare && <Line type="monotone" dataKey="comparison" stroke="#cbd5e1" strokeWidth={2} strokeDasharray="5 5" dot={false} />}
                                            <Line type="monotone" dataKey="current" stroke="#2563eb" strokeWidth={3} dot={{r: 3}} activeDot={{r: 6}} />
                                            <Area type="monotone" dataKey="current" fill="#dbeafe" stroke="none" fillOpacity={0.3} />
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                                <h3 className="font-bold text-slate-800 text-lg mb-4">판매량 Top 5 메뉴</h3>
                                <div className="flex-1 min-h-[200px]">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie data={dataState.menuData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                                                {dataState.menuData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={[THEME.primary, THEME.secondary, THEME.accent, '#94a3b8', '#cbd5e1'][index % 5]} />
                                                ))}
                                            </Pie>
                                            <Tooltip />
                                            <Legend verticalAlign="bottom" />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                            
                            <div className="lg:col-span-3 bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                <div className="flex justify-between items-center mb-4">
                                    <div>
                                        <h3 className="font-bold text-slate-800 text-lg">매장 유입 퍼널 (CCTV)</h3>
                                        <p className="text-xs text-slate-500 mt-1">유동인구 → 매장방문 → 실구매 전환율 분석</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-sm font-bold text-blue-600">
                                            구매 전환율 {dataState.cctvFunnel[1]?.value ? ((dataState.cctvFunnel[2].value / dataState.cctvFunnel[1].value) * 100).toFixed(1) : 0}%
                                        </p>
                                    </div>
                                </div>
                                <div className="h-64 w-full">
                                     <ResponsiveContainer width="100%" height="100%">
                                        <FunnelChart>
                                            <Tooltip />
                                            <Funnel data={dataState.cctvFunnel} dataKey="value" isAnimationActive labelLine={false}>
                                                <LabelList position="right" fill="#000" stroke="none" dataKey="name" />
                                            </Funnel>
                                        </FunnelChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
