<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoGenie Partner</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/recharts@2.12.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .toggle-checkbox:checked { right: 0; border-color: #2563eb; }
        .toggle-checkbox:checked + .toggle-label { background-color: #2563eb; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { PieChart, Pie, Cell, ResponsiveContainer } = Recharts;

        const API_KEY = "AIzaSyCILSrQKjRiupRcyNd1pFJUksNMkGVY8AQ";
        const CONTEXT = `
        [매장: 슬램버거 강남점]
        1. 10월 실적: 매출 9,885만원. 목표 달성했으나 성장 정체.
        2. 본사 알림: 양상추 원가 폭등. '스마트팜 양상추' 도입 예정.
        3. 매뉴얼: 갈비버거 소스 25g 정량 준수 필수.
        `;

        // Chatbot Component
        const Chatbot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([{ role: 'model', text: '사장님, 안녕하세요! 무엇을 도와드릴까요?' }]);
            const [input, setInput] = useState('');
            const scrollRef = useRef(null);

            useEffect(() => { if(scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [messages]);

            const send = async () => {
                if (!input.trim()) return;
                const msg = input;
                setMessages(prev => [...prev, { role: 'user', text: msg }]);
                setInput('');

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: `Context:\n${CONTEXT}\n\nUser: ${msg}\n\nAnswer as a AI Manager.` }] }] })
                    });
                    const data = await res.json();
                    const text = data.candidates[0].content.parts[0].text;
                    setMessages(prev => [...prev, { role: 'model', text }]);
                } catch (e) {
                    setMessages(prev => [...prev, { role: 'model', text: '오류가 발생했습니다.' }]);
                }
            };

            if(!isOpen) return <button onClick={()=>setIsOpen(true)} className="fixed bottom-24 right-4 bg-blue-600 text-white p-4 rounded-full shadow-xl z-50"><i data-lucide="message-circle"></i></button>;

            return (
                <div className="fixed inset-0 z-50 bg-white flex flex-col md:bottom-24 md:right-4 md:w-96 md:h-[500px] md:rounded-2xl md:shadow-2xl md:border">
                    <div className="bg-blue-600 text-white p-4 flex justify-between items-center">
                        <span className="font-bold flex gap-2"><i data-lucide="bot"></i> 슬램지니</span>
                        <button onClick={()=>setIsOpen(false)}><i data-lucide="x"></i></button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 bg-slate-50" ref={scrollRef}>
                        {messages.map((m, i) => (
                            <div key={i} className={`flex mb-2 ${m.role==='user'?'justify-end':'justify-start'}`}>
                                <div className={`px-4 py-2 rounded-xl max-w-[80%] text-sm ${m.role==='user'?'bg-blue-600 text-white':'bg-white border text-slate-800'}`}>{m.text}</div>
                            </div>
                        ))}
                    </div>
                    <div className="p-3 border-t flex gap-2">
                        <input className="flex-1 border rounded-xl px-4 py-2 outline-none" placeholder="질문 입력..." value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} />
                        <button onClick={send} className="bg-blue-600 text-white p-2 rounded-xl"><i data-lucide="send"></i></button>
                    </div>
                </div>
            );
        };

        // App Component
        const App = () => {
            const [tab, setTab] = useState('home');
            useEffect(() => { lucide.createIcons(); }, [tab]);

            return (
                <div className="bg-slate-50 min-h-screen max-w-md mx-auto shadow-xl relative pb-24">
                    {/* Header */}
                    <div className="bg-blue-600 pt-12 pb-16 px-6 rounded-b-[2.5rem] text-white shadow-lg relative">
                        <div className="flex items-center gap-2 mb-2 opacity-90"><span className="bg-white/20 px-2 py-0.5 rounded text-xs font-bold">AI 비서</span><span className="text-xs">오늘의 브리핑</span></div>
                        <h2 className="text-2xl font-bold">안녕하세요, 강남점주님!</h2>
                        <div className="mt-4 bg-white/10 backdrop-blur p-4 rounded-2xl border border-white/20 text-sm space-y-2">
                            <div className="flex gap-2"><i data-lucide="trending-up" className="text-green-300 w-4 h-4"></i> 목표 매출 105% 달성!</div>
                            <div className="flex gap-2"><i data-lucide="alert-triangle" className="text-yellow-300 w-4 h-4"></i> 양상추 원가 상승 주의</div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="px-6 -mt-8 grid grid-cols-2 gap-4 relative z-10">
                        <div className="bg-white p-5 rounded-2xl shadow-md"><p className="text-slate-400 text-xs font-bold mb-1">실시간 매출</p><h3 className="text-xl font-bold">₩385,000</h3></div>
                        <div className="bg-white p-5 rounded-2xl shadow-md"><p className="text-slate-400 text-xs font-bold mb-1">이번달 순수익</p><h3 className="text-xl font-bold text-blue-600">₩2,150만</h3></div>
                    </div>

                    {/* Charts & Content */}
                    <div className="px-6 mt-6 space-y-6">
                        <div className="bg-white p-6 rounded-3xl shadow-sm">
                            <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="pie-chart" className="text-blue-500 w-5 h-5"></i> 수익성 분석</h3>
                            <div className="h-48">
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie data={[{name:'재료',value:36.5,fill:'#3b82f6'},{name:'이익',value:21.7,fill:'#22c55e'},{name:'기타',value:41.8,fill:'#e2e8f0'}]} innerRadius={50} outerRadius={70} dataKey="value" />
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>
                            <div className="flex justify-center gap-4 text-xs text-slate-500">
                                <span className="flex items-center gap-1"><div className="w-2 h-2 bg-blue-500 rounded-full"></div> 원가 36.5%</span>
                                <span className="flex items-center gap-1"><div className="w-2 h-2 bg-green-500 rounded-full"></div> 이익 21.7%</span>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-3xl shadow-sm">
                            <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="zap" className="text-yellow-500 w-5 h-5"></i> 원클릭 자동화</h3>
                            <div className="flex justify-between items-center py-3 border-b border-slate-50">
                                <div><p className="font-bold text-slate-700">배달 광고 최적화</p><p className="text-xs text-slate-400">효율 낮은 키워드 자동 OFF</p></div>
                                <div className="relative w-12 h-6"><input type="checkbox" defaultChecked className="toggle-checkbox absolute w-6 h-6 bg-white border-4 rounded-full transition-all duration-300 right-0 border-blue-600"/><div className="w-full h-full bg-blue-600 rounded-full"></div></div>
                            </div>
                        </div>
                    </div>
                    
                    <Chatbot />

                    {/* Bottom Nav */}
                    <nav className="fixed bottom-0 w-full max-w-md bg-white border-t flex justify-around py-3 z-40 rounded-t-2xl pb-safe shadow-[0_-5px_10px_rgba(0,0,0,0.02)]">
                        {['home','pie-chart','zap','menu'].map((icon, i) => (
                            <button key={i} onClick={()=>setTab(icon)} className={`flex flex-col items-center gap-1 ${tab===icon?'text-blue-600':'text-slate-300'}`}>
                                <i data-lucide={icon} className="w-6 h-6"></i>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
