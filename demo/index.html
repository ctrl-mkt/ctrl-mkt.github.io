<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoGenie - Partner Dashboard</title>
    
    <!-- Fonts -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <style>
        body { font-family: "Pretendard Variable", Pretendard, sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .fade-in { animation: fadeIn 0.3s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden-force { display: none !important; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { slate: { 850: '#172033', 900: '#0f172a', 950: '#020617' } }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-200 overflow-hidden h-screen w-screen selection:bg-blue-500/30">

    <!-- LOGIN SCREEN -->
    <div id="login-view" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-950 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black">
        <div class="bg-slate-900/80 border border-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md backdrop-blur-md fade-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-indigo-600 rounded-xl mx-auto flex items-center justify-center mb-4">
                    <i data-lucide="sparkles" class="text-white w-8 h-8"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">RestoGenie</h1>
                <p class="text-slate-400">ê°€ë§¹ì ì£¼ ì „ìš© íŒŒíŠ¸ë„ˆ ì„¼í„°</p>
            </div>
            <div class="space-y-4">
                <input type="text" id="login-id" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ì•„ì´ë””">
                <input type="password" id="login-pw" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ë¹„ë°€ë²ˆí˜¸">
                <button onclick="app.login()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3.5 rounded-lg transition-all mt-2">ë¡œê·¸ì¸</button>
            </div>
            <div class="mt-6 text-center">
                <button onclick="app.fillLogin('partner', 'ctrlm2025!')" class="text-sm text-indigo-400 hover:underline">ì ì£¼(Partner) ì²´í—˜ ê³„ì • ìë™ ì…ë ¥</button>
            </div>
        </div>
    </div>

    <!-- DASHBOARD LAYOUT -->
    <div id="dashboard-view" class="hidden-force flex h-full w-full">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col transition-all duration-300 absolute lg:relative h-full z-40 -translate-x-full lg:translate-x-0">
            <div class="h-16 flex items-center px-6 border-b border-slate-800 flex-shrink-0">
                <i data-lucide="store" class="text-indigo-500 w-6 h-6 mr-3"></i>
                <span class="text-lg font-bold text-white tracking-tight">Partner Center</span>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar" id="sidebar-menu">
                <!-- Menu Injected -->
            </div>

            <div class="p-4 bg-slate-850 border-t border-slate-800 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-bold text-white">PT</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-bold text-white">ë°•ìš”í•œ ì ì£¼</p>
                        <p class="text-xs text-slate-400">ê°•ë‚¨ì </p>
                    </div>
                    <button onclick="location.reload()" class="text-slate-500 hover:text-white"><i data-lucide="log-out" class="w-4 h-4"></i></button>
                </div>
            </div>
        </aside>

        <!-- Mobile Overlay -->
        <div id="mobile-overlay" onclick="document.getElementById('sidebar').classList.add('-translate-x-full'); this.classList.add('hidden')" class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden backdrop-blur-sm"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0 bg-slate-950 h-full relative">
            
            <!-- Header -->
            <header class="h-16 bg-slate-900/90 backdrop-blur border-b border-slate-800 flex items-center justify-between px-4 lg:px-8 sticky top-0 z-20">
                <div class="flex items-center gap-4">
                    <button onclick="document.getElementById('sidebar').classList.remove('-translate-x-full'); document.getElementById('mobile-overlay').classList.remove('hidden')" class="lg:hidden text-slate-400"><i data-lucide="menu"></i></button>
                    <h2 id="page-title" class="text-lg font-bold text-white flex items-center gap-2">ë‚´ ë§¤ì¥ í™ˆ</h2>
                </div>

                <div class="flex items-center gap-4">
                    <div class="text-sm text-slate-400 hidden md:block">
                        <span class="text-indigo-400 font-bold">ê°•ë‚¨ì </span> ì˜ì—…ì¤‘ <span class="text-green-400">â—</span>
                    </div>
                    <div onclick="app.openAdModal()" class="flex items-center gap-2 px-3 py-1.5 bg-slate-800 rounded-full border border-slate-700 cursor-pointer hover:border-indigo-500 transition-colors">
                        <i data-lucide="coins" class="w-4 h-4 text-amber-400"></i>
                        <span id="coin-disp" class="text-sm font-bold text-white">100</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main id="main-content" class="flex-1 overflow-y-auto p-4 lg:p-8 custom-scrollbar relative">
                <!-- Dynamic Content -->
            </main>

        </div>
    </div>

    <!-- AI Modal -->
    <div id="ai-modal" class="hidden-force fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-3xl h-[85vh] rounded-2xl shadow-2xl flex flex-col">
            <div class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-850 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <i data-lucide="sparkles" class="w-5 h-5 text-indigo-400"></i>
                    <h3 class="text-lg font-bold text-white">AI ë§¤ì¥ ì ê²€ ë¦¬í¬íŠ¸</h3>
                </div>
                <button onclick="document.getElementById('ai-modal').classList.add('hidden-force')" class="text-slate-400 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div id="ai-content-area" class="flex-1 overflow-y-auto p-6 custom-scrollbar bg-slate-900 text-slate-300 leading-relaxed"></div>
        </div>
    </div>

    <!-- Ad Modal -->
    <div id="ad-modal" class="hidden-force fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center">
            <h3 class="text-lg font-bold text-slate-900 mb-4">ì½”ì¸ ì¶©ì „ì†Œ</h3>
            <div class="aspect-video bg-slate-100 rounded-xl mb-4 flex items-center justify-center"><i data-lucide="play-circle" class="w-12 h-12 text-slate-300"></i></div>
            <div class="h-2 bg-slate-200 rounded-full mb-4"><div id="ad-progress" class="h-full bg-indigo-600 w-0 transition-all duration-100"></div></div>
            <button id="ad-close-btn" disabled onclick="app.completeAd()" class="w-full py-3 rounded-lg font-bold bg-slate-200 text-slate-400">ê´‘ê³  ì‹œì²­ ì¤‘...</button>
        </div>
    </div>

    <!-- Chat Widget -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        <div id="chat-box" class="hidden-force w-80 md:w-96 h-[500px] bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl flex flex-col mb-4 overflow-hidden">
            <div class="bg-indigo-600 p-4 flex justify-between items-center">
                <span class="text-white font-bold flex items-center gap-2"><i data-lucide="bot" class="w-5 h-5"></i> Partner AI</span>
                <button onclick="document.getElementById('chat-box').classList.add('hidden-force')"><i data-lucide="x" class="w-5 h-5 text-white/80"></i></button>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-900 custom-scrollbar">
                <div class="flex justify-start"><div class="bg-slate-800 text-slate-200 p-3 rounded-2xl rounded-tl-none text-sm max-w-[90%] border border-slate-700">ì ì£¼ë‹˜ ì•ˆë…•í•˜ì„¸ìš”! ë§¤ì¥ ìš´ì˜ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”. (ì˜ˆ: ì´ë²ˆ ì£¼ ìˆœì´ìµì€?)</div></div>
            </div>
            <div class="p-3 bg-slate-850 border-t border-slate-800 flex gap-2">
                <input id="chat-input" type="text" class="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:border-indigo-500 outline-none" placeholder="ì§ˆë¬¸ ì…ë ¥..." onkeypress="if(event.key==='Enter') app.sendMessage()">
                <button onclick="app.sendMessage()" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-500"><i data-lucide="send" class="w-4 h-4"></i></button>
            </div>
        </div>
        <button onclick="document.getElementById('chat-box').classList.toggle('hidden-force')" class="bg-indigo-600 hover:bg-indigo-500 text-white p-4 rounded-full shadow-xl transition-transform hover:scale-105">
            <i data-lucide="message-square" class="w-6 h-6"></i>
        </button>
    </div>

    <script>
        // Config - UPDATED MODEL NAME
        const GEMINI_KEY = "AIzaSyCILSrQKjRiupRcyNd1pFJUksNMkGVY8AQ"; 
        const MODEL_NAME = "gemini-2.5-flash-preview-09-2025"; 

        // Mock Data for Gangnam Store
        const DB = {
            store: "ê°•ë‚¨ì ",
            sales: {
                daily: [1817700, 1546200, 1982900, 1602400, 2546200, 2897600, 1508700],
                dates: ['11/10(ì›”)', '11/11(í™”)', '11/12(ìˆ˜)', '11/13(ëª©)', '11/14(ê¸ˆ)', '11/15(í† )', '11/16(ì¼)'],
                total: 13899500,
                profit: 3474875, // ~25%
                cost: 4864825, // ~35%
                delivery_cost: 2084925, // ~15%
                fees: 3474875 // ~25%
            },
            menus: [
                { name: 'ë” í¬ë¦¬ìŠ¤í”¼ ê°ˆë¹„ ë²„ê±° SET', qty: 450, sales: 4365000, margin: 'High' },
                { name: 'ë” ë¹„í”„ ë²„ê±° SET', qty: 380, sales: 3686000, margin: 'Mid' },
                { name: 'ì¹˜ì¦ˆë²„ê±° SET', qty: 210, sales: 1869000, margin: 'Mid' },
                { name: 'ë§¥ì•¤ì¹˜ì¦ˆ ë²„ê±°', qty: 150, sales: 1185000, margin: 'Low' }
            ],
            reviews: [
                { user: 'ë§›ìˆìœ¼ë©´ì§–ëŠ”ê°œ', rating: 5, date: '2025-11-16', content: 'ê°ˆë¹„ë²„ê±° ì§„ì§œ ë¯¸ì³¤ë„¤ìš”.. ìœ¡ì¦™ ëŒ€ë°•ì…ë‹ˆë‹¤ ğŸ¶', reply: false },
                { user: 'ë²„ê±°í‚¹ë§Œë¨¹ìŒ', rating: 4, date: '2025-11-15', content: 'ë§›ì€ ìˆëŠ”ë° ë°°ë‹¬ì´ ì¢€ ì‹ì–´ì„œ ì™”ì–´ìš”. í¬ì¥ì— ì‹ ê²½ì¨ì£¼ì„¸ìš”.', reply: true },
                { user: 'ì†Œì‹ì¢Œ', rating: 5, date: '2025-11-14', content: 'ì–‘ì´ ì§„ì§œ ë§ì•„ìš”! ê°íŠ€ ë‚¨ê²¼ìŠµë‹ˆë‹¤ ã… ã…  ë²ˆì°½í•˜ì„¸ìš”', reply: false }
            ]
        };

        const app = {
            coins: 100,
            
            init() {
                lucide.createIcons();
            },

            fillLogin(id, pw) {
                document.getElementById('login-id').value = id;
                document.getElementById('login-pw').value = pw;
            },

            login() {
                const id = document.getElementById('login-id').value;
                if(id !== 'partner') return alert('ë³¸ í˜ì´ì§€ëŠ” ì ì£¼(Partner) ê³„ì • ì „ìš©ì…ë‹ˆë‹¤.');
                
                document.getElementById('login-view').classList.add('hidden-force');
                document.getElementById('dashboard-view').classList.remove('hidden-force');
                
                this.renderMenu();
                this.loadPage('home');
            },

            renderMenu() {
                const menuItems = [
                    { id: 'home', icon: 'layout-dashboard', label: 'ë‚´ ë§¤ì¥ í™ˆ' },
                    { id: 'sales', icon: 'dollar-sign', label: 'ë§¤ì¶œ/ì†ìµ' },
                    { id: 'menu', icon: 'shopping-bag', label: 'ë©”ë‰´ ë¶„ì„' },
                    { id: 'reviews', icon: 'message-square', label: 'ë¦¬ë·° ê´€ë¦¬' },
                    { id: 'ai_consult', icon: 'file-text', label: 'AI ë§¤ì¥ ì»¨ì„¤íŒ…', highlight: true }
                ];
                
                const html = menuItems.map(item => `
                    <button onclick="app.loadPage('${item.id}')" id="btn-${item.id}" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl ${item.highlight ? 'text-indigo-400 hover:bg-indigo-500/10' : 'text-slate-400 hover:bg-slate-800 hover:text-white'} transition-all group">
                        <i data-lucide="${item.icon}" class="w-5 h-5 ${item.highlight ? '' : 'group-hover:text-indigo-400'}"></i>
                        <span class="font-medium">${item.label}</span>
                    </button>
                `).join('');
                
                document.getElementById('sidebar-menu').innerHTML = html;
                lucide.createIcons();
            },

            loadPage(pageId) {
                // Active State
                document.querySelectorAll('#sidebar-menu button').forEach(b => {
                    if(!b.innerHTML.includes('AI ë§¤ì¥ ì»¨ì„¤íŒ…')) b.className = b.className.replace('bg-indigo-600/10 text-indigo-400', 'text-slate-400');
                });
                const btn = document.getElementById(`btn-${pageId}`);
                if(btn && pageId !== 'ai_consult') btn.className = btn.className.replace('text-slate-400', 'bg-indigo-600/10 text-indigo-400');

                const main = document.getElementById('main-content');
                const title = document.getElementById('page-title');
                const titles = { home: 'ë‚´ ë§¤ì¥ í™ˆ', sales: 'ë§¤ì¶œ ë° ì†ìµ ë¶„ì„', menu: 'ë©”ë‰´ ì—”ì§€ë‹ˆì–´ë§', reviews: 'ê³ ê° ë¦¬ë·° ê´€ë¦¬' };
                if(titles[pageId]) title.innerText = titles[pageId];

                if(pageId === 'home') {
                    main.innerHTML = this.getHomeHTML();
                    this.renderHomeCharts();
                } else if(pageId === 'sales') {
                    main.innerHTML = this.getSalesHTML();
                    this.renderSalesCharts();
                } else if(pageId === 'menu') {
                    main.innerHTML = this.getMenuHTML();
                    this.renderMenuCharts();
                } else if(pageId === 'reviews') {
                    main.innerHTML = this.getReviewsHTML();
                } else if(pageId === 'ai_consult') {
                    this.openAiModal();
                    // Return to previous page logic omitted for simplicity, stays on current
                }
                lucide.createIcons();
            },

            // --- HTML Generators ---

            getHomeHTML() {
                return `
                    <div class="space-y-6 fade-in pb-20">
                        <div class="bg-gradient-to-r from-indigo-900 to-slate-900 p-6 rounded-xl border border-indigo-500/30 shadow-lg flex justify-between items-center">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-1">ì˜¤ëŠ˜ë„ ëŒ€ë°•ë‚˜ì„¸ìš”, ì‚¬ì¥ë‹˜! ğŸ”¥</h3>
                                <p class="text-indigo-200 text-sm">í˜„ì¬ ëª©í‘œ ë§¤ì¶œ ë‹¬ì„±ë¥  <span class="font-bold text-white">92%</span> ì…ë‹ˆë‹¤.</p>
                            </div>
                            <div class="text-right hidden md:block">
                                <p class="text-slate-400 text-xs">ì‹¤ì‹œê°„ ì˜ˆìƒ ìˆœì´ìµ</p>
                                <p class="text-2xl font-bold text-white">â‚©345,000</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${this.card('ì˜¤ëŠ˜ ë§¤ì¶œ', '1,250,000ì›', 15.2, 'dollar-sign', 'indigo')}
                            ${this.card('ì£¼ë¬¸ ê±´ìˆ˜', '48ê±´', 8.5, 'shopping-bag', 'green')}
                            ${this.card('ê³ ê° í‰ì ', '4.9', 0.1, 'star', 'amber')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                                <h3 class="text-base font-bold text-white mb-4">ì£¼ê°„ ë§¤ì¶œ íŠ¸ë Œë“œ</h3>
                                <div id="chart-home-trend" class="h-[250px]"></div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                                    <h3 class="text-base font-bold text-white mb-3 flex items-center gap-2"><i data-lucide="bell" class="w-4 h-4 text-amber-400"></i> ì•Œë¦¼ í”¼ë“œ</h3>
                                    <div class="space-y-3">
                                        <div class="flex gap-3 text-sm p-2 bg-slate-800/50 rounded hover:bg-slate-800 transition-colors">
                                            <span class="text-amber-400 font-bold whitespace-nowrap">[ì¬ê³ ]</span>
                                            <span class="text-slate-300">ë¸Œë¦¬ì˜¤ìŠˆ ë²ˆ ì¬ê³ ê°€ 15ê°œ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ë°œì£¼ê°€ í•„ìš”í•©ë‹ˆë‹¤.</span>
                                        </div>
                                        <div class="flex gap-3 text-sm p-2 bg-slate-800/50 rounded hover:bg-slate-800 transition-colors">
                                            <span class="text-blue-400 font-bold whitespace-nowrap">[ë¦¬ë·°]</span>
                                            <span class="text-slate-300">ì‹ ê·œ ë³„ì  5ì  ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</span>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="app.openAiModal()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white p-4 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg transition-all transform hover:scale-[1.02]">
                                    <i data-lucide="file-text"></i> ë§¤ì¥ ì ê²€ ë¦¬í¬íŠ¸ ìƒì„± (1ì½”ì¸)
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            getSalesHTML() {
                return `
                    <div class="space-y-6 fade-in pb-20">
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-6">11ì›” ì†ìµ ê³„ì‚°ì„œ (ì¶”ì •)</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center pb-4 border-b border-slate-800">
                                    <span class="text-slate-400">ì´ ë§¤ì¶œì•¡</span>
                                    <span class="text-2xl font-bold text-white">â‚©${DB.sales.total.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm text-red-400">
                                    <span>(-) ì‹ìì¬ ì›ê°€ (35%)</span>
                                    <span>-â‚©${DB.sales.cost.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm text-red-400">
                                    <span>(-) ë°°ë‹¬ ëŒ€í–‰ë¹„ (15%)</span>
                                    <span>-â‚©${DB.sales.delivery_cost.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm text-red-400">
                                    <span>(-) í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ/ê¸°íƒ€ (25%)</span>
                                    <span>-â‚©${DB.sales.fees.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between items-center pt-4 border-t border-slate-700">
                                    <span class="text-indigo-400 font-bold">ì˜ì—… ì´ìµ (25%)</span>
                                    <span class="text-2xl font-bold text-indigo-400">â‚©${DB.sales.profit.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                            <h3 class="text-base font-bold text-white mb-4">ìš”ì¼ë³„ ë§¤ì¶œ/ì´ìµ ì¶”ì´</h3>
                            <div id="chart-sales-profit" class="h-[300px]"></div>
                        </div>
                    </div>
                `;
            },

            getMenuHTML() {
                return `
                    <div class="space-y-6 fade-in pb-20">
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                             <h3 class="text-base font-bold text-white mb-4">ë©”ë‰´ë³„ íŒë§¤ ì„±ê³¼ (Top 5)</h3>
                             <div id="chart-menu-bar" class="h-[300px]"></div>
                        </div>
                        
                        <div class="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                            <table class="w-full text-sm text-left text-slate-400">
                                <thead class="text-xs text-slate-500 uppercase bg-slate-850 border-b border-slate-800">
                                    <tr>
                                        <th class="px-6 py-3">ë©”ë‰´ëª…</th>
                                        <th class="px-6 py-3 text-right">íŒë§¤ìˆ˜ëŸ‰</th>
                                        <th class="px-6 py-3 text-right">ë§¤ì¶œì•¡</th>
                                        <th class="px-6 py-3 text-center">ìˆ˜ìµì„±</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${DB.menus.map(m => `
                                        <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                            <td class="px-6 py-4 font-medium text-white">${m.name}</td>
                                            <td class="px-6 py-4 text-right">${m.qty}ê°œ</td>
                                            <td class="px-6 py-4 text-right text-white">â‚©${m.sales.toLocaleString()}</td>
                                            <td class="px-6 py-4 text-center">
                                                <span class="px-2 py-1 rounded text-xs font-bold ${m.margin==='High'?'bg-green-500/20 text-green-400':m.margin==='Mid'?'bg-blue-500/20 text-blue-400':'bg-red-500/20 text-red-400'}">${m.margin}</span>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            },

            getReviewsHTML() {
                return `
                    <div class="space-y-4 fade-in pb-20">
                        ${DB.reviews.map(r => `
                            <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-white">${r.user}</span>
                                        <div class="flex text-amber-400 text-xs">
                                            ${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)}
                                        </div>
                                    </div>
                                    <span class="text-xs text-slate-500">${r.date}</span>
                                </div>
                                <p class="text-slate-300 text-sm mb-4 bg-slate-800/50 p-3 rounded-lg">${r.content}</p>
                                ${r.reply ? 
                                    `<div class="ml-4 pl-4 border-l-2 border-slate-700">
                                        <p class="text-xs text-indigo-400 font-bold mb-1">ì‚¬ì¥ë‹˜ ë‹µê¸€</p>
                                        <p class="text-xs text-slate-400">ì†Œì¤‘í•œ ë¦¬ë·° ê°ì‚¬í•©ë‹ˆë‹¤! ë‹¤ìŒì—” ë” ë”°ëœ»í•˜ê²Œ ë°°ë‹¬í•´ë“œë¦´ê²Œìš” :)</p>
                                    </div>` : 
                                    `<div class="flex justify-end gap-2">
                                        <button class="px-3 py-1.5 bg-slate-800 text-slate-300 text-xs rounded hover:bg-slate-700">ì§ì ‘ ì“°ê¸°</button>
                                        <button class="px-3 py-1.5 bg-indigo-600 text-white text-xs rounded hover:bg-indigo-500 flex items-center gap-1">
                                            <i data-lucide="sparkles" class="w-3 h-3"></i> AI ë‹µê¸€ ì¶”ì²œ
                                        </button>
                                    </div>`
                                }
                            </div>
                        `).join('')}
                    </div>
                `;
            },

            card(title, value, trend, icon, color) {
                const isPos = trend >= 0;
                const colors = { indigo: 'text-indigo-400 bg-indigo-500/10', green: 'text-green-400 bg-green-500/10', amber: 'text-amber-400 bg-amber-500/10' };
                return `
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-5 hover:border-slate-700 transition-colors">
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 text-xs font-bold uppercase">${title}</span>
                            <i data-lucide="${icon}" class="w-4 h-4 ${colors[color]}"></i>
                        </div>
                        <div class="flex items-end gap-2">
                            <h3 class="text-2xl font-bold text-white">${value}</h3>
                            <span class="text-xs ${isPos?'text-green-400':'text-red-400'} mb-1">${isPos?'+':''}${trend}%</span>
                        </div>
                    </div>
                `;
            },

            // --- Charts ---

            renderHomeCharts() {
                setTimeout(() => {
                    const options = {
                        series: [{ name: 'ë§¤ì¶œ', data: DB.sales.daily }],
                        chart: { type: 'area', height: '100%', toolbar: { show: false }, background: 'transparent', fontFamily: 'Pretendard' },
                        theme: { mode: 'dark' },
                        stroke: { curve: 'smooth', width: 2, colors: ['#6366f1'] },
                        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.5, opacityTo: 0.0, stops: [0, 90, 100] } },
                        dataLabels: { enabled: false },
                        xaxis: { categories: DB.sales.dates, labels: { style: { colors: '#94a3b8', fontSize: '10px' } }, axisBorder: { show: false }, axisTicks: { show: false } },
                        yaxis: { show: false },
                        grid: { show: false, padding: { left: 0, right: 0 } }
                    };
                    new ApexCharts(document.querySelector("#chart-home-trend"), options).render();
                }, 50);
            },

            renderSalesCharts() {
                setTimeout(() => {
                    const profitData = DB.sales.daily.map(v => Math.floor(v * 0.25));
                    const options = {
                        series: [{ name: 'ë§¤ì¶œ', type: 'column', data: DB.sales.daily }, { name: 'ìˆœì´ìµ', type: 'line', data: profitData }],
                        chart: { type: 'line', height: '100%', toolbar: { show: false }, background: 'transparent', fontFamily: 'Pretendard' },
                        theme: { mode: 'dark' },
                        plotOptions: { bar: { borderRadius: 4, columnWidth: '40%' } },
                        stroke: { width: [0, 3] },
                        colors: ['#334155', '#6366f1'],
                        xaxis: { categories: DB.sales.dates, labels: { style: { colors: '#94a3b8' } } },
                        yaxis: { labels: { style: { colors: '#94a3b8' }, formatter: v => (v/10000).toFixed(0) + 'ë§Œ' } },
                        legend: { position: 'top' },
                        grid: { borderColor: '#334155' }
                    };
                    new ApexCharts(document.querySelector("#chart-sales-profit"), options).render();
                }, 50);
            },

            renderMenuCharts() {
                setTimeout(() => {
                    const options = {
                        series: [{ data: DB.menus.map(m => m.sales) }],
                        chart: { type: 'bar', height: '100%', toolbar: { show: false }, background: 'transparent', fontFamily: 'Pretendard' },
                        theme: { mode: 'dark' },
                        plotOptions: { bar: { borderRadius: 4, horizontal: true, barHeight: '50%' } },
                        colors: ['#818cf8'],
                        dataLabels: { enabled: true, formatter: val => (val/10000).toFixed(0) + 'ë§Œì›', style: { colors: ['#fff'] } },
                        xaxis: { categories: DB.menus.map(m => m.name), labels: { show: false } },
                        yaxis: { labels: { style: { colors: '#e2e8f0' }, maxWidth: 200 } },
                        grid: { show: false }
                    };
                    new ApexCharts(document.querySelector("#chart-menu-bar"), options).render();
                }, 50);
            },

            // --- AI Report ---

            openAiModal() {
                document.getElementById('ai-modal').classList.remove('hidden-force');
                const content = document.getElementById('ai-content-area');
                content.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <div class="w-16 h-16 bg-indigo-600/10 rounded-full flex items-center justify-center mb-4">
                            <i data-lucide="clipboard-check" class="w-8 h-8 text-indigo-500"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">AI ë§¤ì¥ ì ê²€ ë¦¬í¬íŠ¸</h3>
                        <p class="text-slate-400 mb-6 text-sm">SV ë°©ë¬¸ ì „, ë§¤ì¶œ ë° ë¦¬ë·° ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬<br>ì˜ˆìƒ ì§ˆë¬¸ê³¼ ê°œì„  í¬ì¸íŠ¸ë¥¼ ë¯¸ë¦¬ í™•ì¸í•˜ì„¸ìš”.</p>
                        <button onclick="app.generateReport()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg shadow-indigo-500/20">
                            <i data-lucide="sparkles" class="w-4 h-4"></i> 1ì½”ì¸ìœ¼ë¡œ ë¦¬í¬íŠ¸ ìƒì„±
                        </button>
                    </div>
                `;
                lucide.createIcons();
            },

            async generateReport() {
                if (this.coins < 1) return app.openAdModal();
                
                this.coins -= 1;
                document.getElementById('coin-disp').innerText = this.coins;
                
                const content = document.getElementById('ai-content-area');
                content.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full">
                        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mb-4"></div>
                        <p class="text-white font-bold animate-pulse">AIê°€ ë§¤ì¥ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                        <p class="text-xs text-slate-500 mt-2">ë§¤ì¶œ ì¶”ì´ í™•ì¸ ì¤‘... ê³ ê° ë¦¬ë·° ê¸/ë¶€ì • ë¶„ì„ ì¤‘...</p>
                    </div>
                `;

                const prompt = `
                    [Context]
                    Role: Franchise Store Supervisor (SV)
                    Store: Gangnam Branch (Owner: Park Yo-han)
                    Data: ${JSON.stringify(DB)}
                    Goal: Create a store check-up report for the owner.
                    
                    [Format]
                    Output in Markdown (Korean).
                    1. **ì¹­ì°¬ í¬ì¸íŠ¸**: Find positive metrics (e.g. high sales on weekend, good review).
                    2. **ì£¼ìš” ì ê²€ ì‚¬í•­**: Analyze low profit items or negative reviews.
                    3. **ì´ë²ˆ ì£¼ ì•¡ì…˜ ì•„ì´í…œ**: Suggest 3 specific actions to improve sales/margin.
                    Tone: Encouraging, Professional.
                `;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${GEMINI_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    
                    const json = await response.json();
                    if(json.error) throw new Error(json.error.message);
                    
                    const text = json.candidates[0].content.parts[0].text;
                    const html = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong class="text-indigo-400">$1</strong>').replace(/## (.*?)(<br>|$)/g, '<h3 class="text-lg font-bold text-white mt-6 mb-2 border-b border-slate-700 pb-2">$1</h3>');
                    
                    content.innerHTML = `<div class="max-w-2xl mx-auto">${html}</div>`;

                } catch (e) {
                    content.innerHTML = `<div class="text-center text-red-400"><p class="font-bold mb-2">ì˜¤ë¥˜ ë°œìƒ</p><p class="text-sm">${e.message}</p><button onclick="app.openAiModal()" class="mt-4 bg-slate-800 px-4 py-2 rounded">ëŒì•„ê°€ê¸°</button></div>`;
                }
            },

            // --- Chatbot ---
            async sendMessage() {
                const input = document.getElementById('chat-input');
                const msg = input.value;
                if(!msg.trim()) return;
                
                const box = document.getElementById('chat-messages');
                box.innerHTML += `<div class="flex justify-end"><div class="bg-indigo-600 text-white p-3 rounded-2xl rounded-tr-none text-sm max-w-[90%] mb-2">${msg}</div></div>`;
                input.value = '';
                box.scrollTop = box.scrollHeight;

                try {
                    const prompt = `[System] You are a helpful AI assistant for a franchise store owner. Store Data: ${JSON.stringify(DB)}. User Question: ${msg}. Answer in Korean friendly.`;
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${GEMINI_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const json = await response.json();
                    
                    if(json.error) throw new Error(json.error.message);

                    const text = json.candidates[0].content.parts[0].text;
                    box.innerHTML += `<div class="flex justify-start"><div class="bg-slate-800 text-slate-200 p-3 rounded-2xl rounded-tl-none text-sm max-w-[90%] border border-slate-700 mb-2">${text}</div></div>`;
                } catch(e) {
                    box.innerHTML += `<div class="flex justify-start"><div class="bg-red-900/50 text-red-200 p-2 rounded text-xs">ì˜¤ë¥˜: ${e.message}</div></div>`;
                }
                box.scrollTop = box.scrollHeight;
            },

            // --- Ads ---
            openAdModal() {
                const modal = document.getElementById('ad-modal');
                modal.classList.remove('hidden-force');
                const bar = document.getElementById('ad-progress');
                const btn = document.getElementById('ad-close-btn');
                
                let w = 0;
                bar.style.width = '0%';
                btn.disabled = true;
                btn.innerText = "ê´‘ê³  ì‹œì²­ ì¤‘...";
                btn.className = "w-full py-3 rounded-lg font-bold bg-slate-200 text-slate-400";

                const t = setInterval(() => {
                    w += 2.5;
                    bar.style.width = w + '%';
                    if(w >= 100) {
                        clearInterval(t);
                        btn.disabled = false;
                        btn.className = "w-full py-3 rounded-lg font-bold bg-indigo-600 text-white hover:bg-indigo-500";
                        btn.innerText = "ë³´ìƒ ë°›ê¸° (+10 Coin)";
                    }
                }, 50);
            },

            completeAd() {
                this.coins += 10;
                document.getElementById('coin-disp').innerText = this.coins;
                document.getElementById('ad-modal').classList.add('hidden-force');
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
