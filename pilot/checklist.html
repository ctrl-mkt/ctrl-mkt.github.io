<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slam Burger Manager</title>
    
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Configure Tailwind theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slam: {
                            red: '#E31937', // Slam Burger Main Red
                            dark: '#1A1A1A',
                            gray: '#F2F4F6', // Toss style background
                            text: '#333D4B',
                            light: '#E5E8EB'
                        }
                    },
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                    },
                    boxShadow: {
                        'toss': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'floating': '0 8px 30px rgba(227, 25, 55, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Slide Animation for Chatbot */
        .slide-in-right {
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .slide-in-right.active {
            transform: translateX(0);
        }

        /* Mobile specific adjustments */
        @media (max-width: 768px) {
            body { font-size: 14px; }
            h1 { font-size: 1.25rem; }
            .mobile-hide { display: none; }
        }
        
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s; }
    </style>
</head>
<body class="bg-slam-gray text-slam-text font-sans antialiased h-screen flex flex-col overflow-hidden">

    <!-- Login / API Key Modal (First Screen) -->
    <div id="login-screen" class="fixed inset-0 z-50 bg-white flex flex-col items-center justify-center p-6 transition-opacity duration-300">
        <div class="w-full max-w-md space-y-8 text-center">
            <h1 class="text-4xl font-bold text-slam-red tracking-tighter">SLAM BURGER</h1>
            <p class="text-gray-500">ë§¤ì¥ ê´€ë¦¬ ì‹œìŠ¤í…œ ì ‘ì†</p>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="block text-sm font-medium mb-1">ì§ì› ì´ë¦„</label>
                    <input type="text" id="username-input" class="w-full p-4 bg-gray-50 rounded-2xl border border-gray-200 focus:outline-none focus:border-slam-red focus:ring-1 focus:ring-slam-red transition" placeholder="í™ê¸¸ë™">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Gemini API Key</label>
                    <input type="password" id="apikey-input" class="w-full p-4 bg-gray-50 rounded-2xl border border-gray-200 focus:outline-none focus:border-slam-red focus:ring-1 focus:ring-slam-red transition" placeholder="AI ê¸°ëŠ¥ ì‚¬ìš©ì„ ìœ„í•´ í‚¤ ì…ë ¥">
                    <p class="text-xs text-gray-400 mt-1">* í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
                </div>
                <button onclick="handleLogin()" class="w-full py-4 bg-slam-red text-white font-bold rounded-2xl shadow-toss hover:bg-red-700 transition transform active:scale-95">
                    ì ‘ì†í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- Main App Layout -->
    <div id="app-container" class="flex h-full hidden">
        
        <!-- Mobile Left Sidebar (Drawer) - Hidden by default -->
        <div id="mobile-drawer" class="fixed inset-0 z-40 bg-black/50 hidden transition-opacity" onclick="toggleDrawer()">
            <div class="absolute left-0 top-0 h-full w-64 bg-white shadow-xl p-6" onclick="event.stopPropagation()">
                <h2 class="text-2xl font-bold text-slam-red mb-8">MENU</h2>
                <nav class="space-y-4">
                    <button onclick="navigate('home'); toggleDrawer()" class="w-full text-left p-3 rounded-xl hover:bg-gray-100 font-medium">ğŸ  í™ˆ ëŒ€ì‹œë³´ë“œ</button>
                    <button onclick="navigate('checklist'); toggleDrawer()" class="w-full text-left p-3 rounded-xl hover:bg-gray-100 font-medium">âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
                    <button onclick="navigate('points'); toggleDrawer()" class="w-full text-left p-3 rounded-xl hover:bg-gray-100 font-medium">ğŸ† í¬ì¸íŠ¸ & ë­í‚¹</button>
                    <button onclick="logout()" class="w-full text-left p-3 rounded-xl hover:bg-gray-100 font-medium text-gray-400 mt-10">ë¡œê·¸ì•„ì›ƒ</button>
                </nav>
            </div>
        </div>

        <!-- PC Top Navigation -->
        <header class="fixed top-0 w-full bg-white/80 backdrop-blur-md z-30 border-b border-gray-100 h-16 flex items-center justify-between px-4 md:px-10">
            <div class="flex items-center gap-4">
                <button onclick="toggleDrawer()" class="md:hidden p-2">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <span class="text-xl font-bold text-slam-red cursor-pointer" onclick="navigate('home')">SLAM BURGER</span>
            </div>
            
            <!-- Desktop Menu -->
            <nav class="hidden md:flex gap-8">
                <button onclick="navigate('home')" class="font-medium hover:text-slam-red transition">í™ˆ</button>
                <button onclick="navigate('checklist')" class="font-medium hover:text-slam-red transition">ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
                <button onclick="navigate('points')" class="font-medium hover:text-slam-red transition">í¬ì¸íŠ¸ í˜„í™©</button>
            </nav>

            <div class="flex items-center gap-3">
                <div class="text-right hidden md:block">
                    <p class="text-xs text-gray-500">í˜„ì¬ ê·¼ë¬´ì</p>
                    <p class="font-bold" id="header-username">Guest</p>
                </div>
                <div class="w-8 h-8 rounded-full bg-slam-red text-white flex items-center justify-center font-bold">
                    <i data-lucide="user" class="w-4 h-4"></i>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 pt-20 pb-20 md:pb-6 px-4 md:px-10 overflow-y-auto w-full max-w-7xl mx-auto scroll-smooth">
            
            <!-- VIEW: HOME (Dashboard) -->
            <div id="view-home" class="space-y-6 animate-fade-in">
                <!-- Welcome Card -->
                <div class="bg-white p-6 md:p-8 rounded-3xl shadow-toss relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-red-50 rounded-full -mr-10 -mt-10 z-0"></div>
                    <div class="relative z-10">
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">ì˜¤ëŠ˜ë„ í˜ì°¨ê²Œ! <span class="text-slam-red" id="dashboard-name">í™ê¸¸ë™</span>ë‹˜</h2>
                        <p class="text-gray-500 mb-6">í˜„ì¬ ë§¤ì¥ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•´ë³´ì„¸ìš”.</p>
                        
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1 bg-gray-50 rounded-2xl p-4 flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">ì´ë²ˆ ë‹¬ ë‚´ í¬ì¸íŠ¸</p>
                                    <p class="text-2xl font-bold text-slam-red" id="my-points-display">0 P</p>
                                </div>
                                <i data-lucide="award" class="w-8 h-8 text-yellow-500"></i>
                            </div>
                            <div class="flex-1 bg-gray-50 rounded-2xl p-4 flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">ì§„í–‰ì¤‘ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</p>
                                    <p class="text-2xl font-bold">ë¯¸ë“¤ íƒ€ì„</p>
                                </div>
                                <i data-lucide="clipboard-list" class="w-8 h-8 text-blue-500"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Links -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button onclick="navigate('checklist')" class="bg-white p-6 rounded-3xl shadow-sm hover:shadow-toss transition text-left group">
                        <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition">
                            <i data-lucide="check-square" class="text-slam-red w-5 h-5"></i>
                        </div>
                        <h3 class="font-bold mb-1">ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
                        <p class="text-xs text-gray-400">ì—…ë¬´ ë³´ê³ í•˜ê¸°</p>
                    </button>

                    <button onclick="navigate('points')" class="bg-white p-6 rounded-3xl shadow-sm hover:shadow-toss transition text-left group">
                        <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition">
                            <i data-lucide="bar-chart-2" class="text-yellow-600 w-5 h-5"></i>
                        </div>
                        <h3 class="font-bold mb-1">í¬ì¸íŠ¸ í˜„í™©</h3>
                        <p class="text-xs text-gray-400">íŒ€ & ê°œì¸ ë­í‚¹</p>
                    </button>
                    
                     <button onclick="openChatbot()" class="bg-white p-6 rounded-3xl shadow-sm hover:shadow-toss transition text-left group">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition">
                            <i data-lucide="bot" class="text-blue-600 w-5 h-5"></i>
                        </div>
                        <h3 class="font-bold mb-1">AI ë§¤ë‰´ì–¼</h3>
                        <p class="text-xs text-gray-400">ê¶ê¸ˆí•œ ì  ë¬¼ì–´ë³´ê¸°</p>
                    </button>

                    <div class="bg-gray-100 p-6 rounded-3xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400">
                        <p class="text-xs font-medium">Coming Soon</p>
                    </div>
                </div>
                
                <!-- Monthly Team Goal -->
                <div class="bg-white p-6 md:p-8 rounded-3xl shadow-toss">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">12ì›” íŒ€ ëª©í‘œ ë‹¬ì„±ë¥ </h3>
                        <span class="text-slam-red font-bold">75%</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-4 overflow-hidden">
                        <div class="bg-slam-red h-full rounded-full transition-all duration-1000" style="width: 75%"></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 text-center">ëª©í‘œ ë‹¬ì„± ì‹œ ì „ì› ë³´ë„ˆìŠ¤ í¬ì¸íŠ¸ ì§€ê¸‰!</p>
                </div>
            </div>

            <!-- VIEW: CHECKLIST -->
            <div id="view-checklist" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold">âœ… ì—…ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
                    <select id="time-select" class="p-2 rounded-lg border border-gray-200 text-sm font-medium bg-white" onchange="loadChecklist()">
                        <option value="open">ì˜¤í”ˆ (09:00~)</option>
                        <option value="middle" selected>ë¯¸ë“¤ (14:00~)</option>
                        <option value="close">ë§ˆê° (21:00~)</option>
                    </select>
                </div>

                <!-- Checklist Container -->
                <div id="checklist-items" class="space-y-4">
                    <!-- Items will be injected here via JS -->
                </div>

                <div class="pt-4 pb-8">
                    <button onclick="submitChecklist()" class="w-full py-4 bg-slam-red text-white font-bold rounded-2xl shadow-floating hover:bg-red-700 transition active:scale-95">
                        ë³´ê³  ì™„ë£Œí•˜ê³  í¬ì¸íŠ¸ ë°›ê¸°
                    </button>
                </div>
            </div>

            <!-- VIEW: POINTS -->
            <div id="view-points" class="hidden space-y-6">
                <h2 class="text-2xl font-bold">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
                
                <!-- Tabs -->
                <div class="flex p-1 bg-gray-200 rounded-xl w-full md:w-fit">
                    <button onclick="switchPointTab('team')" id="tab-team" class="flex-1 md:w-32 py-2 text-sm font-bold rounded-lg bg-white shadow-sm transition">TEAM</button>
                    <button onclick="switchPointTab('individual')" id="tab-individual" class="flex-1 md:w-32 py-2 text-sm font-medium text-gray-500 rounded-lg transition">ê°œì¸</button>
                </div>

                <!-- Content -->
                <div id="point-content" class="bg-white p-6 rounded-3xl shadow-toss min-h-[300px]">
                    <!-- Chart/List injected via JS -->
                    <div class="space-y-6">
                         <div class="flex items-center justify-between border-b pb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold">1</div>
                                <span class="font-medium">ê°•ë‚¨ì  AíŒ€</span>
                            </div>
                            <span class="font-bold text-slam-red">15,400 P</span>
                        </div>
                        <div class="flex items-center justify-between border-b pb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white font-bold">2</div>
                                <span class="font-medium">í™ëŒ€ì  BíŒ€</span>
                            </div>
                            <span class="font-bold">12,200 P</span>
                        </div>
                         <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center text-white font-bold">3</div>
                                <span class="font-medium">ì´íƒœì›ì  CíŒ€</span>
                            </div>
                            <span class="font-bold">11,050 P</span>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Floating Chatbot Button (PC) -->
    <button onclick="toggleChatbot()" class="fixed bottom-6 right-6 w-14 h-14 bg-slam-dark text-white rounded-full shadow-floating flex items-center justify-center hover:scale-105 transition z-40 hidden md:flex">
        <i data-lucide="message-circle" class="w-6 h-6"></i>
    </button>

    <!-- Chatbot Sidebar/Modal -->
    <div id="chatbot-panel" class="fixed inset-y-0 right-0 w-full md:w-[400px] bg-white shadow-2xl z-50 slide-in-right flex flex-col border-l border-gray-200">
        <!-- Header -->
        <div class="p-4 border-b flex justify-between items-center bg-slam-dark text-white">
            <div class="flex items-center gap-2">
                <i data-lucide="bot" class="w-5 h-5 text-slam-red"></i>
                <span class="font-bold">Slam Burger AI ë§¤ë‹ˆì €</span>
            </div>
            <button onclick="toggleChatbot()" class="p-1 hover:bg-gray-700 rounded-full">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        
        <!-- Chat Area -->
        <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
            <div class="flex gap-3">
                <div class="w-8 h-8 bg-slam-red rounded-full flex-shrink-0 flex items-center justify-center text-white text-xs">AI</div>
                <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm border border-gray-100">
                    ì•ˆë…•í•˜ì„¸ìš”! ë§¤ì¥ ê´€ë¦¬ë‚˜ ë ˆì‹œí”¼, ì²­ì†Œ ë°©ë²•ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t">
            <div class="flex gap-2">
                <input type="text" id="chat-input" class="flex-1 bg-gray-100 border-0 rounded-xl px-4 py-3 focus:ring-1 focus:ring-slam-red text-sm" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()" class="bg-slam-red text-white p-3 rounded-xl hover:bg-red-700 transition">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Detail Modal Template -->
    <div id="detail-modal" class="fixed inset-0 z-[60] bg-black/60 hidden items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-3xl p-6 shadow-2xl transform transition-all scale-100 relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-black">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h3 id="modal-title" class="text-xl font-bold mb-4 border-b pb-2">ìƒì„¸ ê°€ì´ë“œ</h3>
            <div id="modal-content" class="text-sm text-gray-600 leading-relaxed space-y-4">
                <!-- Dynamic Content -->
            </div>
            <div class="mt-6 flex justify-end">
                <button onclick="closeModal()" class="px-5 py-2 bg-gray-100 rounded-xl text-sm font-bold hover:bg-gray-200">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            user: null,
            apiKey: null,
            points: 0,
            currentView: 'home',
            checklist: []
        };

        // --- Mock Data ---
        const checklistData = {
            open: [
                { id: 1, task: "ë§¤ì¥ í™˜ê¸° ë° ì¡°ëª… ì ê²€", desc: "ëª¨ë“  ì°½ë¬¸ì„ ì—´ì–´ 10ë¶„ê°„ í™˜ê¸°í•˜ê³ , í™€ê³¼ ì£¼ë°©ì˜ ëª¨ë“  ì¡°ëª…ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.", points: 10 },
                { id: 2, task: "í¬ìŠ¤ê¸° ë¶€íŒ… ë° ì‹œì¬ ì ê²€", desc: "ë©”ì¸ í¬ìŠ¤ê¸°ë¥¼ ì¼œê³ , ì¤€ë¹„ê¸ˆì´ 50,000ì› ë§ëŠ”ì§€ í™•ì¸ í›„ ê¸°ë¡í•˜ì„¸ìš”.", points: 10 },
                { id: 3, task: "ì£¼ë°© ì‹ìì¬ í•´ë™ ìƒíƒœ í™•ì¸", desc: "íŒ¨í‹°ì™€ ë²ˆì˜ í•´ë™ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , ë¶€ì¡±í•œ ê²½ìš° ì¦‰ì‹œ ë§¤ë‹ˆì €ì—ê²Œ ë³´ê³ í•˜ì„¸ìš”.", points: 15 }
            ],
            middle: [
                { id: 4, task: "í™€ í…Œì´ë¸” ì²­ê²° ìœ ì§€", desc: "ì†ë‹˜ì´ ë‚˜ê°„ í…Œì´ë¸”ì€ ì¦‰ì‹œ ì†Œë…ì•¡ìœ¼ë¡œ ë‹¦ê³  ì˜ìë¥¼ ì •ëˆí•˜ì„¸ìš”.", points: 10 },
                { id: 5, task: "ìŒë£Œ ë””ìŠ¤íœì„œ ì ê²€", desc: "ì‹œëŸ½ ì”ëŸ‰ì„ í™•ì¸í•˜ê³  ì–¼ìŒì´ ì¶©ë¶„í•œì§€ ì²´í¬í•˜ì„¸ìš”.", points: 10 },
                { id: 6, task: "í™”ì¥ì‹¤ ì²­ì†Œ ìƒíƒœ í™•ì¸", desc: "ë¬¼ë¹„ëˆ„, í˜ì´í¼ íƒ€ì›”ì„ ë³´ì¶©í•˜ê³  ë°”ë‹¥ ë¬¼ê¸°ë¥¼ ì œê±°í•˜ì„¸ìš”.", points: 20 },
                { id: 7, task: "ì“°ë ˆê¸°í†µ ë¹„ìš°ê¸°", desc: "í™€ ì¤‘ì•™ ì“°ë ˆê¸°í†µì´ 80% ì´ìƒ ì°¼ë‹¤ë©´ ì¦‰ì‹œ êµì²´í•˜ì„¸ìš”.", points: 15 }
            ],
            close: [
                { id: 8, task: "í”„ë¼ì´ì–´ ê¸°ë¦„ ì •ì œ", desc: "ê¸°ë¦„ ì˜¨ë„ë¥¼ ë‚®ì¶˜ í›„ ì •ì œê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì°Œêº¼ê¸°ë¥¼ ê±¸ëŸ¬ë‚´ì„¸ìš”. (í™”ìƒ ì£¼ì˜)", points: 30 },
                { id: 9, task: "ê·¸ë¦´íŒ ë§ˆê° ì²­ì†Œ", desc: "ìŠ¤í¬ë˜í¼ë¡œ íƒ„í™”ë¬¼ì„ ì™„ì „íˆ ì œê±°í•˜ê³  ì „ìš© ì„¸ì œë¡œ ë‹¦ìœ¼ì„¸ìš”.", points: 30 },
                { id: 10, task: "ì‹ìì¬ ìœ í†µê¸°í•œ ë¼ë²¨ë§", desc: "ë‚¨ì€ ì‹ìì¬ëŠ” ë°€ë´‰ í›„ íê¸°/ì‚¬ìš© ê¸°í•œ ë¼ë²¨ì„ ë¶€ì°©í•´ ëƒ‰ì¥ê³ ì— ë³´ê´€í•˜ì„¸ìš”.", points: 20 }
            ]
        };

        // --- Init & Auth ---
        window.onload = () => {
            lucide.createIcons();
            
            // Check Local Storage
            const storedUser = localStorage.getItem('slam_user');
            const storedKey = localStorage.getItem('slam_apikey');
            const storedPoints = localStorage.getItem('slam_points');

            if (storedUser && storedKey) {
                state.user = storedUser;
                state.apiKey = storedKey;
                state.points = parseInt(storedPoints) || 0;
                enterApp();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
            }
        };

        function handleLogin() {
            const user = document.getElementById('username-input').value;
            const key = document.getElementById('apikey-input').value;

            if (!user || !key) {
                alert('ì´ë¦„ê³¼ API í‚¤ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Save to LocalStorage
            localStorage.setItem('slam_user', user);
            localStorage.setItem('slam_apikey', key);
            localStorage.setItem('slam_points', state.points);

            state.user = user;
            state.apiKey = key;

            enterApp();
        }

        function enterApp() {
            // UI Update
            document.getElementById('login-screen').classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-container').classList.remove('hidden');
            }, 300);

            document.getElementById('header-username').innerText = state.user;
            document.getElementById('dashboard-name').innerText = state.user;
            updatePointsDisplay();
            
            navigate('home');
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }

        // --- Navigation ---
        function navigate(viewId) {
            // Hide all views
            ['home', 'checklist', 'points'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
            });
            
            // Show target view
            const target = document.getElementById(`view-${viewId}`);
            target.classList.remove('hidden');
            target.classList.add('animate-fade-in');

            state.currentView = viewId;

            if (viewId === 'checklist') loadChecklist();
            
            // Close mobile drawer if open
            document.getElementById('mobile-drawer').classList.add('hidden');
        }

        function toggleDrawer() {
            const drawer = document.getElementById('mobile-drawer');
            if (drawer.classList.contains('hidden')) {
                drawer.classList.remove('hidden');
            } else {
                drawer.classList.add('hidden');
            }
        }

        // --- Checklist Logic ---
        function loadChecklist() {
            const timeSlot = document.getElementById('time-select').value;
            const items = checklistData[timeSlot];
            const container = document.getElementById('checklist-items');
            
            container.innerHTML = ''; // Clear

            items.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col gap-3 transition hover:shadow-md';
                el.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="check-${item.id}" class="w-6 h-6 text-slam-red rounded focus:ring-slam-red border-gray-300 cursor-pointer" onchange="toggleTaskStyle(this)">
                            <div>
                                <label for="check-${item.id}" class="font-bold text-lg cursor-pointer">${item.task}</label>
                                <p class="text-xs text-slam-red font-medium">+${item.points} P</p>
                            </div>
                        </div>
                        <button onclick="showDetail(${item.id}, '${timeSlot}')" class="text-gray-400 hover:text-slam-red">
                            <i data-lucide="help-circle" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="flex gap-2 pl-9">
                        <label class="cursor-pointer flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg text-xs text-gray-500 hover:bg-gray-100 border border-gray-200">
                            <i data-lucide="camera" class="w-4 h-4"></i>
                            <span>ì‚¬ì§„ ì¸ì¦</span>
                            <input type="file" class="hidden" accept="image/*" onchange="alert('ì‚¬ì§„ì´ ì²¨ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤!')">
                        </label>
                    </div>
                `;
                container.appendChild(el);
            });
            lucide.createIcons();
        }

        function toggleTaskStyle(checkbox) {
            const label = checkbox.nextElementSibling.querySelector('label');
            if (checkbox.checked) {
                label.classList.add('text-gray-400', 'line-through');
            } else {
                label.classList.remove('text-gray-400', 'line-through');
            }
        }

        function showDetail(id, timeSlot) {
            const item = checklistData[timeSlot].find(i => i.id === id);
            document.getElementById('modal-title').innerText = item.task;
            document.getElementById('modal-content').innerHTML = `
                <p>${item.desc}</p>
                <div class="mt-4 p-3 bg-red-50 text-slam-red rounded-lg text-xs font-bold">
                    ğŸ’¡ Tip: ê¼¼ê¼¼í•˜ê²Œ ìˆ˜í–‰í•˜ê³  ì‚¬ì§„ì„ ê¼­ ì°ì–´ì£¼ì„¸ìš”!
                </div>
            `;
            document.getElementById('detail-modal').classList.remove('hidden');
            document.getElementById('detail-modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.add('hidden');
            document.getElementById('detail-modal').classList.remove('flex');
        }

        function submitChecklist() {
            // Count checked items
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('ì™„ë£Œí•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // Calculate points (simplified logic)
            let earned = 0;
            checkboxes.forEach(cb => {
                // In real app, map ID to points. Here assume 10 for demo or parsing sibling.
                // Retrieving points from text for demo simplicity
                const pointText = cb.nextElementSibling.querySelector('p').innerText;
                const p = parseInt(pointText.replace(/[^0-9]/g, ''));
                earned += p;
                
                // Reset UI
                cb.checked = false;
                toggleTaskStyle(cb);
            });

            state.points += earned;
            localStorage.setItem('slam_points', state.points);
            updatePointsDisplay();

            // Simulate DB Call (GAS)
            sendToGAS({
                type: 'checklist_report',
                user: state.user,
                points: earned,
                timestamp: new Date().toISOString()
            });

            alert(`ë³´ê³ ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n${earned} í¬ì¸íŠ¸ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function updatePointsDisplay() {
            document.getElementById('my-points-display').innerText = `${state.points.toLocaleString()} P`;
        }

        // --- Points Tab Logic ---
        function switchPointTab(type) {
            const btnTeam = document.getElementById('tab-team');
            const btnIndi = document.getElementById('tab-individual');
            const content = document.getElementById('point-content');

            if (type === 'team') {
                btnTeam.classList.add('bg-white', 'shadow-sm', 'font-bold', 'text-black');
                btnTeam.classList.remove('text-gray-500');
                btnIndi.classList.remove('bg-white', 'shadow-sm', 'font-bold', 'text-black');
                btnIndi.classList.add('text-gray-500');
                
                content.innerHTML = `
                     <div class="space-y-6">
                         <div class="flex items-center justify-between border-b pb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold">1</div>
                                <span class="font-medium">ê°•ë‚¨ì  AíŒ€</span>
                            </div>
                            <span class="font-bold text-slam-red">15,400 P</span>
                        </div>
                        <div class="flex items-center justify-between border-b pb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white font-bold">2</div>
                                <span class="font-medium">í™ëŒ€ì  BíŒ€</span>
                            </div>
                            <span class="font-bold">12,200 P</span>
                        </div>
                    </div>
                `;
            } else {
                btnIndi.classList.add('bg-white', 'shadow-sm', 'font-bold', 'text-black');
                btnIndi.classList.remove('text-gray-500');
                btnTeam.classList.remove('bg-white', 'shadow-sm', 'font-bold', 'text-black');
                btnTeam.classList.add('text-gray-500');

                // Show Individual with current user
                content.innerHTML = `
                    <div class="space-y-6">
                         <div class="flex items-center justify-between border-b border-slam-red/20 bg-red-50 p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <span class="text-xs font-bold text-slam-red">ME</span>
                                <span class="font-bold">${state.user}</span>
                            </div>
                            <span class="font-bold text-slam-red">${state.points.toLocaleString()} P</span>
                        </div>
                         <div class="flex items-center justify-between border-b pb-4 mt-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold">1</div>
                                <span class="font-medium">ê¹€ë§¤ë‹ˆì €</span>
                            </div>
                            <span class="font-bold text-gray-700">5,400 P</span>
                        </div>
                         <div class="flex items-center justify-between border-b pb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white font-bold">2</div>
                                <span class="font-medium">ì´ì•Œë°”</span>
                            </div>
                            <span class="font-bold text-gray-700">4,200 P</span>
                        </div>
                    </div>
                `;
            }
        }

        // --- Chatbot Logic (Gemini API) ---
        function toggleChatbot() {
            const panel = document.getElementById('chatbot-panel');
            panel.classList.toggle('active');
        }
        
        // Open chatbot from main menu
        function openChatbot() {
            document.getElementById('chatbot-panel').classList.add('active');
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add User Message
            appendMessage('user', message);
            input.value = '';

            // Add Loading
            const loadingId = 'loading-' + Date.now();
            appendMessage('bot', '<span id="'+loadingId+'">ë‹µë³€ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...</span>');

            try {
                const response = await fetchGemini(message);
                document.getElementById(loadingId).parentElement.innerHTML = response;
            } catch (error) {
                console.error(error);
                document.getElementById(loadingId).innerText = "ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
            }
        }

        function appendMessage(sender, html) {
            const history = document.getElementById('chat-history');
            const div = document.createElement('div');
            div.className = 'flex gap-3 mb-4 animate-fade-in';
            
            if (sender === 'user') {
                div.classList.add('flex-row-reverse');
                div.innerHTML = `
                    <div class="bg-slam-red text-white p-3 rounded-2xl rounded-tr-none shadow-sm text-sm max-w-[80%]">
                        ${html}
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="w-8 h-8 bg-slam-red rounded-full flex-shrink-0 flex items-center justify-center text-white text-xs">AI</div>
                    <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm border border-gray-100 max-w-[85%] leading-relaxed">
                        ${html}
                    </div>
                `;
            }
            history.appendChild(div);
            history.scrollTop = history.scrollHeight;
        }

        async function fetchGemini(prompt) {
            if (!state.apiKey) throw new Error("No API Key");

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${state.apiKey}`;
            
            // System instruction to act as a Slam Burger manager
            const systemContext = `
                ë‹¹ì‹ ì€ 'ìŠ¬ë¨ë²„ê±°(SLAM BURGER)'ì˜ AI ë§¤ì¥ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤.
                ì‚¬ìš©ìëŠ” ë§¤ì¥ ê·¼ë¬´ì(ì•„ë¥´ë°”ì´íŠ¸ìƒ)ì…ë‹ˆë‹¤.
                ì¹œì ˆí•˜ê³  ì—ë„ˆì œí‹±í•œ í†¤ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”.
                ì§ˆë¬¸ì´ ë§¤ì¥ ì²­ì†Œ, ë ˆì‹œí”¼, ê³ ê° ì‘ëŒ€ ë§¤ë‰´ì–¼ì— ê´€í•œ ê²ƒì´ë©´ êµ¬ì²´ì ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”.
                ìŠ¬ë¨ë²„ê±°ì˜ ë¸Œëœë“œ ì»¬ëŸ¬ëŠ” ë ˆë“œì´ë©°, ìœ„ìƒê³¼ ì²­ê²°ì„ ìµœìš°ì„ ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                ë‹µë³€ì€ HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ê³  ì¤„ë°”ê¿ˆê³¼ ì´ëª¨ì§€ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ì—¬ ê°€ë…ì„± ìˆê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.
            `;

            const payload = {
                contents: [{
                    parts: [{ text: systemContext + "\n\nUser Question: " + prompt }]
                }]
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await response.json();
            const rawText = data.candidates[0].content.parts[0].text;
            
            // Simple Markdown formatting
            return rawText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
        }

        // --- Mock GAS Sender ---
        function sendToGAS(data) {
            // This function would send data to your Google Apps Script Web App URL
            console.log("Sending to DB:", data);
            
            // Example Code for real implementation:
            /*
            fetch('YOUR_GAS_WEB_APP_URL', {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            */
        }

    </script>
</body>
</html>
