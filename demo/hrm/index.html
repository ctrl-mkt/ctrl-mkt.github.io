<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Î†àÏä§ÌÜ†ÏßÄÎãà HR Îß§ÎãàÏßÄÎ®ºÌä∏ (v2.0.0)</title>

    <!-- Ïä§ÌÉÄÏùº & Ìè∞Ìä∏ -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] },
                    colors: {
                        rg: { primary: '#2563EB', bg: '#F8FAFC', text: '#0F172A', border: '#E2E8F0' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #F8FAFC; }
        [x-cloak] { display: none !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 2px; }
        .animate-slide-down { animation: slideDown 0.2s ease-out forwards; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
</head>

<body class="text-slate-800 antialiased bg-slate-50"
      x-data="hrApp()"
      x-init="initApp()">

    <!-- Ìó§Îçî -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-30 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold bg-rg-primary">R</div>
                <h1 class="text-xl font-bold text-slate-800">
                    RestoGenie HR 
                    <span class="text-xs font-normal text-white bg-blue-600 px-2 py-0.5 rounded ml-2">v2.0</span>
                </h1>
            </div>
            <nav class="flex space-x-1">
                <template x-for="tab in ['employees', 'calendar', 'payroll']">
                    <button @click="activeTab = tab" 
                            :class="activeTab === tab ? 'text-blue-600 bg-blue-50 font-bold' : 'text-slate-500 font-medium'" 
                            class="px-4 py-2 rounded-md text-sm transition"
                            x-text="tabName(tab)"></button>
                </template>
            </nav>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6" x-cloak>
        
        <!-- 1. ÏßÅÏõê Í¥ÄÎ¶¨ ÌÉ≠ -->
        <div x-show="activeTab === 'employees'" class="animate-slide-down">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">ÏßÅÏõê Î¶¨Ïä§Ìä∏</h2>
                <button @click="openEmpModal()" class="flex items-center space-x-2 text-white px-4 py-2 rounded-lg bg-rg-primary hover:bg-blue-700 transition shadow-sm">
                    <i data-lucide="plus" class="w-4 h-4"></i> <span>ÏßÅÏõê Îì±Î°ù</span>
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 text-slate-500 text-sm border-b border-slate-200">
                        <tr>
                            <th class="p-4 font-medium">Ïù¥Î¶Ñ / ÏßÅÏ±Ö</th>
                            <th class="p-4 font-medium">Í≥ÑÏïΩ ÌòïÌÉú</th>
                            <th class="p-4 font-medium">Í∏âÏó¨ Ï°∞Í±¥</th>
                            <th class="p-4 font-medium">Í≥ÑÏïΩ ÏùºÏ†ï</th>
                            <th class="p-4 font-medium">ÏûÖÏÇ¨Ïùº</th>
                            <th class="p-4 font-medium text-right">Í¥ÄÎ¶¨</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        <template x-for="emp in employees" :key="emp.id">
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="p-4">
                                    <div class="font-bold text-slate-900" x-text="emp.name"></div>
                                    <div class="text-xs text-slate-500 uppercase mt-0.5 px-2 py-0.5 bg-slate-100 rounded-full inline-block" x-text="formatRole(emp.role)"></div>
                                </td>
                                <td class="p-4 text-sm text-slate-600">
                                    <div x-text="emp.contractType === 'insurance4' ? '4ÎåÄÎ≥¥Ìóò' : 'ÌîÑÎ¶¨ÎûúÏÑú(3.3%)'"></div>
                                    <div class="text-xs text-slate-400 mt-1" x-show="emp.contractStatus === 'signed'">ÏÑúÎ™Ö ÏôÑÎ£å</div>
                                </td>
                                <td class="p-4 text-sm font-medium text-slate-700">
                                    <span x-text="formatCurrency(emp.basePay)"></span>
                                    <span class="text-xs font-normal text-slate-400 ml-1" x-text="emp.role === 'parttime' ? '/ ÏãúÍ∏â' : '/ ÏõîÍ∏â'"></span>
                                </td>
                                <td class="p-4 text-xs text-slate-500">
                                    <template x-if="emp.schedule && Object.keys(emp.schedule).length > 0">
                                        <div class="flex flex-wrap gap-1">
                                            <template x-for="(sch, day) in emp.schedule">
                                                <span class="bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded" x-text="day + ' ' + sch.start + '~' + sch.end"></span>
                                            </template>
                                        </div>
                                    </template>
                                    <template x-if="!emp.schedule || Object.keys(emp.schedule).length === 0">
                                        <span class="text-slate-400">Ïä§ÏºÄÏ§Ñ ÎØ∏Ï†ï</span>
                                    </template>
                                </td>
                                <td class="p-4 text-sm text-slate-600" x-text="emp.joinDate"></td>
                                <td class="p-4 text-right">
                                    <button class="text-sm px-3 py-1.5 rounded border border-blue-200 text-blue-600 hover:bg-blue-50 transition">Í≥ÑÏïΩÏÑú Î≥¥Í∏∞</button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 2. Í∑ºÎ¨¥ Ïä§ÏºÄÏ§Ñ ÌÉ≠ -->
        <div x-show="activeTab === 'calendar'" class="animate-slide-down">
             <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">Í∑ºÎ¨¥ Ïä§ÏºÄÏ§Ñ</h2>
                <div class="flex items-center bg-white rounded-lg border p-1 shadow-sm">
                    <button @click="changeMonth(-1)" class="p-1 hover:bg-slate-100 rounded"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                    <span class="mx-4 font-semibold text-slate-700 min-w-[120px] text-center" x-text="getCurrentYearMonth()"></span>
                    <button @click="changeMonth(1)" class="p-1 hover:bg-slate-100 rounded"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <div class="grid grid-cols-7 mb-2 text-center text-sm font-medium text-slate-500">
                    <div class="text-red-500">Ïùº</div><div>Ïõî</div><div>Ìôî</div><div>Ïàò</div><div>Î™©</div><div>Í∏à</div><div class="text-blue-500">ÌÜ†</div>
                </div>
                <div class="grid grid-cols-7 gap-px bg-slate-200 border border-slate-200">
                    <template x-for="d in getCalendarDays()" :key="d.key">
                        <div @click="d.day ? openShiftModal(d.day) : null" 
                             class="min-h-[120px] p-1 relative bg-white flex flex-col group transition-colors"
                             :class="d.day ? 'cursor-pointer hover:bg-blue-50' : 'bg-slate-50'">
                            <div class="text-xs font-semibold text-gray-500 mb-1 pl-1" x-text="d.day || ''"></div>
                            
                            <!-- Í∑ºÎ¨¥ Ïπ© Î¶¨Ïä§Ìä∏ -->
                            <div class="flex-1 overflow-y-auto space-y-1 custom-scrollbar">
                                <template x-for="shift in getShifts(d.fullDate)">
                                    <!-- ÌÅ¥Î¶≠ Ïãú Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Ï§ëÎã®(.stop)ÌïòÏó¨ ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞ -->
                                    <div @click.stop="openEditShiftModal(shift)"
                                         class="text-[10px] bg-blue-100 hover:bg-blue-200 text-blue-800 px-2 py-1 rounded border border-blue-200 cursor-pointer shadow-sm transition">
                                        <div class="flex justify-between items-center font-bold">
                                            <span x-text="getEmpName(shift.empId)"></span>
                                        </div>
                                        <div class="opacity-75 text-[9px]" x-text="`${shift.startTime}~${shift.endTime}`"></div>
                                    </div>
                                </template>
                            </div>
                            
                            <!-- Ìò∏Î≤Ñ Ïãú + Î≤ÑÌäº -->
                            <div x-show="d.day" class="absolute bottom-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <div class="bg-blue-600 text-white rounded-full p-1 shadow"><i data-lucide="plus" class="w-3 h-3"></i></div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <p class="text-xs text-slate-400 text-right mt-2">* Í∑ºÎ¨¥ Ïπ©ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏàòÏ†ï/ÏÇ≠Ï†ú, Îπà ÎÇ†ÏßúÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî.</p>
        </div>

        <!-- 3. Í∏âÏó¨ Ï†ïÏÇ∞ ÌÉ≠ -->
        <div x-show="activeTab === 'payroll'" class="animate-slide-down">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold" x-text="`${currentDate.getMonth() + 1}Ïõî Í∏âÏó¨ Ï†ïÏÇ∞`"></h2>
                <div class="text-sm text-slate-600 bg-white border px-3 py-1.5 rounded shadow-sm">
                    Í∏∞Ï§Ä: 2025ÎÖÑ ÏµúÏ†ÄÏãúÍ∏â 10,030Ïõê
                </div>
            </div>
            
            <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-2">
                <template x-for="emp in employees" :key="emp.id">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col" x-data="{ pay: calculatePayroll(emp), showDetail: false, showDeduction: false }">
                        
                        <!-- Í∏âÏó¨ ÏöîÏïΩ Ïπ¥Îìú Ìó§Îçî -->
                        <div class="flex justify-between items-start mb-4 border-b border-gray-100 pb-4">
                            <div>
                                <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                                    <span x-text="emp.name"></span>
                                    <span class="text-xs font-normal px-2 py-0.5 bg-slate-100 rounded-full text-slate-500" x-text="formatRole(emp.role)"></span>
                                </h3>
                                <p class="text-xs text-slate-400 mt-1">2025 Î≤ïÏ†ï ÏöîÏú® Ï†ÅÏö©</p>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-slate-500 mb-0.5">Ïã§ÏàòÎ†πÏï°</div>
                                <div class="text-2xl font-bold text-blue-600" x-text="formatCurrency(pay.netPay)"></div>
                            </div>
                        </div>
                        
                        <!-- Í∏âÏó¨ ÏöîÏïΩ Î≥∏Î¨∏ -->
                        <div class="grid grid-cols-2 gap-6 text-sm mb-4">
                            <!-- ÏßÄÍ∏â ÏöîÏïΩ -->
                            <div class="space-y-1">
                                <h4 class="font-semibold text-slate-700 mb-2 border-b pb-1">ÏßÄÍ∏â Ìï©Í≥Ñ</h4>
                                <div class="flex justify-between"><span class="text-slate-500">Í∏∞Î≥∏Í∏â</span><span x-text="formatCurrency(pay.basePay)"></span></div>
                                <div class="flex justify-between text-blue-600" x-show="pay.juhyuAllowance > 0"><span>Ï£ºÌú¥ÏàòÎãπ</span><span x-text="`+ ${formatCurrency(pay.juhyuAllowance)}`"></span></div>
                                <div class="flex justify-between text-blue-600" x-show="pay.nightAllowance > 0"><span>Ïã¨ÏïºÏàòÎãπ</span><span x-text="`+ ${formatCurrency(pay.nightAllowance)}`"></span></div>
                                <div class="flex justify-between font-bold pt-1 mt-1 border-t border-dashed"><span>ÏÑ∏Ï†Ñ Ï¥ùÏï°</span><span x-text="formatCurrency(pay.grossTotal)"></span></div>
                            </div>
                            
                            <!-- Í≥µÏ†ú ÏöîÏïΩ (ÌÅ¥Î¶≠Ïãú ÌéºÏπ®) -->
                            <div class="space-y-1">
                                <div class="flex justify-between items-center border-b pb-1 mb-2 cursor-pointer" @click="showDeduction = !showDeduction">
                                    <h4 class="font-semibold text-slate-700">Í≥µÏ†ú Ìï©Í≥Ñ</h4>
                                    <i data-lucide="chevron-down" class="w-3 h-3 transition-transform" :class="showDeduction ? 'rotate-180' : ''"></i>
                                </div>
                                
                                <div class="flex justify-between text-red-500 font-medium"><span>Ï¥ù Í≥µÏ†úÏï°</span><span x-text="`- ${formatCurrency(pay.deductions.total)}`"></span></div>
                                
                                <!-- Í≥µÏ†ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ (ÌéºÏ≥êÎ≥¥Í∏∞) -->
                                <div x-show="showDeduction" class="mt-2 bg-slate-50 p-2 rounded text-xs space-y-1 text-slate-600" x-transition>
                                    <div class="flex justify-between"><span>Íµ≠ÎØºÏó∞Í∏à</span><span x-text="formatCurrency(pay.deductions.pension)"></span></div>
                                    <div class="flex justify-between"><span>Í±¥Í∞ïÎ≥¥Ìóò</span><span x-text="formatCurrency(pay.deductions.health)"></span></div>
                                    <div class="flex justify-between"><span>Ïû•Í∏∞ÏöîÏñë</span><span x-text="formatCurrency(pay.deductions.care)"></span></div>
                                    <div class="flex justify-between"><span>Í≥†Ïö©Î≥¥Ìóò</span><span x-text="formatCurrency(pay.deductions.employ)"></span></div>
                                    <div class="flex justify-between"><span>ÏÜåÎìùÏÑ∏(ÏßÄÎ∞©ÏÑ∏)</span><span x-text="formatCurrency(pay.deductions.tax)"></span></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÏÉÅÏÑ∏ Í∑ºÎ°ú ÎÇ¥Ïó≠ Î≤ÑÌäº -->
                        <button @click="showDetail = !showDetail" class="w-full py-2 text-xs text-slate-500 border border-slate-200 rounded hover:bg-slate-50 flex justify-center items-center gap-1 transition">
                            <span x-text="showDetail ? 'Í∑ºÎ°ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Îã´Í∏∞' : 'Í∑ºÎ°ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Î∞è Í≥ÑÏÇ∞ Í∑ºÍ±∞ Î≥¥Í∏∞'"></span>
                            <i data-lucide="chevron-down" class="w-3 h-3 transition-transform" :class="showDetail ? 'rotate-180' : ''"></i>
                        </button>

                        <!-- ÏÉÅÏÑ∏ Í∑ºÎ°ú ÎÇ¥Ïó≠ (ÌéºÏ≥êÎ≥¥Í∏∞) -->
                        <div x-show="showDetail" class="mt-4 pt-4 border-t border-slate-100 text-xs" x-transition>
                            <div class="mb-3">
                                <h5 class="font-bold text-slate-700 mb-1">üìä ÏõîÍ∞Ñ ÏßëÍ≥Ñ</h5>
                                <p class="text-slate-600">Ï¥ù Í∑ºÎ¨¥ÏãúÍ∞Ñ: <span class="font-bold text-blue-600" x-text="pay.details.totalHours"></span>ÏãúÍ∞Ñ / Í∑ºÎ¨¥ÏùºÏàò: <span x-text="pay.details.workDays"></span>Ïùº</p>
                            </div>

                            <div class="mb-3" x-show="emp.role === 'parttime'">
                                <h5 class="font-bold text-slate-700 mb-1">üèñ Ï£ºÌú¥ÏàòÎãπ ÏÇ∞Ï†ï ÎÇ¥Ïó≠</h5>
                                <template x-if="Object.keys(pay.details.weekLogs).length > 0">
                                    <ul class="list-disc pl-4 space-y-0.5 text-slate-600">
                                        <template x-for="(val, week) in pay.details.weekLogs">
                                            <li>
                                                <span x-text="week + 'Ï£ºÏ∞®: ' + val.hours + 'ÏãúÍ∞Ñ'"></span>
                                                <span x-show="val.hours >= 15" class="text-green-600 font-bold ml-1">(Ï£ºÌú¥ Î∞úÏÉù)</span>
                                                <span x-show="val.hours < 15" class="text-slate-400 ml-1">(ÎØ∏Î∞úÏÉù - 15ÏãúÍ∞Ñ ÎØ∏Îßå)</span>
                                            </li>
                                        </template>
                                    </ul>
                                </template>
                                <template x-if="Object.keys(pay.details.weekLogs).length === 0">
                                    <p class="text-slate-400">Í∑ºÎ¨¥ Í∏∞Î°ù ÏóÜÏùå</p>
                                </template>
                            </div>

                            <div>
                                <h5 class="font-bold text-slate-700 mb-1">üìÖ ÏùºÎ≥Ñ Í∑ºÎ°ú Î¶¨Ïä§Ìä∏</h5>
                                <div class="max-h-32 overflow-y-auto custom-scrollbar bg-slate-50 rounded border border-slate-100 p-2">
                                    <table class="w-full text-left">
                                        <thead class="text-slate-400 border-b">
                                            <tr><th class="pb-1 font-normal">ÎÇ†Ïßú</th><th class="pb-1 font-normal">ÏãúÍ∞Ñ</th><th class="pb-1 font-normal text-right">ÏãúÏàò</th></tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-100 text-slate-600">
                                            <template x-for="log in pay.details.dailyLogs">
                                                <tr>
                                                    <td class="py-1" x-text="log.date"></td>
                                                    <td class="py-1" x-text="log.timeRange"></td>
                                                    <td class="py-1 text-right" x-text="log.hours + 'h'"></td>
                                                </tr>
                                            </template>
                                            <tr x-show="pay.details.dailyLogs.length === 0">
                                                <td colspan="3" class="py-2 text-center text-slate-400">Í∏∞Î°ù ÏóÜÏùå</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </template>
            </div>
        </div>

    </main>

    <!-- [Î™®Îã¨ 1] ÏßÅÏõê Îì±Î°ù (Í≥ÑÏïΩ Ï°∞Í±¥ ÏÉÅÏÑ∏) -->
    <div x-show="showEmpModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4" x-cloak x-transition>
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto custom-scrollbar" @click.away="showEmpModal = false">
            <h3 class="text-xl font-bold mb-4 text-slate-800">ÏßÅÏõê Î∞è Í≥ÑÏïΩ Ï°∞Í±¥ Îì±Î°ù</h3>
            <form @submit.prevent="addEmployee" class="space-y-4">
                
                <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">Ïù¥Î¶Ñ</label>
                        <input x-model="newEmp.name" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ïù¥Î¶Ñ" required>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">ÏûÖÏÇ¨Ïùº</label>
                        <input x-model="newEmp.joinDate" type="date" class="w-full p-2.5 border rounded-lg" required>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">ÏßÅÏ±Ö</label>
                        <select x-model="newEmp.role" class="w-full p-2.5 border rounded-lg bg-white">
                            <option value="parttime">ÏïÑÎ•¥Î∞îÏù¥Ìä∏</option>
                            <option value="staff">Ï†ïÍ∑úÏßÅ</option>
                            <option value="manager">Îß§ÎãàÏ†Ä</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">Í∏âÏó¨ (ÏãúÍ∏â/ÏõîÍ∏â)</label>
                        <input x-model.number="newEmp.basePay" type="number" class="w-full p-2.5 border rounded-lg" required>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Í≥ÑÏïΩ ÌòïÌÉú</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="radio" value="insurance4" x-model="newEmp.contractType" class="text-blue-600"> 4ÎåÄÎ≥¥Ìóò
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="radio" value="freelancer" x-model="newEmp.contractType" class="text-blue-600"> ÌîÑÎ¶¨ÎûúÏÑú(3.3%)
                        </label>
                    </div>
                </div>

                <hr class="border-slate-100 my-2">

                <!-- ÏöîÏùºÎ≥Ñ Í∑ºÎ¨¥ Í≥ÑÏïΩ ÏÑ§Ï†ï -->
                <div>
                    <h4 class="text-sm font-bold text-slate-700 mb-2">üóì ÏöîÏùºÎ≥Ñ Í∑ºÎ°ú/Ìú¥Í≤å Í≥ÑÏïΩ ÏÑ§Ï†ï</h4>
                    <p class="text-xs text-slate-400 mb-2">* Í∑ºÎ¨¥Ïùº ÏÑ†ÌÉù Ïãú ÏãúÍ∞Ñ ÏûÖÎ†•Ï∞ΩÏù¥ ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.</p>
                    
                    <div class="space-y-2">
                        <template x-for="day in ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº']">
                            <div class="flex items-center gap-2 p-2 rounded border" :class="newEmp.schedule[day].active ? 'border-blue-200 bg-blue-50' : 'border-slate-100 bg-slate-50'">
                                <!-- ÏöîÏùº Ï≤¥ÌÅ¨ -->
                                <label class="flex items-center min-w-[50px] cursor-pointer">
                                    <input type="checkbox" x-model="newEmp.schedule[day].active" class="rounded text-blue-600 mr-2">
                                    <span class="text-sm font-bold" x-text="day"></span>
                                </label>

                                <!-- ÏãúÍ∞Ñ ÏûÖÎ†• (ÌôúÏÑ±Ìôî Ïãú ÌëúÏãú) -->
                                <div class="flex-1 flex gap-2" x-show="newEmp.schedule[day].active">
                                    <div class="flex flex-col flex-1">
                                        <span class="text-[10px] text-slate-500">Í∑ºÎ¨¥ ÏãúÍ∞Ñ</span>
                                        <div class="flex items-center gap-1">
                                            <input type="time" x-model="newEmp.schedule[day].start" class="w-full p-1 text-xs border rounded">
                                            <span>~</span>
                                            <input type="time" x-model="newEmp.schedule[day].end" class="w-full p-1 text-xs border rounded">
                                        </div>
                                    </div>
                                    <div class="flex flex-col w-24">
                                        <span class="text-[10px] text-slate-500">Ìú¥Í≤å(Ï§ëÍ∞Ñ)</span>
                                        <select x-model="newEmp.schedule[day].breakTime" class="w-full p-1 text-xs border rounded bg-white">
                                            <option value="0">ÏóÜÏùå</option>
                                            <option value="30">30Î∂Ñ</option>
                                            <option value="60">60Î∂Ñ</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex-1 text-xs text-slate-400 text-center" x-show="!newEmp.schedule[day].active">Ìú¥Î¨¥</div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="flex gap-3 pt-2">
                    <button type="button" @click="showEmpModal = false" class="flex-1 py-3 bg-gray-100 text-slate-700 rounded-lg font-bold">Ï∑®ÏÜå</button>
                    <button type="submit" class="flex-1 py-3 bg-blue-600 text-white rounded-lg font-bold shadow-md">ÏßÅÏõê Îì±Î°ù ÏôÑÎ£å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [Î™®Îã¨ 2] Í∑ºÎ¨¥ Îì±Î°ù/ÏàòÏ†ï -->
    <div x-show="showShiftModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4" x-cloak x-transition>
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-xs" @click.away="closeShiftModal()">
            <h3 class="text-lg font-bold mb-1 text-slate-800" x-text="isEditMode ? 'Í∑ºÎ¨¥ ÏàòÏ†ï/ÏÇ≠Ï†ú' : 'Í∑ºÎ¨¥ Îì±Î°ù'"></h3>
            <p class="text-sm text-blue-600 font-medium mb-5" x-text="targetDateStr"></p>
            
            <form @submit.prevent="saveShift" class="space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">ÏßÅÏõê ÏÑ†ÌÉù</label>
                    <select x-model="newShift.empId" class="w-full p-2.5 border rounded-lg bg-white" :disabled="isEditMode">
                        <template x-for="emp in employees" :key="emp.id">
                            <option :value="emp.id" x-text="emp.name"></option>
                        </template>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">ÏãúÏûë</label>
                        <input x-model="newShift.startTime" type="time" class="w-full p-2.5 border rounded-lg text-center" required>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">Ï¢ÖÎ£å</label>
                        <input x-model="newShift.endTime" type="time" class="w-full p-2.5 border rounded-lg text-center" required>
                    </div>
                </div>

                <div class="flex gap-2 pt-2">
                    <button type="button" @click="closeShiftModal()" class="flex-1 py-2.5 bg-gray-100 text-slate-700 rounded-lg font-medium">Ï∑®ÏÜå</button>
                    
                    <!-- ÏàòÏ†ï Î™®ÎìúÏùº ÎïåÎßå ÏÇ≠Ï†ú Î≤ÑÌäº ÌëúÏãú -->
                    <template x-if="isEditMode">
                        <button type="button" @click="deleteShift()" class="flex-1 py-2.5 bg-red-100 text-red-600 rounded-lg font-medium">ÏÇ≠Ï†ú</button>
                    </template>
                    
                    <button type="submit" class="flex-1 py-2.5 bg-blue-600 text-white rounded-lg font-medium shadow-md">Ï†ÄÏû•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÏßÅ -->
    <script>
        function hrApp() {
            return {
                activeTab: 'employees',
                currentDate: new Date(), // ÌòÑÏû¨ ÎÇ†Ïßú (Ï∫òÎ¶∞Îçî/Í∏âÏó¨ Í∏∞Ï§Ä)
                
                // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞: ÍπÄÎèÑÏú§ Ìè¨Ìï®
                employees: [
                    { 
                        id: 1, name: 'ÍπÄÎß§ÎãàÏ†Ä', role: 'manager', contractType: 'insurance4', basePay: 2200000, joinDate: '2024-01-01', contractStatus: 'signed',
                        schedule: {} // Í∏∞Ï°¥ ÏßÅÏõêÏùÄ Ïä§ÏºÄÏ§Ñ ÎπÑÏõåÎë† (ÏòàÏãú)
                    },
                    { 
                        id: 4, name: 'ÍπÄÎèÑÏú§', role: 'parttime', contractType: 'freelancer', basePay: 10500, joinDate: '2025-12-01', contractStatus: 'signed',
                        schedule: { // ÏòàÏãú Í≥ÑÏïΩ Ïä§ÏºÄÏ§Ñ
                            'Ïõî': { active: true, start: '09:00', end: '18:00', breakTime: 60 },
                            'Ïàò': { active: true, start: '09:00', end: '18:00', breakTime: 60 }
                        }
                    }
                ],
                // Í∑ºÎ¨¥ Í∏∞Î°ù (ÍπÄÎèÑÏú§ 12Ïõî Îç∞Ïù¥ÌÑ∞ Ìè¨Ìï®)
                shifts: [
                    { id: 101, date: '2025-12-01', empId: 4, startTime: '09:00', endTime: '18:00' },
                    { id: 102, date: '2025-12-02', empId: 4, startTime: '09:00', endTime: '14:00' },
                    { id: 103, date: '2025-12-03', empId: 4, startTime: '09:00', endTime: '14:00' },
                    { id: 104, date: '2025-12-04', empId: 4, startTime: '09:00', endTime: '18:00' },
                    { id: 105, date: '2025-12-05', empId: 4, startTime: '09:00', endTime: '18:00' },
                ],

                // Î™®Îã¨ ÏÉÅÌÉú
                showEmpModal: false,
                showShiftModal: false,
                isEditMode: false,      // ÏàòÏ†ï Î™®Îìú Ïó¨Î∂Ä
                editingShiftId: null,   // ÏàòÏ†ï Ï§ëÏù∏ ÏãúÌîÑÌä∏ ID
                targetDateStr: '',
                
                // Ìèº Îç∞Ïù¥ÌÑ∞ Î™®Îç∏
                newEmp: { 
                    name: '', role: 'parttime', contractType: 'insurance4', basePay: 10030, joinDate: '',
                    schedule: {
                        'Ïõî': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Ìôî': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Ïàò': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Î™©': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Í∏à': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'ÌÜ†': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Ïùº': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                    }
                },
                newShift: { empId: 1, startTime: '09:00', endTime: '14:00' },

                // --- Ï¥àÍ∏∞Ìôî ---
                initApp() {
                    // ÍπÄÎèÑÏú§ ÌÖåÏä§Ìä∏Î•º ÏúÑÌï¥ 2025ÎÖÑ 12ÏõîÎ°ú Ïù¥Îèô
                    this.currentDate = new Date(2025, 11, 1); 
                    this.refreshIcons();
                    this.$watch('activeTab', () => this.refreshIcons());
                },
                refreshIcons() { setTimeout(() => { if(window.lucide) window.lucide.createIcons(); }, 50); },

                // --- Ìó¨Ìçº Ìï®Ïàò ---
                tabName(t) { return {'employees':'ÏßÅÏõê Í¥ÄÎ¶¨','calendar':'Í∑ºÎ¨¥ Ïä§ÏºÄÏ§Ñ','payroll':'Í∏âÏó¨ Ï†ïÏÇ∞'}[t]; },
                formatCurrency(v) { return Math.floor(v).toLocaleString() + 'Ïõê'; },
                formatRole(r) { return {'manager':'Îß§ÎãàÏ†Ä','parttime':'ÏïÑÎ•¥Î∞îÏù¥Ìä∏','staff':'Ï†ïÍ∑úÏßÅ'}[r]; },
                getEmpName(id) { const e = this.employees.find(x => x.id == id); return e ? e.name : '-'; },

                // --- Ï∫òÎ¶∞Îçî Î°úÏßÅ ---
                getCurrentYearMonth() { return `${this.currentDate.getFullYear()}ÎÖÑ ${this.currentDate.getMonth() + 1}Ïõî`; },
                getCalendarDays() {
                    const y = this.currentDate.getFullYear(), m = this.currentDate.getMonth();
                    const lastDay = new Date(y, m + 1, 0).getDate();
                    const firstDayIdx = new Date(y, m, 1).getDay();
                    let days = [];
                    for(let i=0; i<firstDayIdx; i++) days.push({ key: `b-${i}`, day: null });
                    for(let i=1; i<=lastDay; i++) {
                        const dStr = String(i).padStart(2,'0'), mStr = String(m+1).padStart(2,'0');
                        days.push({ key: `d-${i}`, day: i, fullDate: `${y}-${mStr}-${dStr}` });
                    }
                    return days;
                },
                changeMonth(off) { this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + off, 1); },
                getShifts(date) { return this.shifts.filter(s => s.date === date); },

                // --- Î™®Îã¨ & Ïï°ÏÖò ---
                openEmpModal() {
                    this.newEmp = { 
                        name: '', role: 'parttime', contractType: 'insurance4', basePay: 10030, joinDate: new Date().toISOString().split('T')[0],
                        schedule: {
                            'Ïõî': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                            'Ìôî': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                            'Ïàò': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                            'Î™©': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                            'Í∏à': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                            'ÌÜ†': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                            'Ïùº': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        }
                    };
                    this.showEmpModal = true;
                },
                addEmployee() {
                    const empId = Date.now();
                    // ÍπäÏùÄ Î≥µÏÇ¨Î°ú Ïä§ÏºÄÏ§Ñ Ï†ÄÏû•
                    const scheduleCopy = JSON.parse(JSON.stringify(this.newEmp.schedule));
                    this.employees.push({ id: empId, ...this.newEmp, schedule: scheduleCopy, contractStatus: 'draft' });
                    this.showEmpModal = false;
                },

                // Í∑ºÎ¨¥ Îì±Î°ù/ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞
                openShiftModal(day) {
                    const y = this.currentDate.getFullYear();
                    const m = String(this.currentDate.getMonth() + 1).padStart(2,'0');
                    const d = String(day).padStart(2,'0');
                    this.targetDateStr = `${y}-${m}-${d}`;
                    
                    this.isEditMode = false;
                    this.editingShiftId = null;
                    this.newShift = { empId: this.employees[0]?.id, startTime: '09:00', endTime: '18:00' };
                    this.showShiftModal = true;
                },
                openEditShiftModal(shift) {
                    this.targetDateStr = shift.date;
                    this.isEditMode = true;
                    this.editingShiftId = shift.id;
                    this.newShift = { empId: shift.empId, startTime: shift.startTime, endTime: shift.endTime };
                    this.showShiftModal = true;
                },
                closeShiftModal() { this.showShiftModal = false; },

                // Í∑ºÎ¨¥ Ï†ÄÏû• (Ï∂îÍ∞Ä Î∞è ÏàòÏ†ï)
                saveShift() {
                    if (this.isEditMode) {
                        // ÏàòÏ†ï Î°úÏßÅ
                        const idx = this.shifts.findIndex(s => s.id === this.editingShiftId);
                        if (idx !== -1) {
                            this.shifts[idx] = { 
                                ...this.shifts[idx], 
                                startTime: this.newShift.startTime, 
                                endTime: this.newShift.endTime 
                            };
                        }
                    } else {
                        // Ï∂îÍ∞Ä Î°úÏßÅ
                        this.shifts.push({ 
                            id: Date.now(), 
                            date: this.targetDateStr, 
                            empId: parseInt(this.newShift.empId), 
                            startTime: this.newShift.startTime, 
                            endTime: this.newShift.endTime 
                        });
                    }
                    this.showShiftModal = false;
                    this.refreshIcons();
                },
                deleteShift() {
                    if (!this.isEditMode || !this.editingShiftId) return;
                    this.shifts = this.shifts.filter(s => s.id !== this.editingShiftId);
                    this.showShiftModal = false;
                },

                // --- Í∏âÏó¨ Ï†ïÏÇ∞ Î°úÏßÅ (Í≥†ÎèÑÌôî) ---
                calculatePayroll(emp) {
                    let base = 0, juhyu = 0, night = 0, pos = 0;
                    const ym = `${this.currentDate.getFullYear()}-${String(this.currentDate.getMonth() + 1).padStart(2, '0')}`;
                    const myShifts = this.shifts.filter(s => s.date.startsWith(ym) && s.empId === emp.id);

                    // ÏÉÅÏÑ∏ ÎÇ¥Ïó≠Ïö© Îç∞Ïù¥ÌÑ∞
                    let totalHours = 0;
                    let weekLogs = {};
                    let dailyLogs = [];

                    // 1. Í∑ºÎ¨¥ ÏßëÍ≥Ñ
                    myShifts.forEach(s => {
                        let h = (new Date(`2000-01-01T${s.endTime}`) - new Date(`2000-01-01T${s.startTime}`)) / 3600000;
                        if(h < 0) h += 24;
                        
                        // Ìú¥Í≤å Í≥µÏ†ú (Í≥ÑÏïΩ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÎã§Î©¥ Ìï¥Îãπ ÏöîÏùº Ìú¥Í≤å Ï†ÅÏö©, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Î°úÏßÅ)
                        const dayName = ['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'][new Date(s.date).getDay()];
                        const contractDay = emp.schedule && emp.schedule[dayName];
                        
                        if (contractDay && contractDay.active) {
                            h -= (contractDay.breakTime / 60);
                        } else {
                            // Í∏∞Î≥∏ Î£∞: 8ÏãúÍ∞Ñ Ïù¥ÏÉÅ 1ÏãúÍ∞Ñ, 4ÏãúÍ∞Ñ Ïù¥ÏÉÅ 30Î∂Ñ
                            if(h >= 8) h -= 1; else if(h >= 4) h -= 0.5;
                        }
                        if (h < 0) h = 0; // ÏùåÏàò Î∞©ÏßÄ

                        totalHours += h;
                        
                        // ÏùºÎ≥Ñ Î°úÍ∑∏ Ï†ÄÏû•
                        dailyLogs.push({ date: s.date, timeRange: `${s.startTime}~${s.endTime}`, hours: h.toFixed(1) });

                        // Ïã¨Ïïº (Í∞ÑÏù¥)
                        const st = parseInt(s.startTime.split(':')[0]);
                        if(st >= 22 || st < 6) night += (h * 800); // ÌååÌä∏ÌÉÄÏûÑ Í∞ÑÏù¥

                        // Ï£ºÌú¥Ïö© Ï£ºÏ∞® ÏßëÍ≥Ñ
                        const d = new Date(s.date);
                        // ISO Ï£ºÏ∞® Í∞úÎÖê ÎòêÎäî Í∞ÑÎã®Ìïú Ïõî Ï£ºÏ∞® (Ïó¨Í∏∞ÏÑ† Í∞ÑÎã®Ìûà ÎÇ†Ïßú Í∏∞Ï§Ä 7Ïùº Îã®ÏúÑ)
                        const weekNum = Math.ceil(d.getDate() / 7);
                        weekLogs[weekNum] = { hours: (weekLogs[weekNum]?.hours || 0) + h };
                    });

                    // ÎÇ†ÏßúÏàú Ï†ïÎ†¨
                    dailyLogs.sort((a,b) => a.date.localeCompare(b.date));

                    if(emp.role === 'parttime') {
                        base = totalHours * emp.basePay;
                        
                        // Ï£ºÌú¥ÏàòÎãπ Í≥ÑÏÇ∞
                        Object.keys(weekLogs).forEach(w => {
                            const wh = weekLogs[w].hours;
                            weekLogs[w].hours = wh.toFixed(1); // ÌëúÏãúÏö© ÏÜåÏàòÏ†ê
                            if(wh >= 15) {
                                // 40ÏãúÍ∞Ñ ÎπÑÎ°Ä (ÏµúÎåÄ 8ÏãúÍ∞Ñ)
                                const juhyuHours = Math.min(wh, 40) / 40 * 8;
                                juhyu += juhyuHours * emp.basePay;
                            }
                        });
                    } else {
                        base = emp.basePay;
                        if(emp.role === 'manager') pos = 200000;
                    }

                    const gross = Math.floor(base + juhyu + night + pos);
                    
                    // Í≥µÏ†ú ÏÉÅÏÑ∏ Í≥ÑÏÇ∞
                    let deductions = { pension:0, health:0, care:0, employ:0, tax:0, total:0 };
                    
                    if (emp.contractType === 'freelancer') {
                        deductions.tax = Math.floor(gross * 0.033 / 10) * 10; // ÏÜåÎìùÏÑ∏+ÏßÄÎ∞©ÏÑ∏ ÌÜµÌï© 3.3%
                    } else {
                        deductions.pension = Math.floor(gross * 0.045 / 10) * 10;
                        deductions.health = Math.floor(gross * 0.03545 / 10) * 10;
                        deductions.care = Math.floor(deductions.health * 0.1295 / 10) * 10;
                        deductions.employ = Math.floor(gross * 0.009 / 10) * 10;
                        // Í∞ÑÏù¥ÏÑ∏Ïï° ÎåÄÏã† ÏïΩÏãù 1%
                        const incomeTax = Math.floor(gross * 0.01 / 10) * 10;
                        const localTax = Math.floor(incomeTax * 0.1 / 10) * 10;
                        deductions.tax = incomeTax + localTax;
                    }
                    
                    deductions.total = deductions.pension + deductions.health + deductions.care + deductions.employ + deductions.tax;

                    return { 
                        basePay: base, juhyuAllowance: juhyu, nightAllowance: night, 
                        grossTotal: gross, deductions: deductions, netPay: gross - deductions.total,
                        details: {
                            totalHours: totalHours.toFixed(1),
                            workDays: myShifts.length,
                            weekLogs: weekLogs,
                            dailyLogs: dailyLogs
                        }
                    };
                }
            };
        }
    </script>
</body>
</html>
