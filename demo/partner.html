<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoGenie Partner</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.3/umd/Recharts.js"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .chat-bubble { max-width: 85%; padding: 10px 14px; border-radius: 16px; font-size: 14px; margin-bottom: 10px; }
        .chat-user { background-color: #2563eb; color: white; border-bottom-right-radius: 4px; margin-left: auto; }
        .chat-bot { background-color: white; color: #1e293b; border-bottom-left-radius: 4px; margin-right: auto; border: 1px solid #e2e8f0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { PieChart, Pie, Cell, ResponsiveContainer } = Recharts;
        
        // 1. Partner Context (Based on OKR Report)
        const PARTNER_CONTEXT = `
        [ë§¤ì¥: ìŠ¬ë¨ë²„ê±° ê°•ë‚¨ì  (ê¸°ì¡´ì )]
        1. 10ì›” ì„±ê³¼: ë§¤ì¶œ 9,885ë§Œì›. ì „ì‚¬ì ìœ¼ë¡œ ê¸°ì¡´ì ì˜ ì„±ì¥ì´ ì •ì²´ë˜ëŠ” ì¶”ì„¸ì´ë¯€ë¡œ ìˆ˜ìµì„± ê°œì„ ì´ í•µì‹¬ ëª©í‘œì„.
        2. ë³¸ì‚¬ ì§€ì¹¨:
           - ì–‘ìƒì¶” ì›ê°€ í­ë“±ìœ¼ë¡œ 'ìŠ¤ë§ˆíŠ¸íŒœ ì–‘ìƒì¶”'ê°€ ë„ì…ë  ì˜ˆì •ì…ë‹ˆë‹¤.
           - ìˆ˜ìµì„± ê°œì„ ì„ ìœ„í•´ 'ë°°ë‹¬ í”Œë«í¼ ê´‘ê³  íš¨ìœ¨í™”'ë¥¼ ì ê·¹ ê¶Œì¥í•©ë‹ˆë‹¤.
           - 'ê°ˆë¹„ë²„ê±°' ì£¼ë¬¸ëŸ‰ì´ ê¸‰ì¦í•˜ê³  ìˆìœ¼ë‹ˆ ì¬ê³  ê´€ë¦¬ì— ìœ ì˜í•˜ì„¸ìš”.
        3. ë§¤ë‰´ì–¼: ê°ˆë¹„ë²„ê±° ì†ŒìŠ¤ ì •ëŸ‰(25g) ì¤€ìˆ˜, ë§ˆê° ì‹œ í›„ë“œ ì²­ì†Œ í•„ìˆ˜.
        `;

        const API_KEY = ""; // â˜… ì—¬ê¸°ì— ë°œê¸‰ë°›ì€ Gemini API Keyë¥¼ ì…ë ¥í•˜ë©´ ì‹¤ì œ ì‘ë™í•©ë‹ˆë‹¤.

        // Components
        const Chatbot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([{ role: 'model', text: 'ì‚¬ì¥ë‹˜, ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?' }]);
            const [input, setInput] = useState('');
            const scrollRef = useRef(null);

            useEffect(() => { if(scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [messages]);

            const send = async () => {
                if (!input.trim()) return;
                const msg = input;
                setMessages(prev => [...prev, { role: 'user', text: msg }]);
                setInput('');

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: `Context:\n${PARTNER_CONTEXT}\n\nUser Question: ${msg}\n\nAnswer as a Store Manager AI.` }] }] })
                    });
                    if(!res.ok) throw new Error('API Error');
                    const data = await res.json();
                    setMessages(prev => [...prev, { role: 'model', text: data.candidates[0].content.parts[0].text }]);
                } catch (e) {
                    setTimeout(() => setMessages(prev => [...prev, { role: 'model', text: 'ì–‘ìƒì¶” ê°€ê²© í­ë“±ìœ¼ë¡œ ì¸í•´ ë³¸ì‚¬ì—ì„œ ìŠ¤ë§ˆíŠ¸íŒœ ê³„ì•½ ì¬ë°°ë¥¼ ì¶”ì§„ ì¤‘ì…ë‹ˆë‹¤. ê³§ ì•ˆì •ë  ì˜ˆì •ì…ë‹ˆë‹¤.' }]), 1000);
                }
            };

            if(!isOpen) return <button onClick={()=>setIsOpen(true)} className="fixed bottom-24 right-4 bg-blue-600 text-white p-4 rounded-full shadow-xl z-50"><i data-lucide="message-circle" className="w-6 h-6"></i></button>;

            return (
                <div className="fixed inset-0 z-50 bg-white flex flex-col md:bottom-24 md:right-4 md:left-auto md:top-auto md:w-96 md:h-[500px] md:rounded-2xl md:shadow-2xl md:border">
                    <div className="bg-blue-600 text-white p-4 flex justify-between items-center">
                        <span className="font-bold flex gap-2"><i data-lucide="bot"></i> ìŠ¬ë¨ì§€ë‹ˆ</span>
                        <button onClick={()=>setIsOpen(false)}><i data-lucide="x"></i></button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 bg-slate-50" ref={scrollRef}>
                        {messages.map((m, i) => <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}><div className={`chat-bubble ${m.role==='user'?'chat-user':'chat-bot'}`}>{m.text}</div></div>)}
                    </div>
                    <div className="p-3 border-t flex gap-2">
                        <input className="flex-1 border rounded-xl px-4 py-3 outline-none" placeholder="ì§ˆë¬¸ ì…ë ¥..." value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} />
                        <button onClick={send} className="bg-blue-600 text-white p-3 rounded-xl"><i data-lucide="send"></i></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [tab, setTab] = useState('home');
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); });

            return (
                <div className="bg-slate-50 min-h-screen max-w-md mx-auto shadow-2xl relative overflow-hidden pb-20">
                    <div className="bg-blue-600 pt-12 pb-16 px-6 rounded-b-[2rem] text-white shadow-lg">
                        <div className="flex items-center gap-2 mb-1 opacity-90"><span className="bg-white/20 px-2 py-0.5 rounded text-xs font-bold">AI ë¹„ì„œ</span><span className="text-xs">ë¸Œë¦¬í•‘</span></div>
                        <h2 className="text-2xl font-bold">ì•ˆë…•í•˜ì„¸ìš”, ê°•ë‚¨ì ì£¼ë‹˜!</h2>
                        <p className="text-sm text-blue-100 mt-2">ğŸ’¡ ë³¸ì‚¬ ì•Œë¦¼: ì–‘ìƒì¶” ì›ê°€ìœ¨ ìƒìŠ¹ ì´ìŠˆê°€ ìˆìŠµë‹ˆë‹¤. ì¬ê³  ê´€ë¦¬ì— ìœ ì˜í•´ì£¼ì„¸ìš”.</p>
                    </div>
                    
                    <div className="px-6 -mt-8 grid grid-cols-2 gap-4">
                        <div className="bg-white p-5 rounded-2xl shadow-md"><p className="text-slate-400 text-xs mb-1">ì˜¤ëŠ˜ ë§¤ì¶œ</p><h3 className="text-xl font-bold">â‚©3,850,510</h3></div>
                        <div className="bg-white p-5 rounded-2xl shadow-md"><p className="text-slate-400 text-xs mb-1">10ì›” ìˆœìˆ˜ìµ</p><h3 className="text-xl font-bold text-blue-600">â‚©21,500,000</h3></div>
                    </div>

                    <div className="px-6 mt-6">
                        <h3 className="font-bold text-lg mb-4 text-slate-800">ìˆ˜ìµì„± ë¶„ì„</h3>
                        <div className="bg-white p-6 rounded-3xl shadow-sm h-64">
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie data={[{name:'ì¬ë£Œ',value:36.5,fill:'#3b82f6'},{name:'ì´ìµ',value:21.7,fill:'#22c55e'},{name:'ê¸°íƒ€',value:41.8,fill:'#e2e8f0'}]} innerRadius={60} outerRadius={80} dataKey="value" />
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    <Chatbot />
                    <nav className="fixed bottom-0 w-full max-w-md bg-white border-t flex justify-around py-3 z-40 rounded-t-2xl">
                        {['home','pie-chart','zap','menu'].map((icon,i) => (
                            <button key={i} onClick={()=>setTab(icon==='home'?'home':'other')} className={`flex flex-col items-center ${tab===(icon==='home'?'home':'other')?'text-blue-600':'text-slate-300'}`}><i data-lucide={icon} className="w-6 h-6"></i></button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
