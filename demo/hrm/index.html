<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>레스토지니 HR 매니지먼트</title>

    <!-- 1. 폰트 & 스타일 -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] },
                    colors: {
                        rg: {
                            primary: '#2563EB',
                            bg: '#F8FAFC',
                            text: '#0F172A',
                            border: '#E2E8F0'
                        }
                    }
                }
            }
        }
    </script>

    <!-- 2. 아이콘 -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 3. 로직 (Alpine.js) - defer 속성 추가 및 로직 정의 -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #F8FAFC; }
        /* x-cloak 제거됨: 콘텐츠가 즉시 렌더링 됩니다. */
    </style>
</head>
<body class="text-slate-800 antialiased" x-data="hrApp">

    <!-- 헤더 -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold bg-rg-primary">R</div>
                <h1 class="text-xl font-bold text-slate-800">RestoGenie HR</h1>
            </div>
            <nav class="flex space-x-1">
                <button @click="activeTab = 'employees'" :class="activeTab === 'employees' ? 'text-blue-600 bg-blue-50' : 'text-slate-500'" class="px-4 py-2 rounded-md text-sm font-medium transition">직원 관리</button>
                <button @click="activeTab = 'calendar'" :class="activeTab === 'calendar' ? 'text-blue-600 bg-blue-50' : 'text-slate-500'" class="px-4 py-2 rounded-md text-sm font-medium transition">근무 스케줄</button>
                <button @click="activeTab = 'payroll'" :class="activeTab === 'payroll' ? 'text-blue-600 bg-blue-50' : 'text-slate-500'" class="px-4 py-2 rounded-md text-sm font-medium transition">급여 정산</button>
            </nav>
        </div>
    </header>

    <!-- 메인 컨텐츠 (x-cloak 제거하여 즉시 표시) -->
    <main class="max-w-5xl mx-auto p-6">

        <!-- 탭 1: 직원 관리 -->
        <div x-show="activeTab === 'employees'" class="space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">직원 리스트</h2>
                <button @click="openEmpModal()" class="flex items-center space-x-2 text-white px-4 py-2 rounded-lg bg-rg-primary hover:bg-blue-700">
                    <i data-lucide="plus" class="w-4 h-4"></i> <span>직원 등록</span>
                </button>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 text-slate-500 text-sm">
                        <tr>
                            <th class="p-4 font-medium">이름 / 직책</th>
                            <th class="p-4 font-medium">계약 형태</th>
                            <th class="p-4 font-medium">급여 조건</th>
                            <th class="p-4 font-medium">입사일</th>
                            <th class="p-4 font-medium">상태</th>
                            <th class="p-4 text-right">관리</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        <template x-for="emp in employees" :key="emp.id">
                            <tr class="hover:bg-slate-50">
                                <td class="p-4">
                                    <div class="font-bold" x-text="emp.name"></div>
                                    <div class="text-xs text-slate-500 uppercase" x-text="formatRole(emp.role)"></div>
                                </td>
                                <td class="p-4 text-sm text-slate-600" x-text="emp.contractType === 'insurance4' ? '4대보험' : '프리랜서(3.3%)'"></td>
                                <td class="p-4 text-sm font-medium text-slate-700">
                                    <span x-text="formatCurrency(emp.basePay)"></span>
                                    <span class="text-xs font-normal text-slate-400 ml-1" x-text="emp.role === 'parttime' ? '/ 시급' : '/ 월급'"></span>
                                </td>
                                <td class="p-4 text-sm text-slate-600" x-text="emp.joinDate"></td>
                                <td class="p-4">
                                    <span class="px-2 py-1 rounded-full text-xs font-medium"
                                          :class="emp.contractStatus === 'signed' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'"
                                          x-text="formatStatus(emp.contractStatus)"></span>
                                </td>
                                <td class="p-4 text-right">
                                    <button @click="sendContract(emp.id)" class="text-sm px-3 py-1.5 rounded border border-blue-200 text-blue-600 hover:bg-blue-50">계약 발송</button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 탭 2: 캘린더 -->
        <div x-show="activeTab === 'calendar'" class="space-y-4">
             <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">근무 스케줄</h2>
                <div class="flex items-center bg-white rounded-lg border p-1">
                    <button @click="changeMonth(-1)" class="p-1 hover:bg-slate-100 rounded"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                    <span class="mx-4 font-semibold text-slate-700" x-text="currentYearMonth"></span>
                    <button @click="changeMonth(1)" class="p-1 hover:bg-slate-100 rounded"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <div class="grid grid-cols-7 mb-2 text-center text-sm font-medium text-slate-500">
                    <div class="text-red-500">일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div class="text-blue-500">토</div>
                </div>
                <div class="grid grid-cols-7 gap-0 border-t border-l border-slate-200">
                    <template x-for="d in calendarDays" :key="d.key">
                        <div @click="d.day ? openShiftModal(d.day) : null" 
                             class="h-24 border-r border-b border-gray-200 p-1 relative bg-white"
                             :class="d.day ? 'cursor-pointer hover:bg-blue-50' : 'bg-gray-50'">
                            <div class="text-xs font-semibold text-gray-500 mb-1" x-text="d.day || ''"></div>
                            <div class="overflow-y-auto h-16 space-y-1">
                                <template x-for="shift in getShifts(d.fullDate)">
                                    <div class="text-[10px] bg-blue-100 text-blue-800 px-1 rounded truncate">
                                        <span x-text="getEmpName(shift.empId)"></span>
                                        <span x-text="`${shift.startTime}~${shift.endTime}`"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- 탭 3: 급여 정산 -->
        <div x-show="activeTab === 'payroll'" class="space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold" x-text="`${currentDate.getMonth() + 1}월 급여 정산`"></h2>
                <div class="text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded">기준: 2025년 최저시급 10,030원</div>
            </div>
            <div class="grid gap-6">
                <template x-for="emp in employees" :key="emp.id">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6" x-data="{ pay: calculatePayroll(emp) }">
                        <div class="flex justify-between items-start mb-4 border-b pb-4">
                            <div>
                                <h3 class="text-lg font-bold text-slate-800" x-text="emp.name"></h3>
                                <p class="text-sm text-slate-500" x-text="formatRole(emp.role)"></p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-slate-500">실수령액</div>
                                <div class="text-2xl font-bold text-rg-primary" x-text="formatCurrency(pay.netPay)"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-8 text-sm">
                            <div>
                                <div class="flex justify-between mb-1"><span class="text-slate-500">기본급</span><span x-text="formatCurrency(pay.basePay)"></span></div>
                                <div class="flex justify-between mb-1 text-blue-600" x-show="pay.juhyuAllowance > 0"><span>주휴수당</span><span x-text="`+ ${formatCurrency(pay.juhyuAllowance)}`"></span></div>
                                <div class="flex justify-between mb-1 text-blue-600" x-show="pay.nightAllowance > 0"><span>심야수당</span><span x-text="`+ ${formatCurrency(pay.nightAllowance)}`"></span></div>
                                <div class="flex justify-between font-bold border-t pt-2 mt-2"><span>세전 총액</span><span x-text="formatCurrency(pay.grossTotal)"></span></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-red-500"><span>공제 합계</span><span x-text="`- ${formatCurrency(pay.deductions)}`"></span></div>
                                <p class="text-xs text-slate-400 mt-2">* 4대보험/세금(3.3%) 포함</p>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

    </main>

    <!-- 모달: 직원 등록 -->
    <div x-show="showEmpModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-xl p-6 w-96" @click.away="showEmpModal = false">
            <h3 class="text-lg font-bold mb-4">직원 등록</h3>
            <form @submit.prevent="addEmployee" class="space-y-4">
                <input x-model="newEmp.name" class="w-full p-2 border rounded" placeholder="이름" required>
                <select x-model="newEmp.role" class="w-full p-2 border rounded">
                    <option value="parttime">아르바이트</option>
                    <option value="staff">정규직</option>
                    <option value="manager">매니저</option>
                </select>
                <select x-model="newEmp.contractType" class="w-full p-2 border rounded">
                    <option value="insurance4">4대보험</option>
                    <option value="freelancer">프리랜서(3.3%)</option>
                </select>
                <input x-model.number="newEmp.basePay" type="number" class="w-full p-2 border rounded" placeholder="급여">
                <div class="flex gap-2">
                    <button type="button" @click="showEmpModal = false" class="flex-1 py-2 bg-gray-100 rounded">취소</button>
                    <button type="submit" class="flex-1 py-2 bg-blue-600 text-white rounded">등록</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 모달: 근무 등록 -->
    <div x-show="showShiftModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-xl p-6 w-80" @click.away="showShiftModal = false">
            <h3 class="text-lg font-bold mb-1">근무 등록</h3>
            <p class="text-sm text-slate-500 mb-4" x-text="targetDateStr"></p>
            <form @submit.prevent="addShift" class="space-y-4">
                <select x-model="newShift.empId" class="w-full p-2 border rounded">
                    <template x-for="emp in employees" :key="emp.id"><option :value="emp.id" x-text="emp.name"></option></template>
                </select>
                <div class="grid grid-cols-2 gap-2">
                    <input x-model="newShift.startTime" type="time" class="w-full p-2 border rounded" required>
                    <input x-model="newShift.endTime" type="time" class="w-full p-2 border rounded" required>
                </div>
                <div class="flex gap-2">
                    <button type="button" @click="showShiftModal = false" class="flex-1 py-2 bg-gray-100 rounded">취소</button>
                    <button type="submit" class="flex-1 py-2 bg-blue-600 text-white rounded">저장</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('hrApp', () => ({
                activeTab: 'employees',
                currentDate: new Date(),
                employees: [
                    { id: 1, name: '김매니저', role: 'manager', contractType: 'insurance4', basePay: 2200000, joinDate: '2024-01-01', contractStatus: 'signed' },
                    { id: 2, name: '이알바', role: 'parttime', contractType: 'insurance4', basePay: 10030, joinDate: '2025-01-15', contractStatus: 'draft' }
                ],
                shifts: [],
                showEmpModal: false,
                showShiftModal: false,
                targetDateStr: '',
                newEmp: { name: '', role: 'parttime', contractType: 'insurance4', basePay: 10030 },
                newShift: { empId: 1, startTime: '09:00', endTime: '14:00' },

                init() {
                    // 아이콘 렌더링
                    this.$watch('activeTab', () => setTimeout(() => lucide.createIcons(), 50));
                    setTimeout(() => lucide.createIcons(), 100);
                },

                // Getters
                get currentYearMonth() {
                    return `${this.currentDate.getFullYear()}년 ${this.currentDate.getMonth() + 1}월`;
                },
                get calendarDays() {
                    const year = this.currentDate.getFullYear();
                    const month = this.currentDate.getMonth();
                    const lastDay = new Date(year, month + 1, 0).getDate();
                    const firstDayIdx = new Date(year, month, 1).getDay();
                    
                    let days = [];
                    for(let i=0; i<firstDayIdx; i++) days.push({ key: `blank-${i}`, day: null });
                    for(let i=1; i<=lastDay; i++) {
                        const m = String(month + 1).padStart(2, '0');
                        const d = String(i).padStart(2, '0');
                        days.push({ key: `day-${i}`, day: i, fullDate: `${year}-${m}-${d}` });
                    }
                    return days;
                },

                // Actions
                changeMonth(offset) {
                    this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + offset, 1);
                },
                openEmpModal() {
                    this.newEmp = { name: '', role: 'parttime', contractType: 'insurance4', basePay: 10030 };
                    this.showEmpModal = true;
                },
                addEmployee() {
                    this.employees.push({ id: Date.now(), ...this.newEmp, contractStatus: 'draft', joinDate: new Date().toISOString().split('T')[0] });
                    this.showEmpModal = false;
                },
                openShiftModal(day) {
                    const year = this.currentDate.getFullYear();
                    const month = String(this.currentDate.getMonth() + 1).padStart(2, '0');
                    const d = String(day).padStart(2, '0');
                    this.targetDateStr = `${year}-${month}-${d}`;
                    this.showShiftModal = true;
                },
                addShift() {
                    this.shifts.push({ id: Date.now(), date: this.targetDateStr, empId: parseInt(this.newShift.empId), startTime: this.newShift.startTime, endTime: this.newShift.endTime });
                    this.showShiftModal = false;
                    setTimeout(() => lucide.createIcons(), 50);
                },
                sendContract(id) {
                    alert('전자근로계약서가 발송되었습니다.');
                    const emp = this.employees.find(e => e.id === id);
                    if(emp) emp.contractStatus = 'sent';
                },
                
                // Helpers
                formatCurrency(val) { return Math.floor(val).toLocaleString() + '원'; },
                formatRole(r) { return r === 'manager' ? '매니저' : (r === 'parttime' ? '아르바이트' : '정규직'); },
                formatStatus(s) { return s === 'signed' ? '서명완료' : (s === 'sent' ? '발송됨' : '미작성'); },
                getEmpName(id) { const e = this.employees.find(x => x.id == id); return e ? e.name : '-'; },
                getShifts(date) { return this.shifts.filter(s => s.date === date); },

                // 2025 Payroll Logic
                calculatePayroll(emp) {
                    // Logic similar to previous artifact, simplified for HTML embedding stability
                    let base = 0, juhyu = 0, night = 0, pos = 0;
                    const ym = `${this.currentDate.getFullYear()}-${String(this.currentDate.getMonth() + 1).padStart(2, '0')}`;
                    const myShifts = this.shifts.filter(s => s.date.startsWith(ym) && s.empId === emp.id);

                    if(emp.role === 'parttime') {
                        let totalH = 0, nightH = 0, weekH = {};
                        myShifts.forEach(s => {
                            let h = (new Date(`2000-01-01T${s.endTime}`) - new Date(`2000-01-01T${s.startTime}`)) / 3600000;
                            if(h < 0) h += 24;
                            if(h >= 4) h -= (h>=8 ? 1 : 0.5); // Break time
                            totalH += h;
                            
                            // Night calc (Simple)
                            const st = parseInt(s.startTime.split(':')[0]);
                            if(st >= 22 || st < 6) nightH += h;

                            // Week calc
                            const d = new Date(s.date);
                            const w = Math.ceil((d.getDate() - d.getDay()) / 7); // Approx week
                            weekH[w] = (weekH[w]||0) + h;
                        });
                        base = totalH * emp.basePay;
                        night = nightH * 800; // Custom Rule
                        Object.values(weekH).forEach(wh => { if(wh >= 15) juhyu += (Math.min(wh,40)/40)*8*emp.basePay; });
                    } else {
                        base = emp.basePay;
                        if(emp.role === 'manager') pos = 200000;
                        if(myShifts.some(s => parseInt(s.startTime) >= 22)) night = 100000;
                    }
                    
                    const gross = Math.floor(base + juhyu + night + pos);
                    const taxRate = emp.contractType === 'freelancer' ? 0.033 : 0.093; // Approx 4insure+tax
                    const ded = Math.floor(gross * taxRate / 10) * 10;
                    return { basePay: base, juhyuAllowance: juhyu, nightAllowance: night, grossTotal: gross, deductions: ded, netPay: gross - ded };
                }
            }));
        });
    </script>
</body>
</html>
