<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoGenie HQ - ê°€ë§¹ë³¸ì‚¬ í†µí•© ê´€ë¦¬</title>
    
    <!-- 1. React 17 (CDN í™˜ê²½ì—ì„œ ê°€ì¥ ì•ˆì •ì ) -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- 2. Babel (JSX ì»´íŒŒì¼ëŸ¬) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 4. Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 5. Recharts (React 17 í˜¸í™˜ ë²„ì „) -->
    <script src="https://unpkg.com/recharts@2.1.9/umd/Recharts.js"></script>

    <!-- Font: Pretendard -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Gemini Canvas Editor Style */
        .canvas-editor {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .typing-cursor::after { content: 'â–‹'; animation: blink 1s step-start infinite; color: #3b82f6; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Chat Bubble */
        .chat-bubble { max-width: 85%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; margin-bottom: 10px; }
        .chat-user { background-color: #1e3a8a; color: white; border-bottom-right-radius: 4px; margin-left: auto; }
        .chat-bot { background-color: white; color: #1e293b; border-bottom-left-radius: 4px; margin-right: auto; border: 1px solid #e2e8f0; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: { 800: '#1e293b', 900: '#0f172a' },
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        // Recharts ì»´í¬ë„ŒíŠ¸ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell } = Recharts;

        // --- 1. Context Data (OKR Report Integration) ---
        const API_KEY = "AIzaSyCILSrQKjRiupRcyNd1pFJUksNMkGVY8AQ"; 

        const OKR_CONTEXT = `
        [ì»¨íŠ¸ë¡¤ì—  2025ë…„ 10ì›” ì „ì‚¬ OKR ì¢…í•© ë¦¬í¬íŠ¸]
        1. í•µì‹¬ ì„±ê³¼: 10ì›” ì´ ë§¤ì¶œ 2ì–µ 7,361ë§Œì› (ëª©í‘œ ëŒ€ë¹„ 108%). ìŠ¬ë¨ë²„ê±° ëŒ€í•™ë¡œì  ì‹ ê·œ ì˜¤í”ˆì´ ë§¤ì¶œ ì„±ì¥ì„ ê²¬ì¸í•¨.
        2. ë§¤ì¥ í˜„í™©:
           - ëŒ€í•™ë¡œì (ì‹ ê·œ): ì˜¤í”„ë¼ì¸ í”„ë¡œëª¨ì…˜ ì ì¤‘ìœ¼ë¡œ ì¡°ê¸° ì•ˆì°©. ë‹¨, ì ì‹¬ í”¼í¬íƒ€ì„(12~13ì‹œ) ë³‘ëª© í˜„ìƒ ë°œìƒ.
           - ê°•ë‚¨ì (ê¸°ì¡´): ë§¤ì¶œ 9,885ë§Œì›. ë°°ë‹¬ ë¹„ì¤‘ ë†’ìŒ. ì„±ì¥ ì •ì²´ë¡œ ìˆ˜ìµì„± ê°œì„  í•„ìš”.
        3. ì´ìŠˆ: ì–‘ìƒì¶” ê°€ê²© í­ë“±ìœ¼ë¡œ ì›ê°€ìœ¨ 38.5% (+1.5%p) ê¸°ë¡. 'ìŠ¤ë§ˆíŠ¸íŒœ ê³„ì•½ ì¬ë°°' ë„ì… ê²°ì •.
        4. íŒŒíŠ¸ë„ˆì‹­: 'ë©”ì´ì•„ì´(Mei AI)'ì™€ ìœ ë™ì¸êµ¬ ë¶„ì„ ì¥ë¹„ ê³µë™ ê°œë°œ ì¤‘.
        `;

        // --- 2. Mock Data ---
        const STORES = [
            { id: 'all', name: 'ì „ì‚¬ (All Stores)' },
            { id: 'gangnam', name: 'ê°•ë‚¨ì ' },
            { id: 'daehangno', name: 'ëŒ€í•™ë¡œì ' },
            { id: 'sindang', name: 'ì‹ ë‹¹ì ' },
            { id: 'yeokgok', name: 'ì—­ê³¡ì ' }
        ];

        const getStoreData = (storeId) => {
            const isAll = storeId === 'all';
            const factor = isAll ? 1 : (storeId === 'gangnam' ? 0.36 : storeId === 'daehangno' ? 0.32 : 0.16);
            return {
                sales: Math.floor(273610500 * factor),
                orders: Math.floor(14520 * factor),
                ticket: isAll ? 18840 : 19200,
                costRate: isAll ? 38.5 : (storeId === 'daehangno' ? 41.2 : 36.5),
                adSpend: Math.floor(15000000 * factor),
                trend: [
                    { name: '1ì£¼', sales: Math.floor(62000000 * factor), ad: Math.floor(3500000 * factor) },
                    { name: '2ì£¼', sales: Math.floor(68000000 * factor), ad: Math.floor(3800000 * factor) },
                    { name: '3ì£¼', sales: Math.floor(71000000 * factor), ad: Math.floor(4000000 * factor) },
                    { name: '4ì£¼', sales: Math.floor(72610500 * factor), ad: Math.floor(3700000 * factor) },
                ]
            };
        };

        // --- 3. Error Boundary (ë°±ì§€ í˜„ìƒ ë°©ì§€) ---
        class ErrorBoundary extends React.Component {
            constructor(props) { super(props); this.state = { hasError: false, error: null }; }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            render() {
                if (this.state.hasError) return <div className="p-8 text-red-600 bg-red-50 rounded-xl m-4 border border-red-200"><h3>ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ</h3><p>{this.state.error.toString()}</p></div>;
                return this.props.children;
            }
        }

        // --- 4. Components ---

        // [Chatbot]
        const AIChatbot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([{ role: 'model', text: 'ì•ˆë…•í•˜ì„¸ìš”! 10ì›” OKR ë¦¬í¬íŠ¸ë¥¼ í•™ìŠµí•œ AI ë¹„ì„œì…ë‹ˆë‹¤.' }]);
            const [input, setInput] = useState('');
            const scrollRef = useRef(null);

            useEffect(() => { if(scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [messages]);

            const send = async () => {
                if (!input.trim()) return;
                const msg = input;
                setMessages(prev => [...prev, { role: 'user', text: msg }]);
                setInput('');
                
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Context:\n${OKR_CONTEXT}\n\nUser Question: ${msg}\n\nAnswer as a HQ Assistant.` }] }] })
                    });
                    const data = await res.json();
                    setMessages(prev => [...prev, { role: 'model', text: data.candidates[0].content.parts[0].text }]);
                } catch (e) {
                    setMessages(prev => [...prev, { role: 'model', text: `ì˜¤ë¥˜: ${e.message}` }]);
                }
            };

            return (
                <>
                    {!isOpen && <button onClick={()=>setIsOpen(true)} className="fixed bottom-6 right-6 bg-navy-800 text-white p-4 rounded-full shadow-xl hover:scale-105 transition z-50"><i data-lucide="message-square" className="w-6 h-6"></i></button>}
                    {isOpen && (
                        <div className="fixed bottom-6 right-6 z-50 w-96 h-[500px] bg-white rounded-2xl shadow-2xl border border-slate-200 flex flex-col animate-fade-in">
                            <div className="bg-navy-900 text-white p-4 rounded-t-2xl flex justify-between items-center">
                                <span className="font-bold flex gap-2"><i data-lucide="bot" className="w-5 h-5"></i> HQ AI ë¹„ì„œ</span>
                                <button onClick={()=>setIsOpen(false)}><i data-lucide="x" className="w-5 h-5"></i></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 bg-slate-50" ref={scrollRef}>
                                {messages.map((m, i) => <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}><div className={`chat-bubble ${m.role==='user'?'chat-user':'chat-bot'}`}>{m.text}</div></div>)}
                            </div>
                            <div className="p-3 border-t bg-white flex gap-2">
                                <input className="flex-1 border rounded-lg px-3 py-2 outline-none focus:ring-2 ring-brand-500" placeholder="ì§ˆë¬¸ ì…ë ¥..." value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} />
                                <button onClick={send} className="bg-brand-600 text-white p-2 rounded-lg"><i data-lucide="send" className="w-4 h-4"></i></button>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        // [Views]
        const DashboardView = ({ storeId }) => {
            const data = useMemo(() => getStoreData(storeId), [storeId]);
            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="grid grid-cols-4 gap-5">
                        <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100"><p className="text-slate-500 text-sm">ì´ ë§¤ì¶œ</p><h3 className="text-2xl font-bold text-navy-900">â‚©{data.sales.toLocaleString()}</h3></div>
                        <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100"><p className="text-slate-500 text-sm">ì£¼ë¬¸ìˆ˜</p><h3 className="text-2xl font-bold text-navy-900">{data.orders.toLocaleString()}ê±´</h3></div>
                        <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100"><p className="text-slate-500 text-sm">ì›ê°€ìœ¨</p><h3 className="text-2xl font-bold text-red-600">{data.costRate}% (â–²)</h3></div>
                        <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100"><p className="text-slate-500 text-sm">ê´‘ê³ ë¹„</p><h3 className="text-2xl font-bold text-navy-900">â‚©{data.adSpend.toLocaleString()}</h3></div>
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-80">
                        <h3 className="font-bold text-lg mb-4">ì£¼ê°„ ë§¤ì¶œ ì¶”ì´</h3>
                        <ResponsiveContainer width="100%" height="100%">
                            <LineChart data={data.trend}>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                <XAxis dataKey="name" />
                                <YAxis tickFormatter={v=>`${v/10000}ë§Œ`} />
                                <Tooltip formatter={v=>`â‚©${v.toLocaleString()}`} />
                                <Legend />
                                <Line type="monotone" dataKey="sales" stroke="#2563eb" strokeWidth={3} name="ë§¤ì¶œ" />
                                <Line type="monotone" dataKey="ad" stroke="#f59e0b" strokeWidth={2} name="ê´‘ê³ ë¹„" />
                            </LineChart>
                        </ResponsiveContainer>
                    </div>
                </div>
            );
        };

        const AIReportView = ({ credits, setCredits }) => {
            const [mode, setMode] = useState('weekly');
            const [result, setResult] = useState('');
            const [loading, setLoading] = useState(false);

            const generate = async () => {
                const cost = mode==='weekly' ? 5 : 1;
                if (credits < cost) return alert('ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                setCredits(c => c - cost);
                setLoading(true); setResult('');

                const prompt = mode === 'weekly' ? `${OKR_CONTEXT}\nì£¼ê°„ íšŒì˜ë¡ì„ ì‘ì„±í•´ì¤˜.` : `${OKR_CONTEXT}\nëŒ€í•™ë¡œì  ë§¤ì¥ ì ê²€ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì¤˜.`;
                
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();
                    const text = data.candidates[0].content.parts[0].text;
                    let i=0; const timer = setInterval(()=>{ setResult(p=>p+text.charAt(i)); i++; if(i>=text.length){clearInterval(timer); setLoading(false);} }, 10);
                } catch(e) { setResult("ì˜¤ë¥˜ ë°œìƒ"); setLoading(false); }
            };

            return (
                <div className="flex h-full gap-6 animate-fade-in">
                    <div className="w-1/3 bg-white p-6 rounded-xl border shadow-sm flex flex-col">
                        <h2 className="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="sparkles" className="text-brand-600"></i> ë¦¬í¬íŠ¸ ìƒì„±</h2>
                        <div className="flex gap-2 mb-6"><button onClick={()=>setMode('weekly')} className={`flex-1 py-2 rounded font-bold ${mode==='weekly'?'bg-brand-50 text-brand-600 border border-brand-200':'bg-slate-50 text-slate-500'}`}>ì£¼ê°„íšŒì˜ (5P)</button><button onClick={()=>setMode('inspection')} className={`flex-1 py-2 rounded font-bold ${mode==='inspection'?'bg-brand-50 text-brand-600 border border-brand-200':'bg-slate-50 text-slate-500'}`}>ë§¤ì¥ì ê²€ (1P)</button></div>
                        <div className="bg-blue-50 p-4 rounded-lg text-sm text-blue-800 mb-auto"><strong>ğŸ“š í•™ìŠµëœ ë°ì´í„°:</strong><br/>- 2025ë…„ 10ì›” OKR ë¦¬í¬íŠ¸<br/>- ìŠ¬ë¨ë²„ê±° ë§¤ì¶œ DB</div>
                        <button onClick={generate} disabled={loading} className="w-full bg-brand-600 text-white py-3 rounded-lg font-bold mt-4 hover:bg-brand-700 disabled:opacity-50">{loading ? "ìƒì„± ì¤‘..." : "ë¦¬í¬íŠ¸ ìƒì„±"}</button>
                    </div>
                    <div className="flex-1 bg-white p-8 rounded-xl border shadow-sm overflow-y-auto canvas-editor">
                        {result ? <div className="prose prose-sm max-w-none whitespace-pre-line typing-cursor">{result}</div> : <div className="h-full flex flex-col items-center justify-center text-slate-400"><i data-lucide="file-text" className="w-12 h-12 mb-2 opacity-50"></i><p>ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.</p></div>}
                    </div>
                </div>
            );
        };

        // Generic View for other menus
        const GenericView = ({ title, content }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-full animate-fade-in">
                <h2 className="text-xl font-bold text-navy-900 mb-4">{title}</h2>
                <div className="overflow-auto h-[calc(100%-40px)]">
                    <table className="w-full text-sm text-left">
                        <thead className="bg-slate-50 text-slate-500 border-b">
                            <tr><th className="p-3">í•­ëª©</th><th className="p-3">ìƒíƒœ</th><th className="p-3">ë‹´ë‹¹ì</th><th className="p-3">ì¼ì</th></tr>
                        </thead>
                        <tbody>
                            {[1,2,3,4,5].map(i => (
                                <tr key={i} className="border-b hover:bg-slate-50">
                                    <td className="p-3">{content} ë°ì´í„° #{i}</td>
                                    <td className="p-3"><span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">ì •ìƒ</span></td>
                                    <td className="p-3">ê´€ë¦¬ì</td>
                                    <td className="p-3">2025-11-18</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // [Main App]
        const App = () => {
            const [menu, setMenu] = useState('dashboard');
            const [storeId, setStoreId] = useState('all');
            const [credits, setCredits] = useState(100);
            const [isLoggedIn, setIsLoggedIn] = useState(false);

            useEffect(() => { lucide.createIcons(); }, [menu, isLoggedIn]);

            const handleLogin = (id, pw) => {
                if(id === 'demo' && pw === 'ctrlm2025!') setIsLoggedIn(true);
                else alert('ID: demo / PW: ctrlm2025!');
            };

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100">
                    <div className="bg-white p-10 rounded-2xl shadow-xl w-96 border border-slate-200">
                        <h1 className="text-2xl font-bold text-navy-900 mb-6 text-center">HQ Login</h1>
                        <form onSubmit={(e)=>{e.preventDefault(); handleLogin(e.target.id.value, e.target.pw.value)}} className="space-y-4">
                            <input name="id" placeholder="ID (demo)" className="w-full p-3 border rounded-lg" />
                            <input name="pw" type="password" placeholder="PW (ctrlm2025!)" className="w-full p-3 border rounded-lg" />
                            <button className="w-full bg-navy-900 text-white py-3 rounded-lg font-bold">ë¡œê·¸ì¸</button>
                        </form>
                    </div>
                </div>
            );

            const MENU_ITEMS = [
                { id: 'dashboard', name: 'HQ ëŒ€ì‹œë³´ë“œ', icon: 'bar-chart-2' },
                { id: 'sv', name: 'S.V. ìš´ì˜ ê´€ë¦¬', icon: 'clipboard-check' },
                { id: 'store', name: 'ì§€ì ë³„ ìƒì„¸', icon: 'store' },
                { id: 'menu', name: 'ë©”ë‰´/ì›ê°€', icon: 'utensils' },
                { id: 'marketing', name: 'ë§ˆì¼€íŒ… í˜„í™©', icon: 'megaphone' },
                { id: 'cctv', name: 'ìƒê¶Œ ë¶„ì„ (CCTV)', icon: 'camera' },
                { id: 'knowledge', name: 'ì§€ì‹/ì†Œí†µ', icon: 'book-open' },
                { id: 'alert', name: 'ì§€ì ë³„ ì•Œë¦¼', icon: 'bell' },
                { id: 'settings', name: 'ì„¤ì •', icon: 'settings' }
            ];

            return (
                <div className="flex min-h-screen">
                    <aside className="w-64 bg-navy-900 text-white fixed h-full z-10 flex flex-col">
                        <div className="p-6 border-b border-navy-800 text-xl font-bold flex items-center gap-2">
                            <i data-lucide="layout-dashboard" className="text-brand-500"></i> RestoGenie
                        </div>
                        <nav className="flex-1 p-4 space-y-1 overflow-y-auto">
                            {MENU_ITEMS.map(m => (
                                <button key={m.id} onClick={()=>setMenu(m.id)} className={`w-full flex items-center gap-3 px-3 py-3 rounded-lg text-sm transition ${menu===m.id ? 'bg-brand-600 font-bold' : 'hover:bg-navy-800 text-slate-300'}`}>
                                    <i data-lucide={m.icon} className="w-4 h-4"></i> {m.name}
                                </button>
                            ))}
                            <div className="my-4 border-t border-navy-800"></div>
                            <button onClick={()=>setMenu('report')} className={`w-full flex items-center gap-3 px-3 py-3 rounded-lg text-sm ${menu==='report'?'bg-gradient-to-r from-brand-600 to-indigo-600 font-bold':'hover:bg-navy-800 text-slate-300'}`}>
                                <i data-lucide="sparkles" className="w-4 h-4"></i> AI ë¦¬í¬íŠ¸ ì„¼í„°
                            </button>
                        </nav>
                    </aside>
                    <main className="ml-64 flex-1 p-8 relative bg-slate-50 min-h-screen">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-2xl font-bold text-navy-900">{menu==='report' ? 'AI ë¦¬í¬íŠ¸ ì„¼í„°' : MENU_ITEMS.find(m=>m.id===menu)?.name}</h1>
                            <div className="flex gap-4 items-center">
                                <select className="border p-2 rounded-lg bg-white font-bold shadow-sm" value={storeId} onChange={e=>setStoreId(e.target.value)}>
                                    {STORES.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                                <div className="bg-white border px-4 py-2 rounded-full shadow-sm flex items-center gap-2 cursor-pointer hover:bg-slate-50" onClick={()=>alert('ê´‘ê³  ì‹œì²­ í›„ 10P ì¶©ì „ ì™„ë£Œ!')}>
                                    <div className="w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center text-xs text-white font-bold">P</div>
                                    <span className="font-bold">{credits}</span>
                                    <span className="text-xs text-slate-400">ì¶©ì „</span>
                                </div>
                            </div>
                        </div>
                        <ErrorBoundary>
                            {menu === 'dashboard' && <DashboardView storeId={storeId} />}
                            {menu === 'report' && <AIReportView credits={credits} setCredits={setCredits} />}
                            {menu !== 'dashboard' && menu !== 'report' && <GenericView title={MENU_ITEMS.find(m=>m.id===menu)?.name} content="ìƒì„¸ ë°ì´í„°" />}
                            <AIChatbot />
                        </ErrorBoundary>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
