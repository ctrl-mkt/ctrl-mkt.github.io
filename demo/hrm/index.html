<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Î†àÏä§ÌÜ†ÏßÄÎãà ÌååÌä∏ÎÑàÏÑºÌÑ∞ (v2.2)</title>

    <!-- Ïä§ÌÉÄÏùº & Ìè∞Ìä∏ (Pretendard) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] },
                    colors: {
                        // Toss Color System Approximation
                        toss: {
                            blue: '#3182F6',       // Primary Blue
                            blueLight: '#E8F3FF',  // Light Blue Background
                            grey50: '#F9FAFB',
                            grey100: '#F2F4F6',    // Main Background
                            grey200: '#E5E8EB',    // Borders
                            grey300: '#D1D6DB',
                            grey400: '#B0B8C1',
                            grey500: '#8B95A1',    // Caption
                            grey600: '#6B7684',    // Subtext
                            grey700: '#4E5968',    // Body text
                            grey800: '#333D4B',    // Subheadings
                            grey900: '#191F28',    // Headings
                            red: '#F04452',
                            green: '#26D07C'
                        }
                    },
                    boxShadow: {
                        'toss': '0 4px 20px rgba(0, 0, 0, 0.04)',
                        'toss-hover': '0 8px 30px rgba(0, 0, 0, 0.08)'
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #F2F4F6; color: #191F28; }
        [x-cloak] { display: none !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #D1D6DB; border-radius: 3px; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ÌÜ†Ïä§ Ïä§ÌÉÄÏùº ÌÖåÏù¥Î∏î: ÏÑ∏Î°úÏÑ† Ï†úÍ±∞, Ìó§Îçî Î∞∞Í≤Ω Î∂ÄÎìúÎüΩÍ≤å */
        .toss-table th { background-color: #F9FAFB; color: #4E5968; font-weight: 600; padding: 12px 16px; text-align: left; border-bottom: 1px solid #E5E8EB; }
        .toss-table td { padding: 16px; border-bottom: 1px solid #F2F4F6; color: #333D4B; }
        .toss-table tr:last-child td { border-bottom: none; }
        
        /* ÏÇ¨Ïù¥ÎìúÎ∞î Î©îÎâ¥ ÌôúÏÑ±Ìôî Ïä§ÌÉÄÏùº */
        .nav-item.active { background-color: #E8F3FF; color: #3182F6; font-weight: 600; }
        .nav-item:hover:not(.active) { background-color: #F2F4F6; }
    </style>

    <!-- ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
</head>

<body class="antialiased"
      x-data="hrApp()"
      x-init="initApp()">

    <div class="flex min-h-screen">
        
        <!-- [LNB] Ï¢åÏ∏° ÏÇ¨Ïù¥ÎìúÎ∞î (ÌÜ†Ïä§ ÌååÌä∏ÎÑàÏÑºÌÑ∞ Ïä§ÌÉÄÏùº) -->
        <aside class="w-64 bg-white border-r border-toss-grey200 fixed h-full z-20 hidden md:flex flex-col">
            <div class="p-6">
                <div class="flex items-center gap-2 mb-8">
                    <div class="w-8 h-8 rounded-lg bg-toss-blue flex items-center justify-center text-white font-bold text-lg">R</div>
                    <span class="font-bold text-xl text-toss-grey900">RestoGenie</span>
                </div>
                
                <nav class="space-y-1">
                    <template x-for="item in menuItems">
                        <a href="#" @click.prevent="activeTab = item.id" 
                           class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl transition-colors duration-200 text-toss-grey700"
                           :class="{ 'active': activeTab === item.id }">
                            <i :data-lucide="item.icon" class="w-5 h-5"></i>
                            <span x-text="item.label"></span>
                        </a>
                    </template>
                </nav>
            </div>
            
            <div class="mt-auto p-6 border-t border-toss-grey100">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-toss-grey100 flex items-center justify-center text-toss-grey600">
                        <i data-lucide="user" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <div class="text-sm font-bold text-toss-grey900">ÍπÄÏÇ¨Ïû•Îãò</div>
                        <div class="text-xs text-toss-grey500">Í∞ïÎÇ®Ï†ê Í¥ÄÎ¶¨Ïûê</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Î™®Î∞îÏùº Ìó§Îçî -->
        <header class="md:hidden fixed w-full bg-white border-b border-toss-grey200 z-30 px-4 h-14 flex items-center justify-between">
            <span class="font-bold text-lg">RestoGenie</span>
            <button @click="mobileMenuOpen = !mobileMenuOpen"><i data-lucide="menu"></i></button>
        </header>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ -->
        <main class="flex-1 md:ml-64 p-4 md:p-8 pt-20 md:pt-8 overflow-y-auto bg-toss-grey100 min-h-screen">
            <div class="max-w-5xl mx-auto" x-cloak>
                
                <!-- ÏÉÅÎã® ÌÉÄÏù¥ÌãÄ Î∞è Ïï°ÏÖò ÏòÅÏó≠ -->
                <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                    <div>
                        <h1 class="text-2xl font-bold text-toss-grey900 mb-1" x-text="getPageTitle()"></h1>
                        <p class="text-toss-grey600 text-sm" x-text="getPageDesc()"></p>
                    </div>
                    
                    <!-- ÏßÅÏõê Îì±Î°ù Î≤ÑÌäº (ÏßÅÏõê Í¥ÄÎ¶¨ ÌÉ≠ÏóêÏÑúÎßå ÌëúÏãú) -->
                    <button x-show="activeTab === 'employees'" @click="openEmpModal()" 
                            class="flex items-center justify-center gap-2 bg-toss-blue hover:bg-blue-600 text-white px-5 py-3 rounded-xl font-semibold transition shadow-toss hover:shadow-toss-hover">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        <span>ÏÉà ÏßÅÏõê Îì±Î°ùÌïòÍ∏∞</span>
                    </button>
                </header>

                <!-- 1. ÏßÅÏõê Í¥ÄÎ¶¨ ÌÉ≠ -->
                <div x-show="activeTab === 'employees'" class="animate-fade-in space-y-6">
                    <!-- ÏöîÏïΩ Ïπ¥Îìú -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-toss-grey200">
                            <div class="text-toss-grey600 text-sm mb-1">Ï¥ù ÏßÅÏõê Ïàò</div>
                            <div class="text-2xl font-bold text-toss-grey900" x-text="employees.length + 'Î™Ö'"></div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-toss-grey200">
                            <div class="text-toss-grey600 text-sm mb-1">Í≥ÑÏïΩ ÏôÑÎ£å</div>
                            <div class="text-2xl font-bold text-toss-blue">2Î™Ö</div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-toss-grey200">
                            <div class="text-toss-grey600 text-sm mb-1">Ïù¥Î≤à Îã¨ ÏûÖÏÇ¨</div>
                            <div class="text-2xl font-bold text-toss-grey900">1Î™Ö</div>
                        </div>
                    </div>

                    <!-- ÏßÅÏõê Î™©Î°ù ÌÖåÏù¥Î∏î -->
                    <div class="bg-white rounded-3xl shadow-toss overflow-hidden border border-toss-grey200">
                        <div class="p-5 border-b border-toss-grey100 flex justify-between items-center">
                            <h3 class="font-bold text-lg">ÏßÅÏõê Î™©Î°ù</h3>
                            <div class="flex gap-2">
                                <button class="px-3 py-1.5 text-sm text-toss-grey600 bg-toss-grey100 rounded-lg">Ï†ÑÏ≤¥</button>
                                <button class="px-3 py-1.5 text-sm text-toss-grey500 hover:bg-toss-grey50 rounded-lg">Ïû¨ÏßÅÏ§ë</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full toss-table">
                                <thead>
                                    <tr>
                                        <th>Ïù¥Î¶Ñ / ÏßÅÏ±Ö</th>
                                        <th>Í≥ÑÏïΩ ÌòïÌÉú</th>
                                        <th>Í∏âÏó¨ Ï°∞Í±¥</th>
                                        <th>Í∑ºÎ¨¥ ÏùºÏ†ï</th>
                                        <th>ÏûÖÏÇ¨Ïùº</th>
                                        <th class="text-right">Í¥ÄÎ¶¨</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="emp in employees" :key="emp.id">
                                        <tr class="hover:bg-toss-grey50 transition-colors">
                                            <td>
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-toss-blueLight text-toss-blue flex items-center justify-center font-bold text-sm" x-text="emp.name.substring(0,1)"></div>
                                                    <div>
                                                        <div class="font-bold text-toss-grey900" x-text="emp.name"></div>
                                                        <div class="text-xs text-toss-grey500 mt-0.5" x-text="formatRole(emp.role)"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium"
                                                      :class="emp.contractType === 'insurance4' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'">
                                                    <span x-text="emp.contractType === 'insurance4' ? '4ÎåÄÎ≥¥Ìóò' : 'ÌîÑÎ¶¨ÎûúÏÑú'"></span>
                                                </span>
                                            </td>
                                            <td>
                                                <div class="font-medium text-toss-grey800" x-text="formatCurrency(emp.basePay)"></div>
                                                <div class="text-xs text-toss-grey500" x-text="emp.role === 'parttime' ? 'ÏãúÍ∏â' : 'ÏõîÍ∏â'"></div>
                                            </td>
                                            <td>
                                                <div class="flex flex-wrap gap-1 max-w-[200px]">
                                                    <template x-if="emp.schedule && Object.keys(emp.schedule).length > 0">
                                                        <template x-for="(sch, day) in emp.schedule">
                                                            <span x-show="sch.active" class="text-xs bg-toss-grey100 text-toss-grey600 px-1.5 py-0.5 rounded-md" x-text="day"></span>
                                                        </template>
                                                    </template>
                                                    <template x-if="!emp.schedule || Object.keys(emp.schedule).length === 0">
                                                        <span class="text-xs text-toss-grey400">ÏùºÏ†ï ÏóÜÏùå</span>
                                                    </template>
                                                </div>
                                            </td>
                                            <td class="text-toss-grey600 text-sm" x-text="emp.joinDate"></td>
                                            <td class="text-right">
                                                <!-- ÏÉÅÏÑ∏Î≥¥Í∏∞ Î≤ÑÌäº: ÌÅ¥Î¶≠ Ïãú Ìï¥Îãπ ÏßÅÏõê Ï†ïÎ≥¥Î•º Ïù∏ÏûêÎ°ú ÎÑòÍ≤® ÏàòÏ†ï Î™®Îã¨ÏùÑ ÎùÑÏõÄ -->
                                                <button @click="openEmpModal(emp)"
                                                        class="text-sm px-3 py-2 rounded-lg bg-toss-grey100 text-toss-grey700 hover:bg-toss-grey200 font-medium transition">
                                                    ÏÉÅÏÑ∏Î≥¥Í∏∞
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 2. Í∑ºÎ¨¥ ÏùºÏ†ï ÌÉ≠ (Ï∫òÎ¶∞Îçî) -->
                <div x-show="activeTab === 'calendar'" class="animate-fade-in space-y-6">
                    <div class="bg-white rounded-3xl shadow-toss p-6 border border-toss-grey200">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="font-bold text-lg text-toss-grey900">ÏõîÍ∞Ñ Í∑ºÎ¨¥ ÌòÑÌô©</h3>
                            <div class="flex items-center bg-toss-grey100 rounded-full px-1 py-1">
                                <button @click="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:shadow-sm transition"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                                <span class="mx-4 font-bold text-toss-grey800 tabular-nums" x-text="getCurrentYearMonth()"></span>
                                <button @click="changeMonth(1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:shadow-sm transition"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                            </div>
                        </div>

                        <!-- Ï∫òÎ¶∞Îçî Í∑∏Î¶¨Îìú (Toss style: Clean borders) -->
                        <div class="border border-toss-grey200 rounded-2xl overflow-hidden">
                            <div class="grid grid-cols-7 border-b border-toss-grey200 bg-toss-grey50">
                                <template x-for="(day, idx) in ['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†']">
                                    <div class="py-3 text-center text-sm font-semibold" 
                                         :class="idx === 0 ? 'text-toss-red' : (idx === 6 ? 'text-toss-blue' : 'text-toss-grey600')" 
                                         x-text="day"></div>
                                </template>
                            </div>
                            <div class="grid grid-cols-7 bg-white">
                                <template x-for="d in getCalendarDays()" :key="d.key">
                                    <div @click="d.day ? openShiftModal(d.day) : null" 
                                         class="min-h-[100px] p-1 border-b border-r border-toss-grey100 relative group transition-colors hover:bg-toss-grey50"
                                         :class="{'cursor-pointer': d.day, 'bg-toss-grey50': !d.day}">
                                        
                                        <div class="text-sm font-medium p-1" 
                                             :class="{'text-toss-grey300': !d.day, 'text-toss-grey900': d.day}" 
                                             x-text="d.day || ''"></div>
                                        
                                        <!-- Í∑ºÎ¨¥ Ïπ© -->
                                        <div class="flex flex-col gap-1 mt-1">
                                            <template x-for="shift in getShifts(d.fullDate)">
                                                <div @click.stop="openEditShiftModal(shift)"
                                                     class="text-[11px] bg-toss-blueLight text-toss-blue px-2 py-1 rounded-md font-medium cursor-pointer hover:opacity-80 truncate border border-transparent hover:border-toss-blue transition">
                                                    <span x-text="getEmpName(shift.empId)"></span>
                                                    <span class="opacity-70 ml-1" x-text="shift.startTime.substring(0,2) + 'Ïãú'"></span>
                                                </div>
                                            </template>
                                        </div>

                                        <!-- Hover Plus Icon -->
                                        <div x-show="d.day" class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <div class="w-6 h-6 bg-toss-grey200 rounded-full flex items-center justify-center text-toss-grey600">
                                                <i data-lucide="plus" class="w-3 h-3"></i>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Í∏âÏó¨ ÎÇ¥Ïó≠ ÌÉ≠ -->
                <div x-show="activeTab === 'payroll'" class="animate-fade-in space-y-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="font-bold text-xl text-toss-grey900" x-text="`${currentDate.getMonth() + 1}Ïõî Í∏âÏó¨`"></span>
                            <span class="px-3 py-1 bg-toss-grey100 text-toss-grey600 rounded-full text-xs font-medium">
                                ÏµúÏ†ÄÏãúÍ∏â 10,030Ïõê Í∏∞Ï§Ä
                            </span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <template x-for="emp in employees" :key="emp.id">
                            <div class="bg-white rounded-3xl p-6 shadow-toss border border-toss-grey200 hover:shadow-toss-hover transition-shadow" 
                                 x-data="{ pay: calculatePayroll(emp), showDetail: false }">
                                
                                <div class="flex justify-between items-start mb-6">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 rounded-full bg-toss-grey100 flex items-center justify-center text-xl">üë§</div>
                                        <div>
                                            <div class="font-bold text-lg text-toss-grey900" x-text="emp.name"></div>
                                            <div class="text-sm text-toss-grey500" x-text="formatRole(emp.role) + ' ¬∑ ' + (emp.contractType === 'insurance4' ? '4ÎåÄÎ≥¥Ìóò' : '3.3%')"></div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs text-toss-grey500 mb-1">Ïã§Ï†ú Î∞õÎäî Í∏àÏï°</div>
                                        <div class="text-2xl font-bold text-toss-blue" x-text="formatCurrency(pay.netPay)"></div>
                                    </div>
                                </div>

                                <!-- Í∞ÑÌé∏ Î™ÖÏÑ∏ÏÑú -->
                                <div class="bg-toss-grey50 rounded-2xl p-4 space-y-3">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-toss-grey600">ÏßÄÍ∏â Ìï©Í≥Ñ (ÏÑ∏Ï†Ñ)</span>
                                        <span class="font-semibold text-toss-grey900" x-text="formatCurrency(pay.grossTotal)"></span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-toss-grey600">Í≥µÏ†ú Ìï©Í≥Ñ (ÏÑ∏Í∏à Îì±)</span>
                                        <span class="font-semibold text-toss-red" x-text="'- ' + formatCurrency(pay.deductions.total)"></span>
                                    </div>
                                    <div class="h-px bg-toss-grey200 my-2"></div>
                                    
                                    <!-- ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ ÌÜ†Í∏Ä -->
                                    <button @click="showDetail = !showDetail" class="w-full flex items-center justify-center gap-1 text-sm text-toss-grey600 hover:text-toss-grey900 py-1">
                                        <span x-text="showDetail ? 'Ï†ëÍ∏∞' : 'ÏûêÏÑ∏Ìûà Î≥¥Í∏∞'"></span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 transition-transform" :class="showDetail ? 'rotate-180' : ''"></i>
                                    </button>
                                </div>

                                <!-- ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ ÌéºÏπ® -->
                                <div x-show="showDetail" class="mt-4 space-y-4" x-transition>
                                    <div>
                                        <h5 class="text-xs font-bold text-toss-grey500 mb-2 uppercase tracking-wider">ÏßÄÍ∏â ÏÉÅÏÑ∏</h5>
                                        <div class="space-y-1 text-sm text-toss-grey700">
                                            <div class="flex justify-between"><span>Í∏∞Î≥∏Í∏â</span><span x-text="formatCurrency(pay.basePay)"></span></div>
                                            <div class="flex justify-between" x-show="pay.juhyuAllowance > 0">
                                                <span class="flex items-center gap-1">Ï£ºÌú¥ÏàòÎãπ <i data-lucide="info" class="w-3 h-3 text-toss-grey400"></i></span>
                                                <span x-text="'+ ' + formatCurrency(pay.juhyuAllowance)"></span>
                                            </div>
                                            <div class="flex justify-between" x-show="pay.nightAllowance > 0"><span>Ïã¨ÏïºÏàòÎãπ</span><span x-text="'+ ' + formatCurrency(pay.nightAllowance)"></span></div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h5 class="text-xs font-bold text-toss-grey500 mb-2 uppercase tracking-wider">Í≥µÏ†ú ÏÉÅÏÑ∏</h5>
                                        <div class="space-y-1 text-sm text-toss-grey700">
                                            <template x-if="emp.contractType === 'insurance4'">
                                                <div class="space-y-1">
                                                    <div class="flex justify-between"><span>Íµ≠ÎØºÏó∞Í∏à</span><span x-text="formatCurrency(pay.deductions.pension)"></span></div>
                                                    <div class="flex justify-between"><span>Í±¥Í∞ïÎ≥¥Ìóò</span><span x-text="formatCurrency(pay.deductions.health)"></span></div>
                                                    <div class="flex justify-between"><span>Í≥†Ïö©Î≥¥Ìóò</span><span x-text="formatCurrency(pay.deductions.employ)"></span></div>
                                                    <div class="flex justify-between"><span>ÏÜåÎìùÏÑ∏(ÏßÄÎ∞©ÏÑ∏)</span><span x-text="formatCurrency(pay.deductions.tax)"></span></div>
                                                </div>
                                            </template>
                                            <template x-if="emp.contractType === 'freelancer'">
                                                <div class="flex justify-between"><span>ÏÇ¨ÏóÖÏÜåÎìùÏÑ∏(3.3%)</span><span x-text="formatCurrency(pay.deductions.tax)"></span></div>
                                            </template>
                                        </div>
                                    </div>

                                    <div class="pt-2">
                                        <h5 class="text-xs font-bold text-toss-grey500 mb-2 uppercase tracking-wider">Í∑ºÎ¨¥ Í∏∞Î°ù ÏöîÏïΩ</h5>
                                        <div class="bg-white border border-toss-grey200 rounded-lg p-3 text-xs text-toss-grey600">
                                            <div>Ï¥ù Í∑ºÎ¨¥ ÏãúÍ∞Ñ: <span class="font-bold text-toss-blue" x-text="pay.details.totalHours + 'ÏãúÍ∞Ñ'"></span></div>
                                            <div>Í∑ºÎ¨¥ ÏùºÏàò: <span x-text="pay.details.workDays + 'Ïùº'"></span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- [Modal] ÏßÅÏõê Îì±Î°ù/ÏàòÏ†ï (Toss Style) -->
    <div x-show="showEmpModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4" x-cloak x-transition.opacity>
        <div class="bg-white w-full max-w-lg rounded-[32px] shadow-2xl overflow-hidden max-h-[90vh] flex flex-col" @click.away="showEmpModal = false">
            <div class="p-6 md:p-8 overflow-y-auto custom-scrollbar">
                <div class="flex justify-between items-center mb-6">
                    <!-- Î™®Îã¨ Ï†úÎ™© ÎèôÏ†Å Î≥ÄÍ≤Ω -->
                    <h2 class="text-2xl font-bold text-toss-grey900" x-text="isEmpEditMode ? 'ÏßÅÏõê Ï†ïÎ≥¥ ÏàòÏ†ïÌïòÍ∏∞' : 'ÏÉà ÏßÅÏõê Îì±Î°ùÌïòÍ∏∞'"></h2>
                    <button @click="showEmpModal = false" class="text-toss-grey500 hover:text-toss-grey900 bg-toss-grey100 p-2 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>

                <form @submit.prevent="saveEmployee" class="space-y-6">
                    <!-- ÏûÖÎ†• ÌïÑÎìú Ïä§ÌÉÄÏùº: bg-toss-grey50, border-transparent, focus:ring-toss-blue -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-toss-grey700 mb-2">Ïù¥Î¶Ñ</label>
                            <input x-model="newEmp.name" class="w-full p-4 bg-toss-grey50 rounded-xl border-none focus:ring-2 focus:ring-toss-blue transition" placeholder="Ïòà: ÍπÄÌÜ†Ïä§" required>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-toss-grey700 mb-2">ÏßÅÏ±Ö</label>
                                <select x-model="newEmp.role" class="w-full p-4 bg-toss-grey50 rounded-xl border-none focus:ring-2 focus:ring-toss-blue transition appearance-none">
                                    <option value="parttime">ÏïÑÎ•¥Î∞îÏù¥Ìä∏</option>
                                    <option value="staff">Ï†ïÍ∑úÏßÅ</option>
                                    <option value="manager">Îß§ÎãàÏ†Ä</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-toss-grey700 mb-2">ÏûÖÏÇ¨Ïùº</label>
                                <input x-model="newEmp.joinDate" type="date" class="w-full p-4 bg-toss-grey50 rounded-xl border-none focus:ring-2 focus:ring-toss-blue transition" required>
                            </div>
                        </div>
                        
                        <div>
                             <label class="block text-sm font-semibold text-toss-grey700 mb-2">Í≥ÑÏïΩ Î∞è Í∏âÏó¨</label>
                             <div class="p-4 border border-toss-grey200 rounded-xl space-y-4">
                                <div class="flex gap-4">
                                    <label class="flex-1 cursor-pointer">
                                        <input type="radio" value="insurance4" x-model="newEmp.contractType" class="peer sr-only">
                                        <div class="text-center py-3 rounded-xl bg-toss-grey50 text-toss-grey600 peer-checked:bg-toss-blueLight peer-checked:text-toss-blue peer-checked:font-bold transition">4ÎåÄÎ≥¥Ìóò</div>
                                    </label>
                                    <label class="flex-1 cursor-pointer">
                                        <input type="radio" value="freelancer" x-model="newEmp.contractType" class="peer sr-only">
                                        <div class="text-center py-3 rounded-xl bg-toss-grey50 text-toss-grey600 peer-checked:bg-toss-blueLight peer-checked:text-toss-blue peer-checked:font-bold transition">ÌîÑÎ¶¨ÎûúÏÑú</div>
                                    </label>
                                </div>
                                <div class="relative">
                                    <input x-model.number="newEmp.basePay" type="number" class="w-full p-4 bg-toss-grey50 rounded-xl border-none focus:ring-2 focus:ring-toss-blue text-right font-bold pr-12" required>
                                    <span class="absolute right-4 top-4 text-toss-grey500">Ïõê</span>
                                </div>
                             </div>
                        </div>

                        <!-- Í∑ºÎ¨¥ ÏùºÏ†ï Ï≤¥ÌÅ¨Î∞ïÏä§ UI -->
                        <div>
                            <label class="block text-sm font-semibold text-toss-grey700 mb-2">Í∑ºÎ¨¥ ÏùºÏ†ï</label>
                            <div class="space-y-2">
                                <template x-for="day in ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº']">
                                    <div class="flex items-center gap-3 p-3 rounded-xl border transition-colors" 
                                         :class="newEmp.schedule[day].active ? 'border-toss-blue bg-toss-blueLight/30' : 'border-toss-grey200 bg-white'">
                                        <label class="flex items-center min-w-[40px] cursor-pointer">
                                            <input type="checkbox" x-model="newEmp.schedule[day].active" class="w-5 h-5 rounded text-toss-blue focus:ring-toss-blue border-toss-grey300">
                                            <span class="ml-2 font-bold text-toss-grey700" x-text="day"></span>
                                        </label>
                                        
                                        <div class="flex-1 flex gap-2" x-show="newEmp.schedule[day].active">
                                            <input type="time" x-model="newEmp.schedule[day].start" class="p-1.5 text-sm bg-white border border-toss-grey200 rounded-lg">
                                            <span class="text-toss-grey400 self-center">~</span>
                                            <input type="time" x-model="newEmp.schedule[day].end" class="p-1.5 text-sm bg-white border border-toss-grey200 rounded-lg">
                                        </div>
                                        <div class="flex-1 text-sm text-toss-grey400 text-center" x-show="!newEmp.schedule[day].active">Ìú¥Î¨¥</div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <button type="submit" 
                            class="w-full bg-toss-blue hover:bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-toss hover:shadow-toss-hover transition transform active:scale-[0.98]"
                            x-text="isEmpEditMode ? 'ÏàòÏ†ï ÏôÑÎ£åÌïòÍ∏∞' : 'Îì±Î°ù ÏôÑÎ£åÌïòÍ∏∞'">
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- [Modal] Í∑ºÎ¨¥ ÏàòÏ†ï -->
    <div x-show="showShiftModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4" x-cloak x-transition.opacity>
        <div class="bg-white w-full max-w-sm rounded-[32px] p-6 shadow-2xl" @click.away="closeShiftModal()">
            <h3 class="text-lg font-bold text-toss-grey900 mb-1" x-text="isEditMode ? 'Í∑ºÎ¨¥ ÎÇ¥Ïö© ÏàòÏ†ïÌïòÍ∏∞' : 'Í∑ºÎ¨¥ Ï∂îÍ∞ÄÌïòÍ∏∞'"></h3>
            <p class="text-sm text-toss-blue font-medium mb-6" x-text="targetDateStr"></p>
            
            <form @submit.prevent="saveShift" class="space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-toss-grey500 mb-1">ÏßÅÏõê</label>
                    <select x-model="newShift.empId" class="w-full p-3 bg-toss-grey50 rounded-xl border-none font-bold text-toss-grey900" :disabled="isEditMode">
                        <template x-for="emp in employees" :key="emp.id">
                            <option :value="emp.id" x-text="emp.name"></option>
                        </template>
                    </select>
                </div>
                <div class="flex gap-2">
                    <div class="flex-1">
                        <label class="block text-xs font-semibold text-toss-grey500 mb-1">Ï∂úÍ∑º</label>
                        <input x-model="newShift.startTime" type="time" class="w-full p-3 bg-toss-grey50 rounded-xl border-none text-center font-bold" required>
                    </div>
                    <div class="flex-1">
                        <label class="block text-xs font-semibold text-toss-grey500 mb-1">Ìá¥Í∑º</label>
                        <input x-model="newShift.endTime" type="time" class="w-full p-3 bg-toss-grey50 rounded-xl border-none text-center font-bold" required>
                    </div>
                </div>

                <div class="flex gap-2 pt-4">
                    <button type="button" @click="closeShiftModal()" class="flex-1 py-3 bg-toss-grey100 text-toss-grey700 rounded-xl font-bold">Îã´Í∏∞</button>
                    <template x-if="isEditMode">
                        <button type="button" @click="deleteShift()" class="flex-1 py-3 bg-red-50 text-toss-red rounded-xl font-bold">ÏÇ≠Ï†ú</button>
                    </template>
                    <button type="submit" class="flex-1 py-3 bg-toss-blue text-white rounded-xl font-bold">Ï†ÄÏû•</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function hrApp() {
            return {
                activeTab: 'employees',
                menuItems: [
                    { id: 'employees', label: 'ÏßÅÏõê Í¥ÄÎ¶¨', icon: 'users' },
                    { id: 'calendar', label: 'Í∑ºÎ¨¥ ÏùºÏ†ï', icon: 'calendar' },
                    { id: 'payroll', label: 'Í∏âÏó¨ ÎÇ¥Ïó≠', icon: 'calculator' }
                ],
                currentDate: new Date(), 
                
                employees: [
                    { 
                        id: 1, name: 'ÍπÄÎß§ÎãàÏ†Ä', role: 'manager', contractType: 'insurance4', basePay: 2200000, joinDate: '2024-01-01', 
                        schedule: {} 
                    },
                    { 
                        id: 4, name: 'ÍπÄÎèÑÏú§', role: 'parttime', contractType: 'freelancer', basePay: 10500, joinDate: '2025-12-01', 
                        schedule: { 
                            'Ïõî': { active: true, start: '09:00', end: '18:00', breakTime: 60 },
                            'Ïàò': { active: true, start: '09:00', end: '18:00', breakTime: 60 }
                        }
                    }
                ],
                shifts: [
                    { id: 101, date: '2025-12-01', empId: 4, startTime: '09:00', endTime: '18:00' },
                    { id: 102, date: '2025-12-02', empId: 4, startTime: '09:00', endTime: '14:00' },
                    { id: 103, date: '2025-12-03', empId: 4, startTime: '09:00', endTime: '14:00' },
                    { id: 104, date: '2025-12-04', empId: 4, startTime: '09:00', endTime: '18:00' },
                    { id: 105, date: '2025-12-05', empId: 4, startTime: '09:00', endTime: '18:00' },
                ],

                showEmpModal: false,
                isEmpEditMode: false,
                editingEmpId: null,

                showShiftModal: false,
                isEditMode: false,
                editingShiftId: null,
                targetDateStr: '',
                
                newEmp: { 
                    name: '', role: 'parttime', contractType: 'insurance4', basePay: 10030, joinDate: '',
                    schedule: {
                        'Ïõî': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Ìôî': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Ïàò': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Î™©': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Í∏à': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'ÌÜ†': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                        'Ïùº': { active: false, start: '09:00', end: '18:00', breakTime: 0 },
                    }
                },
                newShift: { empId: 1, startTime: '09:00', endTime: '14:00' },

                initApp() {
                    this.currentDate = new Date(2025, 11, 1); 
                    this.refreshIcons();
                    this.$watch('activeTab', () => { 
                        window.scrollTo(0,0);
                        this.refreshIcons(); 
                    });
                },
                refreshIcons() { setTimeout(() => { if(window.lucide) window.lucide.createIcons(); }, 50); },
                
                // Titles for pages
                getPageTitle() {
                    if (this.activeTab === 'employees') return 'ÏßÅÏõê Í¥ÄÎ¶¨';
                    if (this.activeTab === 'calendar') return 'Í∑ºÎ¨¥ ÏùºÏ†ï';
                    if (this.activeTab === 'payroll') return 'Í∏âÏó¨ ÎÇ¥Ïó≠';
                },
                getPageDesc() {
                    if (this.activeTab === 'employees') return 'Ïö∞Î¶¨ Îß§Ïû• ÏßÅÏõêÎì§Ïùò Í≥ÑÏïΩ Ï†ïÎ≥¥ÏôÄ Í∑ºÎ¨¥ Ï°∞Í±¥ÏùÑ Í¥ÄÎ¶¨Ìï¥Î≥¥ÏÑ∏Ïöî.';
                    if (this.activeTab === 'calendar') return 'ÏßÅÏõêÎì§Ïùò Í∑ºÎ¨¥ Ïä§ÏºÄÏ§ÑÏùÑ ÌïúÎààÏóê ÌôïÏù∏ÌïòÍ≥† ÏàòÏ†ïÌï† Ïàò ÏûàÏñ¥Ïöî.';
                    if (this.activeTab === 'payroll') return 'Ïù¥Î≤à Îã¨ ÏòàÏÉÅ Í∏âÏó¨ÏôÄ Í≥µÏ†ú ÎÇ¥Ïó≠ÏùÑ ÎØ∏Î¶¨ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî.';
                },

                formatCurrency(v) { return Math.floor(v).toLocaleString() + 'Ïõê'; },
                formatRole(r) { return {'manager':'Îß§ÎãàÏ†Ä','parttime':'ÏïÑÎ•¥Î∞îÏù¥Ìä∏','staff':'Ï†ïÍ∑úÏßÅ'}[r]; },
                getEmpName(id) { const e = this.employees.find(x => x.id == id); return e ? e.name : '-'; },

                // Calendar Logic
                getCurrentYearMonth() { return `${this.currentDate.getFullYear()}. ${this.currentDate.getMonth() + 1}`; },
                getCalendarDays() {
                    const y = this.currentDate.getFullYear(), m = this.currentDate.getMonth();
                    const lastDay = new Date(y, m + 1, 0).getDate();
                    const firstDayIdx = new Date(y, m, 1).getDay();
                    let days = [];
                    for(let i=0; i<firstDayIdx; i++) days.push({ key: `b-${i}`, day: null });
                    for(let i=1; i<=lastDay; i++) {
                        const dStr = String(i).padStart(2,'0'), mStr = String(m+1).padStart(2,'0');
                        days.push({ key: `d-${i}`, day: i, fullDate: `${y}-${mStr}-${dStr}` });
                    }
                    return days;
                },
                changeMonth(off) { this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + off, 1); },
                getShifts(date) { return this.shifts.filter(s => s.date === date); },

                // Modal Actions
                openEmpModal(emp = null) {
                    if (emp) {
                        // Edit Mode
                        this.isEmpEditMode = true;
                        this.editingEmpId = emp.id;
                        this.newEmp = JSON.parse(JSON.stringify(emp)); // Deep copy
                        // Ensure schedule exists
                        if (!this.newEmp.schedule) this.newEmp.schedule = {};
                        ['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'].forEach(d => {
                            if(!this.newEmp.schedule[d]) this.newEmp.schedule[d] = { active: false, start: '09:00', end: '18:00', breakTime: 0 };
                        });
                    } else {
                        // Add Mode
                        this.isEmpEditMode = false;
                        this.editingEmpId = null;
                        this.newEmp = { 
                            name: '', role: 'parttime', contractType: 'insurance4', basePay: 10030, joinDate: new Date().toISOString().split('T')[0],
                            schedule: {}
                        };
                        ['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'].forEach(d => {
                            this.newEmp.schedule[d] = { active: false, start: '09:00', end: '18:00', breakTime: 0 };
                        });
                    }
                    this.showEmpModal = true;
                },
                saveEmployee() {
                    if (this.isEmpEditMode) {
                        // Update existing
                        const idx = this.employees.findIndex(e => e.id === this.editingEmpId);
                        if (idx !== -1) {
                            // Keep ID, update other fields
                            const updatedEmp = JSON.parse(JSON.stringify(this.newEmp));
                            updatedEmp.id = this.editingEmpId; 
                            this.employees[idx] = updatedEmp;
                        }
                    } else {
                        // Add new
                        const empId = Date.now();
                        const scheduleCopy = JSON.parse(JSON.stringify(this.newEmp.schedule));
                        this.employees.push({ id: empId, ...this.newEmp, schedule: scheduleCopy });
                    }
                    this.showEmpModal = false;
                },

                openShiftModal(day) {
                    const y = this.currentDate.getFullYear();
                    const m = String(this.currentDate.getMonth() + 1).padStart(2,'0');
                    const d = String(day).padStart(2,'0');
                    this.targetDateStr = `${y}-${m}-${d}`;
                    
                    this.isEditMode = false;
                    this.editingShiftId = null;
                    this.newShift = { empId: this.employees[0]?.id, startTime: '09:00', endTime: '18:00' };
                    this.showShiftModal = true;
                },
                openEditShiftModal(shift) {
                    this.targetDateStr = shift.date;
                    this.isEditMode = true;
                    this.editingShiftId = shift.id;
                    this.newShift = { empId: shift.empId, startTime: shift.startTime, endTime: shift.endTime };
                    this.showShiftModal = true;
                },
                closeShiftModal() { this.showShiftModal = false; },
                
                saveShift() {
                    if (this.isEditMode) {
                        const idx = this.shifts.findIndex(s => s.id === this.editingShiftId);
                        if (idx !== -1) {
                            this.shifts[idx] = { ...this.shifts[idx], startTime: this.newShift.startTime, endTime: this.newShift.endTime };
                        }
                    } else {
                        this.shifts.push({ id: Date.now(), date: this.targetDateStr, empId: parseInt(this.newShift.empId), startTime: this.newShift.startTime, endTime: this.newShift.endTime });
                    }
                    this.showShiftModal = false;
                    this.refreshIcons();
                },
                deleteShift() {
                    if (!this.isEditMode || !this.editingShiftId) return;
                    this.shifts = this.shifts.filter(s => s.id !== this.editingShiftId);
                    this.showShiftModal = false;
                },

                calculatePayroll(emp) {
                    let base = 0, juhyu = 0, night = 0, pos = 0;
                    const ym = `${this.currentDate.getFullYear()}-${String(this.currentDate.getMonth() + 1).padStart(2, '0')}`;
                    const myShifts = this.shifts.filter(s => s.date.startsWith(ym) && s.empId === emp.id);

                    let totalHours = 0;
                    let weekLogs = {};

                    myShifts.forEach(s => {
                        let h = (new Date(`2000-01-01T${s.endTime}`) - new Date(`2000-01-01T${s.startTime}`)) / 3600000;
                        if(h < 0) h += 24;
                        
                        const dayName = ['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'][new Date(s.date).getDay()];
                        const contractDay = emp.schedule && emp.schedule[dayName];
                        
                        if (contractDay && contractDay.active) h -= (contractDay.breakTime / 60);
                        else if(h >= 8) h -= 1; else if(h >= 4) h -= 0.5;
                        
                        if (h < 0) h = 0;
                        totalHours += h;

                        const st = parseInt(s.startTime.split(':')[0]);
                        if(st >= 22 || st < 6) night += (h * 800);

                        const weekNum = Math.ceil(new Date(s.date).getDate() / 7);
                        weekLogs[weekNum] = { hours: (weekLogs[weekNum]?.hours || 0) + h };
                    });

                    if(emp.role === 'parttime') {
                        base = totalHours * emp.basePay;
                        Object.keys(weekLogs).forEach(w => {
                            if(weekLogs[w].hours >= 15) juhyu += (Math.min(weekLogs[w].hours, 40) / 40 * 8) * emp.basePay;
                        });
                    } else {
                        base = emp.basePay;
                        if(emp.role === 'manager') pos = 200000;
                    }

                    const gross = Math.floor(base + juhyu + night + pos);
                    let deductions = { pension:0, health:0, care:0, employ:0, tax:0, total:0 };
                    
                    if (emp.contractType === 'freelancer') {
                        deductions.tax = Math.floor(gross * 0.033 / 10) * 10;
                    } else {
                        deductions.pension = Math.floor(gross * 0.045 / 10) * 10;
                        deductions.health = Math.floor(gross * 0.03545 / 10) * 10;
                        deductions.care = Math.floor(deductions.health * 0.1295 / 10) * 10;
                        deductions.employ = Math.floor(gross * 0.009 / 10) * 10;
                        const incomeTax = Math.floor(gross * 0.01 / 10) * 10;
                        deductions.tax = Math.floor(incomeTax * 1.1 / 10) * 10;
                    }
                    
                    deductions.total = deductions.pension + deductions.health + deductions.care + deductions.employ + deductions.tax;

                    return { 
                        basePay: base, juhyuAllowance: juhyu, nightAllowance: night, 
                        grossTotal: gross, deductions: deductions, netPay: gross - deductions.total,
                        details: { totalHours: totalHours.toFixed(1), workDays: myShifts.length }
                    };
                }
            };
        }
    </script>
</body>
</html>
