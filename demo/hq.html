<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoGenie HQ - ê°€ë§¹ë³¸ì‚¬ í†µí•© ê´€ë¦¬</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.js"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Canvas Editor Style */
        .canvas-editor {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .typing-cursor::after {
            content: 'â–‹';
            animation: blink 1s step-start infinite;
            color: #3b82f6;
        }
        @keyframes blink { 50% { opacity: 0; } }
        
        /* Chatbot Style */
        .chat-bubble { position: relative; max-width: 80%; padding: 10px 14px; border-radius: 16px; font-size: 14px; line-height: 1.5; }
        .chat-user { background-color: #2563eb; color: white; border-bottom-right-radius: 4px; margin-left: auto; }
        .chat-bot { background-color: #f1f5f9; color: #1e293b; border-bottom-left-radius: 4px; margin-right: auto; border: 1px solid #e2e8f0; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: { 800: '#1e293b', 900: '#0f172a' },
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // --- 1. System Configuration ---
        const API_KEY = ""; // System prompt: Use empty string as key is injected by environment
        const NOTEBOOK_CONTEXT = `
            [ê¸°ë°˜ ë°ì´í„°: ìŠ¬ë¨ë²„ê±° 2025ë…„ 10ì›” ìš´ì˜ ë°ì´í„° ë° ì£¼ê°„ íšŒì˜ë¡]
            1. ì „ì‚¬ ì‹¤ì : 10ì›” ì´ ë§¤ì¶œ 2ì–µ 7,361ë§Œì› (ëª©í‘œ ëŒ€ë¹„ 108% ë‹¬ì„±), ì´ ì£¼ë¬¸ìˆ˜ 14,520ê±´.
            2. ë§¤ì¥ë³„ ì´ìŠˆ:
               - ê°•ë‚¨ì : ë§¤ì¶œ 9,885ë§Œì›(+8.1%). 'ê°ˆë¹„ë²„ê±°' ë°°ë‹¬ ì£¼ë¬¸ ê¸‰ì¦(ì „ì£¼ ëŒ€ë¹„ +22%).
               - ëŒ€í•™ë¡œì : ë§¤ì¶œ 8,750ë§Œì›(-2.1%). ì ì‹¬ í”¼í¬íƒ€ì„(12-13ì‹œ) ëŒ€ê¸° ì‹œê°„ ì¦ê°€ë¡œ ê³ ê° ì´íƒˆ ë°œìƒ. SV ë°©ë¬¸ ê²°ê³¼ ì£¼ë°© ë™ì„  ê¼¬ì„ ë° ì¸ë ¥ ë¶€ì¡± í™•ì¸.
            3. ì›ê°€ ì´ìŠˆ: ì–‘ìƒì¶” ê°€ê²© í­ë“±ìœ¼ë¡œ ì „ì‚¬ ì›ê°€ìœ¨ 38.5% (+1.5%p ìƒìŠ¹). ìŠ¤ë§ˆíŠ¸íŒœ ê³„ì•½ ì¬ë°°(íŒœì—ì´íŠ¸) ë„ì… ê²°ì •ë¨.
            4. ë§ˆì¼€íŒ…: 11ì›” 'ìˆ˜ëŠ¥ ëŒ€ë°• ê¸°ì›' í”„ë¡œëª¨ì…˜ ì˜ˆì • (ëŒ€í•™ë¡œì  ì§‘ì¤‘).
            5. ë³¸ì‚¬ ì „ëµ: ì´ìµë¥  ê°œì„ ì„ ìœ„í•œ ìë™ ë°œì£¼ ì‹œìŠ¤í…œ ë„ì… ë° KDS(ì£¼ë°© ë””ìŠ¤í”Œë ˆì´) ëŒ€í•™ë¡œì  ì‹œë²” ì ìš© ê²€í† .
        `;

        // --- 2. Components ---
        
        // Chatbot Component
        const AIChatbot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([{ role: 'model', text: 'ì•ˆë…•í•˜ì„¸ìš”! ìŠ¬ë¨ë²„ê±° ë³¸ì‚¬ AI ë¹„ì„œì…ë‹ˆë‹¤. 10ì›” ë§¤ì¶œ í˜„í™©ì´ë‚˜ ì´ìŠˆì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”.' }]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef(null);

            useEffect(() => {
                if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
            }, [messages]);

            const sendMessage = async () => {
                if (!input.trim()) return;
                const userMsg = input;
                setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                setInput('');
                setLoading(true);

                try {
                    // Actual API Call
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ role: "user", parts: [{ text: `Context: ${NOTEBOOK_CONTEXT}\n\nUser Question: ${userMsg}\n\nAnswer as a helpful HQ AI assistant.` }] }]
                        })
                    });
                    const data = await response.json();
                    const botMsg = data.candidates[0].content.parts[0].text;
                    setMessages(prev => [...prev, { role: 'model', text: botMsg }]);
                } catch (e) {
                    setMessages(prev => [...prev, { role: 'model', text: 'ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end">
                    {isOpen && (
                        <div className="bg-white w-80 h-96 rounded-2xl shadow-2xl border border-slate-200 flex flex-col overflow-hidden mb-4 animate-fade-in">
                            <div className="bg-navy-900 text-white p-4 flex justify-between items-center">
                                <div className="flex items-center gap-2 font-bold"><i data-lucide="bot" className="w-5 h-5"></i> HQ AI Assistant</div>
                                <button onClick={()=>setIsOpen(false)}><i data-lucide="x" className="w-4 h-4"></i></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50" ref={scrollRef}>
                                {messages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                                        <div className={`chat-bubble ${m.role==='user'?'chat-user':'chat-bot'}`}>{m.text}</div>
                                    </div>
                                ))}
                                {loading && <div className="text-xs text-slate-400 ml-2">AIê°€ ë¶„ì„ ì¤‘...</div>}
                            </div>
                            <div className="p-3 bg-white border-t flex gap-2">
                                <input type="text" className="flex-1 border rounded-lg px-3 py-2 text-sm outline-none focus:border-brand-500" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&sendMessage()} />
                                <button onClick={sendMessage} disabled={loading} className="bg-brand-600 text-white p-2 rounded-lg hover:bg-brand-700 disabled:opacity-50"><i data-lucide="send" className="w-4 h-4"></i></button>
                            </div>
                        </div>
                    )}
                    <button onClick={()=>setIsOpen(!isOpen)} className="bg-brand-600 hover:bg-brand-700 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-105 flex items-center justify-center">
                        {isOpen ? <i data-lucide="chevron-down" className="w-6 h-6"></i> : <i data-lucide="message-square" className="w-6 h-6"></i>}
                    </button>
                </div>
            );
        };

        // AI Report View
        const AIReportView = ({ credits, setCredits, storeId }) => {
            const [mode, setMode] = useState('weekly');
            const [generating, setGenerating] = useState(false);
            const [report, setReport] = useState('');
            const [streamText, setStreamText] = useState('');

            const generateReport = async () => {
                if (credits < (mode==='weekly'?5:1)) return alert("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                setCredits(prev => prev - (mode==='weekly'?5:1));
                setGenerating(true);
                setReport('');
                setStreamText('');

                const prompt = mode === 'weekly' 
                    ? `${NOTEBOOK_CONTEXT}\n\nìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë³¸ì‚¬ ì£¼ê°„ íšŒì˜ë¡ì„ ì‘ì„±í•´ì¤˜. ê²°ì •ì‚¬í•­(ì›ê°€ë°©ì–´ ë“±), ì•¡ì…˜ì•„ì´í…œ(ë‹´ë‹¹ì ì§€ì •), ì£¼ìš”ë…¼ì˜(ëŒ€í•™ë¡œì  ì´ìŠˆ ë“±)ë¥¼ í¬í•¨í•´ì„œ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ.`
                    : `${NOTEBOOK_CONTEXT}\n\nìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ '${storeId==='all'?'ëŒ€í•™ë¡œì ':storeId}'ì— ëŒ€í•œ SV ë§¤ì¥ ì ê²€ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì¤˜. ë§¤ì¶œë¶„ì„, ìš´ì˜ì´ìŠˆ(í”¼í¬íƒ€ì„), ê°œì„ ì œì•ˆ(KDS ë“±)ì„ í¬í•¨í•´ì¤˜.`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await response.json();
                    const fullText = data.candidates[0].content.parts[0].text;
                    
                    // Streaming effect
                    let i = 0;
                    const interval = setInterval(() => {
                        setStreamText(prev => prev + fullText.charAt(i));
                        i++;
                        if (i >= fullText.length) {
                            clearInterval(interval);
                            setReport(fullText);
                            setGenerating(false);
                        }
                    }, 10);
                } catch (e) {
                    setReport("ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    setGenerating(false);
                }
            };

            return (
                <div className="flex h-full gap-6 animate-fade-in">
                    <div className="w-1/3 bg-white p-6 rounded-xl shadow-sm border flex flex-col">
                        <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="sparkles" className="text-brand-600"></i> AI ë¦¬í¬íŠ¸ ìƒì„±</h2>
                        <div className="flex bg-slate-100 p-1 rounded-lg mb-6">
                            <button onClick={()=>setMode('weekly')} className={`flex-1 py-2 text-sm font-bold rounded ${mode==='weekly'?'bg-white shadow text-brand-600':'text-slate-500'}`}>ì£¼ê°„ íšŒì˜ë¡ (5C)</button>
                            <button onClick={()=>setMode('inspection')} className={`flex-1 py-2 text-sm font-bold rounded ${mode==='inspection'?'bg-white shadow text-brand-600':'text-slate-500'}`}>ë§¤ì¥ ì ê²€ (1C)</button>
                        </div>
                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-auto">
                            <h4 className="text-xs font-bold text-blue-800 mb-2">ğŸ”— ì—°ë™ëœ ë°ì´í„° (NotebookLM)</h4>
                            <ul className="text-xs text-blue-700 list-disc list-inside space-y-1">
                                <li>2025ë…„ 10ì›” ì „ì‚¬ ë§¤ì¶œ DB.csv</li>
                                <li>11/11 ì£¼ê°„ íšŒì˜ ë…¹ì·¨ë¡.txt</li>
                                <li>ëŒ€í•™ë¡œì  SV ë°©ë¬¸ ì¼ì§€.pdf</li>
                            </ul>
                        </div>
                        <button onClick={generateReport} disabled={generating} className="w-full bg-gradient-to-r from-brand-600 to-brand-500 text-white py-3 rounded-xl font-bold mt-4 hover:opacity-90 disabled:opacity-50 flex justify-center items-center gap-2">
                            {generating ? <i data-lucide="loader-2" className="animate-spin"></i> : <i data-lucide="zap"></i>}
                            {generating ? "Geminiê°€ ì‘ì„± ì¤‘..." : "ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°"}
                        </button>
                    </div>
                    <div className="flex-1 bg-white rounded-xl shadow-sm border flex flex-col overflow-hidden">
                        <div className="bg-slate-50 border-b px-4 py-2 flex items-center justify-between">
                            <div className="flex gap-2"><div className="w-3 h-3 rounded-full bg-red-400"></div><div className="w-3 h-3 rounded-full bg-yellow-400"></div><div className="w-3 h-3 rounded-full bg-green-400"></div></div>
                            <span className="text-xs text-slate-400 font-mono">Powered by Gemini Pro</span>
                        </div>
                        <div className="flex-1 p-8 overflow-y-auto canvas-editor">
                            {streamText ? (
                                <div className="prose prose-sm max-w-none whitespace-pre-line typing-cursor">{streamText}</div>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-slate-300">
                                    <i data-lucide="file-text" className="w-16 h-16 mb-4 opacity-50"></i>
                                    <p>ì„¤ì •ì„ ì„ íƒí•˜ê³  ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Dashboard Components (Simplified for brevity, same logic as before)
        const DashboardView = ({ storeId }) => {
            // Data Logic (Same as previous)
            const data = {
                kpi: { sales: 273610500, orders: 14520, ticket: 18840, costRate: 38.5 },
                trend: [{name:'1ì£¼',val:6200},{name:'2ì£¼',val:6800},{name:'3ì£¼',val:7100},{name:'4ì£¼',val:7260}]
            };
            
            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="grid grid-cols-4 gap-5">
                        <div className="bg-white p-5 rounded-xl shadow-sm border"><p className="text-slate-500 text-sm">ì´ ë§¤ì¶œ</p><h3 className="text-2xl font-bold">â‚©{data.kpi.sales.toLocaleString()}</h3></div>
                        <div className="bg-white p-5 rounded-xl shadow-sm border"><p className="text-slate-500 text-sm">ì£¼ë¬¸ìˆ˜</p><h3 className="text-2xl font-bold">{data.kpi.orders.toLocaleString()}ê±´</h3></div>
                        <div className="bg-white p-5 rounded-xl shadow-sm border"><p className="text-slate-500 text-sm">ê°ë‹¨ê°€</p><h3 className="text-2xl font-bold">â‚©{data.kpi.ticket.toLocaleString()}</h3></div>
                        <div className="bg-white p-5 rounded-xl shadow-sm border"><p className="text-slate-500 text-sm">ì›ê°€ìœ¨</p><h3 className="text-2xl font-bold text-red-500">{data.kpi.costRate}% (â–²1.5%)</h3></div>
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border h-80">
                        <h3 className="font-bold mb-4">ë§¤ì¶œ ì¶”ì´</h3>
                        <ResponsiveContainer width="100%" height="100%">
                            <LineChart data={data.trend}><CartesianGrid strokeDasharray="3 3" vertical={false}/><XAxis dataKey="name"/><YAxis/><Tooltip/><Line type="monotone" dataKey="val" stroke="#2563eb" strokeWidth={3}/></LineChart>
                        </ResponsiveContainer>
                    </div>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [menu, setMenu] = useState('dashboard');
            const [storeId, setStoreId] = useState('all');
            const [credits, setCredits] = useState(100);
            const [showAd, setShowAd] = useState(false);

            useEffect(() => { if(window.lucide) window.lucide.createIcons(); });

            const handleRecharge = () => {
                setShowAd(true);
                setTimeout(() => { setShowAd(false); setCredits(c => c+10); alert('ì¶©ì „ ì™„ë£Œ!'); }, 2000);
            };

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100">
                    <div className="bg-white p-10 rounded-2xl shadow-xl w-96 text-center">
                        <h1 className="text-3xl font-bold text-navy-900 mb-8">HQ Login</h1>
                        <button onClick={()=>setIsLoggedIn(true)} className="w-full bg-navy-900 text-white py-3 rounded-lg font-bold">ë¡œê·¸ì¸ (Demo)</button>
                    </div>
                </div>
            );

            return (
                <div className="flex min-h-screen relative">
                    {showAd && <div className="fixed inset-0 z-[60] bg-black/80 flex items-center justify-center text-white text-xl font-bold">Google AdSense ê´‘ê³  ì‹œì²­ ì¤‘...</div>}
                    
                    <aside className="w-64 bg-navy-900 text-white fixed h-full z-10 flex flex-col">
                        <div className="p-6 border-b border-navy-800 font-bold text-xl flex items-center gap-2"><i data-lucide="layout-dashboard"></i> RestoGenie</div>
                        <nav className="flex-1 p-4 space-y-1">
                            <button onClick={()=>setMenu('dashboard')} className={`w-full flex items-center gap-3 px-3 py-3 rounded-lg text-sm ${menu==='dashboard'?'bg-brand-600':'hover:bg-navy-800'}`}><i data-lucide="bar-chart-2"></i> ëŒ€ì‹œë³´ë“œ</button>
                            <button onClick={()=>setMenu('aireport')} className={`w-full flex items-center gap-3 px-3 py-3 rounded-lg text-sm mt-4 ${menu==='aireport'?'bg-gradient-to-r from-brand-600 to-indigo-600 font-bold':'hover:bg-navy-800'}`}><i data-lucide="sparkles"></i> AI ë¦¬í¬íŠ¸</button>
                        </nav>
                    </aside>

                    <main className="ml-64 flex-1 p-8 bg-slate-50 relative">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-2xl font-bold text-navy-900">{menu==='dashboard'?'ìš´ì˜ í˜„í™©':'AI ìŠ¤ë§ˆíŠ¸ ë¦¬í¬íŠ¸'}</h1>
                            <div className="flex items-center gap-4">
                                <select className="bg-white border p-2 rounded font-bold" value={storeId} onChange={e=>setStoreId(e.target.value)}>
                                    <option value="all">ì „ì‚¬ (All)</option><option value="ê°•ë‚¨ì ">ê°•ë‚¨ì </option><option value="ëŒ€í•™ë¡œì ">ëŒ€í•™ë¡œì </option>
                                </select>
                                <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded-full border shadow-sm">
                                    <div className="w-5 h-5 rounded-full bg-yellow-400 flex items-center justify-center text-xs font-bold text-white">P</div>
                                    <span className="font-bold">{credits}</span>
                                    <button onClick={handleRecharge} className="text-xs bg-slate-100 px-2 py-1 rounded hover:bg-slate-200">ì¶©ì „</button>
                                </div>
                            </div>
                        </div>

                        {menu === 'dashboard' && <DashboardView storeId={storeId} />}
                        {menu === 'aireport' && <AIReportView credits={credits} setCredits={setCredits} storeId={storeId} />}
                        
                        <AIChatbot />
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
